{"remainingRequest":"C:\\xxm\\work\\jd\\fore\\node_modules\\babel-loader\\lib\\index.js!C:\\xxm\\work\\jd\\fore\\node_modules\\@vue\\cli-plugin-eslint\\node_modules\\eslint-loader\\index.js??ref--13-0!C:\\xxm\\work\\jd\\fore\\src\\store\\modules\\user.js","dependencies":[{"path":"C:\\xxm\\work\\jd\\fore\\src\\store\\modules\\user.js","mtime":1578044820134},{"path":"C:\\xxm\\work\\jd\\fore\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1570779194464},{"path":"C:\\xxm\\work\\jd\\fore\\node_modules\\babel-loader\\lib\\index.js","mtime":1570779245522},{"path":"C:\\xxm\\work\\jd\\fore\\node_modules\\@vue\\cli-plugin-eslint\\node_modules\\eslint-loader\\index.js","mtime":1570780125155}],"contextDependencies":[],"result":["import Vue from 'vue';\nimport { login, logout, phoneLogin } from \"@/api/login\";\nimport { ACCESS_TOKEN, USER_NAME, USER_INFO, USER_AUTH, SYS_BUTTON_AUTH } from \"@/store/mutation-types\";\nimport { welcome } from \"@/utils/util\";\nimport { queryPermissionsByUser } from '@/api/api';\nimport { getAction } from '@/api/manage';\nvar user = {\n  state: {\n    token: '',\n    username: '',\n    realname: '',\n    welcome: '',\n    avatar: '',\n    permissionList: [],\n    info: {}\n  },\n  mutations: {\n    SET_TOKEN: function SET_TOKEN(state, token) {\n      state.token = token;\n    },\n    SET_NAME: function SET_NAME(state, _ref) {\n      var username = _ref.username,\n          realname = _ref.realname,\n          welcome = _ref.welcome;\n      state.username = username;\n      state.realname = realname;\n      state.welcome = welcome;\n    },\n    SET_AVATAR: function SET_AVATAR(state, avatar) {\n      state.avatar = avatar;\n    },\n    SET_PERMISSIONLIST: function SET_PERMISSIONLIST(state, permissionList) {\n      state.permissionList = permissionList;\n    },\n    SET_INFO: function SET_INFO(state, info) {\n      state.info = info;\n    }\n  },\n  actions: {\n    // CAS验证登录\n    ValidateLogin: function ValidateLogin(_ref2, userInfo) {\n      var commit = _ref2.commit;\n      return new Promise(function (resolve, reject) {\n        getAction(\"/cas/client/validateLogin\", userInfo).then(function (response) {\n          console.log(\"----cas 登录--------\", response);\n\n          if (response.success) {\n            var result = response.result;\n            var _userInfo = result.userInfo;\n            Vue.ls.set(ACCESS_TOKEN, result.token, 7 * 24 * 60 * 60 * 1000);\n            Vue.ls.set(USER_NAME, _userInfo.username, 7 * 24 * 60 * 60 * 1000);\n            Vue.ls.set(USER_INFO, _userInfo, 7 * 24 * 60 * 60 * 1000);\n            commit('SET_TOKEN', result.token);\n            commit('SET_INFO', _userInfo);\n            commit('SET_NAME', {\n              username: _userInfo.username,\n              realname: _userInfo.realname,\n              welcome: welcome()\n            });\n            commit('SET_AVATAR', _userInfo.avatar);\n            resolve(response);\n          } else {\n            resolve(response);\n          }\n        }).catch(function (error) {\n          reject(error);\n        });\n      });\n    },\n    // 登录\n    Login: function Login(_ref3, userInfo) {\n      var commit = _ref3.commit;\n      return new Promise(function (resolve, reject) {\n        login(userInfo).then(function (response) {\n          if (response.code == '200') {\n            var result = response.result;\n            var _userInfo2 = result.userInfo;\n            Vue.ls.set(ACCESS_TOKEN, result.token, 7 * 24 * 60 * 60 * 1000);\n            Vue.ls.set(USER_NAME, _userInfo2.username, 7 * 24 * 60 * 60 * 1000);\n            Vue.ls.set(USER_INFO, _userInfo2, 7 * 24 * 60 * 60 * 1000);\n            commit('SET_TOKEN', result.token);\n            commit('SET_INFO', _userInfo2);\n            commit('SET_NAME', {\n              username: _userInfo2.username,\n              realname: _userInfo2.realname,\n              welcome: welcome()\n            });\n            commit('SET_AVATAR', _userInfo2.avatar);\n            resolve(response);\n          } else {\n            reject(response);\n          }\n        }).catch(function (error) {\n          reject(error);\n        });\n      });\n    },\n    //手机号登录\n    PhoneLogin: function PhoneLogin(_ref4, userInfo) {\n      var commit = _ref4.commit;\n      return new Promise(function (resolve, reject) {\n        phoneLogin(userInfo).then(function (response) {\n          if (response.code == '200') {\n            var result = response.result;\n            var _userInfo3 = result.userInfo;\n            Vue.ls.set(ACCESS_TOKEN, result.token, 7 * 24 * 60 * 60 * 1000);\n            Vue.ls.set(USER_NAME, _userInfo3.username, 7 * 24 * 60 * 60 * 1000);\n            Vue.ls.set(USER_INFO, _userInfo3, 7 * 24 * 60 * 60 * 1000);\n            commit('SET_TOKEN', result.token);\n            commit('SET_INFO', _userInfo3);\n            commit('SET_NAME', {\n              username: _userInfo3.username,\n              realname: _userInfo3.realname,\n              welcome: welcome()\n            });\n            commit('SET_AVATAR', _userInfo3.avatar);\n            resolve(response);\n          } else {\n            reject(response);\n          }\n        }).catch(function (error) {\n          reject(error);\n        });\n      });\n    },\n    // 获取用户信息\n    GetPermissionList: function GetPermissionList(_ref5) {\n      var commit = _ref5.commit;\n      return new Promise(function (resolve, reject) {\n        var v_token = Vue.ls.get(ACCESS_TOKEN);\n        var params = {\n          token: v_token\n        };\n        queryPermissionsByUser(params).then(function (response) {\n          var menuData = response.result.menu;\n          var authData = response.result.auth;\n          var allAuthData = response.result.allAuth; //Vue.ls.set(USER_AUTH,authData);\n\n          sessionStorage.setItem(USER_AUTH, JSON.stringify(authData));\n          sessionStorage.setItem(SYS_BUTTON_AUTH, JSON.stringify(allAuthData));\n\n          if (menuData && menuData.length > 0) {\n            commit('SET_PERMISSIONLIST', menuData);\n          } else {\n            reject('getPermissionList: permissions must be a non-null array !');\n          }\n\n          resolve(response);\n        }).catch(function (error) {\n          reject(error);\n        });\n      });\n    },\n    // 登出\n    Logout: function Logout(_ref6) {\n      var commit = _ref6.commit,\n          state = _ref6.state;\n      return new Promise(function (resolve) {\n        var logoutToken = state.token;\n        commit('SET_TOKEN', '');\n        commit('SET_PERMISSIONLIST', []);\n        Vue.ls.remove(ACCESS_TOKEN); //清除记录的缓存\n\n        var userInfo = localStorage.getItem('userdata');\n\n        if (userInfo != undefined) {\n          var _user = JSON.parse(userInfo);\n\n          var uid = _user.userInfo.id;\n          localStorage.removeItem(\"userdata\");\n\n          for (var i = 0; i < localStorage.length; i++) {\n            var key = localStorage.key(i); //获取本地存储的Key\n\n            if (key.indexOf(uid + '/') == 0) {\n              localStorage.removeItem(key);\n            }\n          }\n        } //console.log('logoutToken: '+ logoutToken)\n\n\n        logout(logoutToken).then(function () {\n          //var sevice = \"http://\"+window.location.host+\"/\";\n          //var serviceUrl = encodeURIComponent(sevice);\n          //window.location.href = window._CONFIG['casPrefixUrl']+\"/logout?service=\"+serviceUrl;\n          resolve();\n        }).catch(function () {\n          resolve();\n        });\n      });\n    }\n  }\n};\nexport default user;",{"version":3,"sources":["C:\\xxm\\work\\jd\\fore\\src\\store\\modules\\user.js"],"names":["Vue","login","logout","phoneLogin","ACCESS_TOKEN","USER_NAME","USER_INFO","USER_AUTH","SYS_BUTTON_AUTH","welcome","queryPermissionsByUser","getAction","user","state","token","username","realname","avatar","permissionList","info","mutations","SET_TOKEN","SET_NAME","SET_AVATAR","SET_PERMISSIONLIST","SET_INFO","actions","ValidateLogin","userInfo","commit","Promise","resolve","reject","then","response","console","log","success","result","ls","set","catch","error","Login","code","PhoneLogin","GetPermissionList","v_token","get","params","menuData","menu","authData","auth","allAuthData","allAuth","sessionStorage","setItem","JSON","stringify","length","Logout","logoutToken","remove","localStorage","getItem","undefined","parse","uid","id","removeItem","i","key","indexOf"],"mappings":"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","sourcesContent":["import Vue from 'vue'\r\nimport {login, logout, phoneLogin} from \"@/api/login\"\r\nimport {ACCESS_TOKEN, USER_NAME, USER_INFO, USER_AUTH, SYS_BUTTON_AUTH} from \"@/store/mutation-types\"\r\nimport {welcome} from \"@/utils/util\"\r\nimport {queryPermissionsByUser} from '@/api/api'\r\nimport {getAction} from '@/api/manage'\r\n\r\nconst user = {\r\n  state: {\r\n    token: '',\r\n    username: '',\r\n    realname: '',\r\n    welcome: '',\r\n    avatar: '',\r\n    permissionList: [],\r\n    info: {}\r\n  },\r\n\r\n  mutations: {\r\n    SET_TOKEN: (state, token) => {\r\n      state.token = token\r\n    },\r\n    SET_NAME: (state, {username, realname, welcome}) => {\r\n      state.username = username\r\n      state.realname = realname\r\n      state.welcome = welcome\r\n    },\r\n    SET_AVATAR: (state, avatar) => {\r\n      state.avatar = avatar\r\n    },\r\n    SET_PERMISSIONLIST: (state, permissionList) => {\r\n      state.permissionList = permissionList\r\n    },\r\n    SET_INFO: (state, info) => {\r\n      state.info = info\r\n    },\r\n  },\r\n\r\n  actions: {\r\n    // CAS验证登录\r\n    ValidateLogin({commit}, userInfo) {\r\n      return new Promise((resolve, reject) => {\r\n        getAction(\"/cas/client/validateLogin\", userInfo).then(response => {\r\n          console.log(\"----cas 登录--------\", response);\r\n          if (response.success) {\r\n            const result = response.result\r\n            const userInfo = result.userInfo\r\n            Vue.ls.set(ACCESS_TOKEN, result.token, 7 * 24 * 60 * 60 * 1000)\r\n            Vue.ls.set(USER_NAME, userInfo.username, 7 * 24 * 60 * 60 * 1000)\r\n            Vue.ls.set(USER_INFO, userInfo, 7 * 24 * 60 * 60 * 1000)\r\n            commit('SET_TOKEN', result.token)\r\n            commit('SET_INFO', userInfo)\r\n            commit('SET_NAME', {username: userInfo.username, realname: userInfo.realname, welcome: welcome()})\r\n            commit('SET_AVATAR', userInfo.avatar)\r\n            resolve(response)\r\n          } else {\r\n            resolve(response)\r\n          }\r\n        }).catch(error => {\r\n          reject(error)\r\n        })\r\n      })\r\n    },\r\n    // 登录\r\n    Login({commit}, userInfo) {\r\n      return new Promise((resolve, reject) => {\r\n        login(userInfo).then(response => {\r\n          if (response.code == '200') {\r\n            const result = response.result\r\n            const userInfo = result.userInfo\r\n            Vue.ls.set(ACCESS_TOKEN, result.token, 7 * 24 * 60 * 60 * 1000)\r\n            Vue.ls.set(USER_NAME, userInfo.username, 7 * 24 * 60 * 60 * 1000)\r\n            Vue.ls.set(USER_INFO, userInfo, 7 * 24 * 60 * 60 * 1000)\r\n            commit('SET_TOKEN', result.token)\r\n            commit('SET_INFO', userInfo)\r\n            commit('SET_NAME', {username: userInfo.username, realname: userInfo.realname, welcome: welcome()})\r\n            commit('SET_AVATAR', userInfo.avatar)\r\n            resolve(response)\r\n          } else {\r\n            reject(response)\r\n          }\r\n        }).catch(error => {\r\n          reject(error)\r\n        })\r\n      })\r\n    },\r\n    //手机号登录\r\n    PhoneLogin({commit}, userInfo) {\r\n      return new Promise((resolve, reject) => {\r\n        phoneLogin(userInfo).then(response => {\r\n          if (response.code == '200') {\r\n            const result = response.result\r\n            const userInfo = result.userInfo\r\n            Vue.ls.set(ACCESS_TOKEN, result.token, 7 * 24 * 60 * 60 * 1000)\r\n            Vue.ls.set(USER_NAME, userInfo.username, 7 * 24 * 60 * 60 * 1000)\r\n            Vue.ls.set(USER_INFO, userInfo, 7 * 24 * 60 * 60 * 1000)\r\n            commit('SET_TOKEN', result.token)\r\n            commit('SET_INFO', userInfo)\r\n            commit('SET_NAME', {username: userInfo.username, realname: userInfo.realname, welcome: welcome()})\r\n            commit('SET_AVATAR', userInfo.avatar)\r\n            resolve(response)\r\n          } else {\r\n            reject(response)\r\n          }\r\n        }).catch(error => {\r\n          reject(error)\r\n        })\r\n      })\r\n    },\r\n    // 获取用户信息\r\n    GetPermissionList({commit}) {\r\n      return new Promise((resolve, reject) => {\r\n        let v_token = Vue.ls.get(ACCESS_TOKEN);\r\n        let params = {token: v_token};\r\n        queryPermissionsByUser(params).then(response => {\r\n          const menuData = response.result.menu;\r\n          const authData = response.result.auth;\r\n          const allAuthData = response.result.allAuth;\r\n          //Vue.ls.set(USER_AUTH,authData);\r\n          sessionStorage.setItem(USER_AUTH, JSON.stringify(authData));\r\n          sessionStorage.setItem(SYS_BUTTON_AUTH, JSON.stringify(allAuthData));\r\n          if (menuData && menuData.length > 0) {\r\n            commit('SET_PERMISSIONLIST', menuData)\r\n          } else {\r\n            reject('getPermissionList: permissions must be a non-null array !')\r\n          }\r\n          resolve(response)\r\n        }).catch(error => {\r\n          reject(error)\r\n        })\r\n      })\r\n    },\r\n\r\n    // 登出\r\n    Logout({commit, state}) {\r\n      return new Promise((resolve) => {\r\n        let logoutToken = state.token;\r\n        commit('SET_TOKEN', '')\r\n        commit('SET_PERMISSIONLIST', [])\r\n        Vue.ls.remove(ACCESS_TOKEN)\r\n        //清除记录的缓存\r\n        let userInfo = localStorage.getItem('userdata');\r\n        if (userInfo != undefined) {\r\n          let user = JSON.parse(userInfo)\r\n          let uid = user.userInfo.id\r\n          localStorage.removeItem(\"userdata\")\r\n          for (var i = 0; i < localStorage.length; i++) {\r\n            var key = localStorage.key(i); //获取本地存储的Key\r\n            if (key.indexOf(uid + '/') == 0) {\r\n              localStorage.removeItem(key)\r\n            }\r\n          }\r\n        }\r\n        //console.log('logoutToken: '+ logoutToken)\r\n        logout(logoutToken).then(() => {\r\n          //var sevice = \"http://\"+window.location.host+\"/\";\r\n          //var serviceUrl = encodeURIComponent(sevice);\r\n          //window.location.href = window._CONFIG['casPrefixUrl']+\"/logout?service=\"+serviceUrl;\r\n          resolve()\r\n        }).catch(() => {\r\n          resolve()\r\n        })\r\n      })\r\n    },\r\n\r\n  }\r\n}\r\n\r\nexport default user"]}]}