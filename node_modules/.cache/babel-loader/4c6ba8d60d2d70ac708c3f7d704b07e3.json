{"remainingRequest":"C:\\xxm\\work\\jd\\fore\\node_modules\\babel-loader\\lib\\index.js!C:\\xxm\\work\\jd\\fore\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!C:\\xxm\\work\\jd\\fore\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\xxm\\work\\jd\\fore\\src\\views\\buttons\\selectUnitName.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\xxm\\work\\jd\\fore\\src\\views\\buttons\\selectUnitName.vue","mtime":1579166497080},{"path":"C:\\xxm\\work\\jd\\fore\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1570779194464},{"path":"C:\\xxm\\work\\jd\\fore\\node_modules\\babel-loader\\lib\\index.js","mtime":1570779245522},{"path":"C:\\xxm\\work\\jd\\fore\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1570779194464},{"path":"C:\\xxm\\work\\jd\\fore\\node_modules\\vue-loader\\lib\\index.js","mtime":1570779225726}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport { getAction, postAction } from \"@/api/manage\";\nimport { JeecgListMixin } from '@/mixins/JeecgListMixin';\nexport default {\n  name: \"selectUnitName\",\n  data: function data() {\n    return {\n      columns: [{\n        title: '县行',\n        dataIndex: 'depart_name',\n        width: 300,\n        align: \"center\"\n      }],\n      busData: [],\n      userData: [],\n      selectedRowKeys: [],\n      selectionRows: [],\n      mockData1: [],\n      usersAndTable: [],\n      visible: false,\n      url: {\n        queryDownUnits: '/oaBus/dynamic/queryUnitsByUser',\n        downSendFile: '/oaBus/dynamic/downSendFile',\n        updateBusdata: '/oaBus/dynamic/update',\n        updateData: '/oaBus/dynamic/updateData',\n        //普通修改数据\n        insertPermit: '/oaBus/dynamic/insertPermit',\n        //普通修改数据\n        copyFile: '/oaBus/oaFile/copyFile' //复制附件\n\n      }\n    };\n  },\n  methods: {\n    show: function show(data) {\n      // console.log(data)\n      this.busData = data;\n      this.initData();\n      this.visible = true;\n    },\n    //初始化数据，查出部门名称对应的数据字典数据\n    initData: function initData() {\n      var _this = this;\n\n      var url = this.url.queryDownUnits;\n      postAction(url).then(function (rec) {\n        _this.mockData1 = rec.result;\n      });\n    },\n    onSelectChange: function onSelectChange(selectedRowKeys, selectionRows) {\n      this.selectedRowKeys = selectedRowKeys;\n      this.selectionRows = selectionRows;\n    },\n    handleOk: function handleOk() {\n      var _this2 = this;\n\n      var departs = [];\n      var obj = this.selectionRows;\n\n      if (obj.length <= 0) {\n        alert(\"请选择下发县行\");\n        return;\n      } //组装县行id\n\n\n      for (var i in obj) {\n        departs.push(obj[i].id);\n      }\n\n      var map = {};\n      map['unit'] = departs; //查询县行角色管理员用户\n\n      var flag = false;\n      postAction(this.url.downSendFile, map).then(function (res) {\n        if (res.success) {\n          (function () {\n            var unitData = res.result[\"unitTables\"];\n            _this2.userData = res.result; //遍历县行\n\n            var _loop = function _loop(_i) {\n              var param = {};\n              param.modelId = unitData[_i].modelId;\n              param.functionId = unitData[_i].functionId;\n              var unitId = unitData[_i].unitId; //新建任务\n\n              postAction(\"/oaBus/oaBusdata/queryNewTaskMsg\", param).then(function (res) {\n                if (res.success) {\n                  /**\n                   * 收文页面数据\n                   * s_title 标题\n                   * s_create_name  登记人员\n                   * d_create_time 收文日期\n                   * d_datetime1 成文日期\n                   * s_file_num 文件字号\n                   * s_varchar4 来文文种\n                   * s_receive_num 来文字号\n                   * s_varchar5  来文机关\n                   */\n                  var receiveData = {};\n                  receiveData.s_title = _this2.busData.s_title; //标题\n\n                  receiveData.d_sealdate = _this2.busData.d_sealdate; //成文日期  d_sealdate\n\n                  receiveData.s_receive_num = _this2.busData.s_file_num; //来文字号 s_file_num\n\n                  receiveData.s_varchar5 = _this2.busData.s_unit_name; //来文机关 s_unit_name\n\n                  receiveData.i_urgency = _this2.busData.i_urgency; //缓急 i_urgency\n\n                  receiveData.i_bigint1 = _this2.busData.i_bigint1; //印发份数\n\n                  receiveData.i_bigint2 = _this2.busData.i_bigint2; //正文页数\n\n                  receiveData.table = res.result.tableName;\n                  receiveData.i_id = res.result.busdataId;\n                  receiveData.s_create_by = \"\";\n                  var user = _this2.userData[unitId];\n\n                  for (var j = 0; j < user.length; j++) {\n                    receiveData.s_create_by += user[j].userId + \",\"; //创建人\n                  } //更新数据\n\n\n                  postAction(_this2.url.updateData, receiveData).then(function (res) {\n                    if (res.success) {\n                      //开启流程\n                      postAction(_this2.url.updateBusdata, {\n                        updateBusdata: res.result\n                      }).then(function (res) {\n                        if (res.success) {\n                          for (var key in _this2.userData) {\n                            if (key == unitId) {\n                              var users = [];\n                              users = _this2.userData[key];\n                              postAction(_this2.url.insertPermit, {\n                                list: users,\n                                functionId: param.functionId,\n                                iBusdataId: receiveData.i_id,\n                                table: receiveData.table\n                              }).then(function (res) {\n                                if (res.success) {\n                                  //复制发文附件\n                                  var fileParam = {};\n                                  fileParam.sTable = _this2.busData.table; //发文业务表\n\n                                  fileParam.iTableId = _this2.busData.i_id; //发文业务数据id\n\n                                  fileParam.sFileType = 4; //附件类型\n\n                                  fileParam.receiveTable = receiveData.table;\n                                  fileParam.receiveId = receiveData.i_id;\n                                  postAction(_this2.url.copyFile, fileParam).then(function (res) {\n                                    if (res.success) {\n                                      if (_i == unitData.length - 1) {\n                                        flag = true;\n\n                                        _this2.$message.success(\"下发成功！\");\n                                      }\n                                    } else {\n                                      _this2.$message.error(\"附件复制失败！\");\n                                    }\n                                  });\n                                } else {\n                                  _this2.$message.error(\"用户权限写入失败！\");\n                                }\n                              });\n                            }\n                          }\n                        } else {\n                          _this2.$message.error(\"开启流程失败！\");\n                        }\n                      });\n                    } else {\n                      _this2.$message.error(\"业务数据更新失败！\");\n                    }\n                  });\n                } else {\n                  _this2.$message.error(\"新建任务失败！\");\n                }\n              });\n            };\n\n            for (var _i in unitData) {\n              _loop(_i);\n            }\n\n            _this2.close();\n          })();\n        } else {\n          _this2.$message.error(\"查询角色管理员失败！\");\n        }\n      });\n    },\n    close: function close() {\n      this.$emit('close');\n      this.visible = false;\n      this.selectionRows = [];\n      this.selectedRowKeys = [];\n    },\n    handleCancel: function handleCancel() {\n      this.close();\n    }\n  }\n};",{"version":3,"sources":["selectUnitName.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;AAwBA,SAAA,SAAA,EAAA,UAAA,QAAA,cAAA;AACA,SAAA,cAAA,QAAA,yBAAA;AAEA,eAAA;AACA,EAAA,IAAA,EAAA,gBADA;AAEA,EAAA,IAFA,kBAEA;AACA,WAAA;AACA,MAAA,OAAA,EAAA,CACA;AACA,QAAA,KAAA,EAAA,IADA;AAEA,QAAA,SAAA,EAAA,aAFA;AAGA,QAAA,KAAA,EAAA,GAHA;AAIA,QAAA,KAAA,EAAA;AAJA,OADA,CADA;AAQA,MAAA,OAAA,EAAA,EARA;AASA,MAAA,QAAA,EAAA,EATA;AAUA,MAAA,eAAA,EAAA,EAVA;AAWA,MAAA,aAAA,EAAA,EAXA;AAYA,MAAA,SAAA,EAAA,EAZA;AAaA,MAAA,aAAA,EAAA,EAbA;AAcA,MAAA,OAAA,EAAA,KAdA;AAeA,MAAA,GAAA,EAAA;AACA,QAAA,cAAA,EAAA,iCADA;AAEA,QAAA,YAAA,EAAA,6BAFA;AAGA,QAAA,aAAA,EAAA,uBAHA;AAIA,QAAA,UAAA,EAAA,2BAJA;AAIA;AACA,QAAA,YAAA,EAAA,6BALA;AAKA;AACA,QAAA,QAAA,EAAA,wBANA,CAMA;;AANA;AAfA,KAAA;AAwBA,GA3BA;AA4BA,EAAA,OAAA,EAAA;AAEA,IAAA,IAFA,gBAEA,IAFA,EAEA;AACA;AACA,WAAA,OAAA,GAAA,IAAA;AACA,WAAA,QAAA;AACA,WAAA,OAAA,GAAA,IAAA;AACA,KAPA;AAQA;AACA,IAAA,QATA,sBASA;AAAA;;AACA,UAAA,GAAA,GAAA,KAAA,GAAA,CAAA,cAAA;AACA,MAAA,UAAA,CAAA,GAAA,CAAA,CAAA,IAAA,CAAA,UAAA,GAAA,EAAA;AACA,QAAA,KAAA,CAAA,SAAA,GAAA,GAAA,CAAA,MAAA;AACA,OAFA;AAGA,KAdA;AAeA,IAAA,cAfA,0BAeA,eAfA,EAeA,aAfA,EAeA;AACA,WAAA,eAAA,GAAA,eAAA;AACA,WAAA,aAAA,GAAA,aAAA;AACA,KAlBA;AAmBA,IAAA,QAnBA,sBAmBA;AAAA;;AACA,UAAA,OAAA,GAAA,EAAA;AACA,UAAA,GAAA,GAAA,KAAA,aAAA;;AACA,UAAA,GAAA,CAAA,MAAA,IAAA,CAAA,EAAA;AACA,QAAA,KAAA,CAAA,SAAA,CAAA;AACA;AACA,OANA,CAOA;;;AACA,WAAA,IAAA,CAAA,IAAA,GAAA,EAAA;AACA,QAAA,OAAA,CAAA,IAAA,CAAA,GAAA,CAAA,CAAA,CAAA,CAAA,EAAA;AACA;;AACA,UAAA,GAAA,GAAA,EAAA;AACA,MAAA,GAAA,CAAA,MAAA,CAAA,GAAA,OAAA,CAZA,CAaA;;AACA,UAAA,IAAA,GAAA,KAAA;AACA,MAAA,UAAA,CAAA,KAAA,GAAA,CAAA,YAAA,EAAA,GAAA,CAAA,CAAA,IAAA,CAAA,UAAA,GAAA,EAAA;AACA,YAAA,GAAA,CAAA,OAAA,EAAA;AAAA;AAEA,gBAAA,QAAA,GAAA,GAAA,CAAA,MAAA,CAAA,YAAA,CAAA;AACA,YAAA,MAAA,CAAA,QAAA,GAAA,GAAA,CAAA,MAAA,CAHA,CAIA;;AAJA,uCAKA,EALA;AAMA,kBAAA,KAAA,GAAA,EAAA;AACA,cAAA,KAAA,CAAA,OAAA,GAAA,QAAA,CAAA,EAAA,CAAA,CAAA,OAAA;AACA,cAAA,KAAA,CAAA,UAAA,GAAA,QAAA,CAAA,EAAA,CAAA,CAAA,UAAA;AACA,kBAAA,MAAA,GAAA,QAAA,CAAA,EAAA,CAAA,CAAA,MAAA,CATA,CAUA;;AACA,cAAA,UAAA,CAAA,kCAAA,EAAA,KAAA,CAAA,CAAA,IAAA,CAAA,UAAA,GAAA,EAAA;AACA,oBAAA,GAAA,CAAA,OAAA,EAAA;AACA;;;;;;;;;;;AAWA,sBAAA,WAAA,GAAA,EAAA;AACA,kBAAA,WAAA,CAAA,OAAA,GAAA,MAAA,CAAA,OAAA,CAAA,OAAA,CAbA,CAaA;;AACA,kBAAA,WAAA,CAAA,UAAA,GAAA,MAAA,CAAA,OAAA,CAAA,UAAA,CAdA,CAcA;;AACA,kBAAA,WAAA,CAAA,aAAA,GAAA,MAAA,CAAA,OAAA,CAAA,UAAA,CAfA,CAeA;;AACA,kBAAA,WAAA,CAAA,UAAA,GAAA,MAAA,CAAA,OAAA,CAAA,WAAA,CAhBA,CAgBA;;AACA,kBAAA,WAAA,CAAA,SAAA,GAAA,MAAA,CAAA,OAAA,CAAA,SAAA,CAjBA,CAiBA;;AACA,kBAAA,WAAA,CAAA,SAAA,GAAA,MAAA,CAAA,OAAA,CAAA,SAAA,CAlBA,CAkBA;;AACA,kBAAA,WAAA,CAAA,SAAA,GAAA,MAAA,CAAA,OAAA,CAAA,SAAA,CAnBA,CAmBA;;AACA,kBAAA,WAAA,CAAA,KAAA,GAAA,GAAA,CAAA,MAAA,CAAA,SAAA;AACA,kBAAA,WAAA,CAAA,IAAA,GAAA,GAAA,CAAA,MAAA,CAAA,SAAA;AACA,kBAAA,WAAA,CAAA,WAAA,GAAA,EAAA;AACA,sBAAA,IAAA,GAAA,MAAA,CAAA,QAAA,CAAA,MAAA,CAAA;;AACA,uBAAA,IAAA,CAAA,GAAA,CAAA,EAAA,CAAA,GAAA,IAAA,CAAA,MAAA,EAAA,CAAA,EAAA,EAAA;AACA,oBAAA,WAAA,CAAA,WAAA,IAAA,IAAA,CAAA,CAAA,CAAA,CAAA,MAAA,GAAA,GAAA,CADA,CACA;AACA,mBA1BA,CA2BA;;;AACA,kBAAA,UAAA,CAAA,MAAA,CAAA,GAAA,CAAA,UAAA,EAAA,WAAA,CAAA,CAAA,IAAA,CAAA,UAAA,GAAA,EAAA;AACA,wBAAA,GAAA,CAAA,OAAA,EAAA;AACA;AACA,sBAAA,UAAA,CAAA,MAAA,CAAA,GAAA,CAAA,aAAA,EAAA;AAAA,wBAAA,aAAA,EAAA,GAAA,CAAA;AAAA,uBAAA,CAAA,CAAA,IAAA,CAAA,UAAA,GAAA,EAAA;AACA,4BAAA,GAAA,CAAA,OAAA,EAAA;AACA,+BAAA,IAAA,GAAA,IAAA,MAAA,CAAA,QAAA,EAAA;AACA,gCAAA,GAAA,IAAA,MAAA,EAAA;AACA,kCAAA,KAAA,GAAA,EAAA;AACA,8BAAA,KAAA,GAAA,MAAA,CAAA,QAAA,CAAA,GAAA,CAAA;AACA,8BAAA,UAAA,CAAA,MAAA,CAAA,GAAA,CAAA,YAAA,EAAA;AACA,gCAAA,IAAA,EAAA,KADA;AAEA,gCAAA,UAAA,EAAA,KAAA,CAAA,UAFA;AAGA,gCAAA,UAAA,EAAA,WAAA,CAAA,IAHA;AAIA,gCAAA,KAAA,EAAA,WAAA,CAAA;AAJA,+BAAA,CAAA,CAKA,IALA,CAKA,UAAA,GAAA,EAAA;AACA,oCAAA,GAAA,CAAA,OAAA,EAAA;AACA;AACA,sCAAA,SAAA,GAAA,EAAA;AACA,kCAAA,SAAA,CAAA,MAAA,GAAA,MAAA,CAAA,OAAA,CAAA,KAAA,CAHA,CAGA;;AACA,kCAAA,SAAA,CAAA,QAAA,GAAA,MAAA,CAAA,OAAA,CAAA,IAAA,CAJA,CAIA;;AACA,kCAAA,SAAA,CAAA,SAAA,GAAA,CAAA,CALA,CAKA;;AACA,kCAAA,SAAA,CAAA,YAAA,GAAA,WAAA,CAAA,KAAA;AACA,kCAAA,SAAA,CAAA,SAAA,GAAA,WAAA,CAAA,IAAA;AACA,kCAAA,UAAA,CAAA,MAAA,CAAA,GAAA,CAAA,QAAA,EAAA,SAAA,CAAA,CAAA,IAAA,CAAA,UAAA,GAAA,EAAA;AACA,wCAAA,GAAA,CAAA,OAAA,EAAA;AACA,0CAAA,EAAA,IAAA,QAAA,CAAA,MAAA,GAAA,CAAA,EAAA;AACA,wCAAA,IAAA,GAAA,IAAA;;AACA,wCAAA,MAAA,CAAA,QAAA,CAAA,OAAA,CAAA,OAAA;AACA;AACA,qCALA,MAKA;AACA,sCAAA,MAAA,CAAA,QAAA,CAAA,KAAA,CAAA,SAAA;AACA;AACA,mCATA;AAUA,iCAlBA,MAkBA;AACA,kCAAA,MAAA,CAAA,QAAA,CAAA,KAAA,CAAA,WAAA;AACA;AACA,+BA3BA;AA4BA;AACA;AACA,yBAnCA,MAmCA;AACA,0BAAA,MAAA,CAAA,QAAA,CAAA,KAAA,CAAA,SAAA;AACA;AACA,uBAvCA;AAyCA,qBA3CA,MA2CA;AACA,sBAAA,MAAA,CAAA,QAAA,CAAA,KAAA,CAAA,WAAA;AACA;AAEA,mBAhDA;AAiDA,iBA7EA,MA6EA;AACA,kBAAA,MAAA,CAAA,QAAA,CAAA,KAAA,CAAA,SAAA;AACA;AACA,eAjFA;AAXA;;AAKA,iBAAA,IAAA,EAAA,IAAA,QAAA,EAAA;AAAA,oBAAA,EAAA;AAwFA;;AACA,YAAA,MAAA,CAAA,KAAA;AA9FA;AA+FA,SA/FA,MA+FA;AACA,UAAA,MAAA,CAAA,QAAA,CAAA,KAAA,CAAA,YAAA;AACA;AACA,OAnGA;AAoGA,KAtIA;AAuIA,IAAA,KAvIA,mBAuIA;AACA,WAAA,KAAA,CAAA,OAAA;AACA,WAAA,OAAA,GAAA,KAAA;AACA,WAAA,aAAA,GAAA,EAAA;AACA,WAAA,eAAA,GAAA,EAAA;AACA,KA5IA;AA8IA,IAAA,YA9IA,0BA8IA;AACA,WAAA,KAAA;AACA;AAhJA;AA5BA,CAAA","sourcesContent":["<template>\r\n  <a-modal\r\n    :title=\"title\"\r\n    :width=\"710\"\r\n    :height=\"450\"\r\n    :visible=\"visible\"\r\n    @ok=\"handleOk\"\r\n    @cancel=\"handleCancel\"\r\n    cancelText=\"关闭\">\r\n    <!--<p class=\"title\"><span>{{item.depart_name}}</span></p>-->\r\n    <a-table ref=\"table\"\r\n             size=\"middle\"\r\n             bordered\r\n             :columns=\"columns\"\r\n             :dataSource=\"mockData1\"\r\n             :pagination=\"false\"\r\n             :rowSelection=\"{selectedRowKeys: selectedRowKeys, onChange: onSelectChange}\"\r\n    >\r\n    </a-table>\r\n\r\n  </a-modal>\r\n</template>\r\n<script>\r\n\r\n  import {getAction, postAction} from \"@/api/manage\";\r\n  import {JeecgListMixin} from '@/mixins/JeecgListMixin'\r\n\r\n  export default {\r\n    name: \"selectUnitName\",\r\n    data() {\r\n      return {\r\n        columns: [\r\n          {\r\n            title: '县行',\r\n            dataIndex: 'depart_name',\r\n            width: 300,\r\n            align: \"center\",\r\n          }],\r\n        busData: [],\r\n        userData: [],\r\n        selectedRowKeys: [],\r\n        selectionRows: [],\r\n        mockData1: [],\r\n        usersAndTable: [],\r\n        visible: false,\r\n        url: {\r\n          queryDownUnits: '/oaBus/dynamic/queryUnitsByUser',\r\n          downSendFile: '/oaBus/dynamic/downSendFile',\r\n          updateBusdata: '/oaBus/dynamic/update',\r\n          updateData: '/oaBus/dynamic/updateData', //普通修改数据\r\n          insertPermit: '/oaBus/dynamic/insertPermit', //普通修改数据\r\n          copyFile: '/oaBus/oaFile/copyFile' //复制附件\r\n        }\r\n      }\r\n    },\r\n    methods: {\r\n\r\n      show(data) {\r\n        // console.log(data)\r\n        this.busData = data;\r\n        this.initData();\r\n        this.visible = true;\r\n      },\r\n      //初始化数据，查出部门名称对应的数据字典数据\r\n      initData() {\r\n        let url = this.url.queryDownUnits;\r\n        postAction(url).then((rec) => {\r\n          this.mockData1 = rec.result;\r\n        })\r\n      },\r\n      onSelectChange(selectedRowKeys, selectionRows) {\r\n        this.selectedRowKeys = selectedRowKeys;\r\n        this.selectionRows = selectionRows;\r\n      },\r\n      handleOk() {\r\n        let departs = [];\r\n        let obj = this.selectionRows;\r\n        if (obj.length <= 0) {\r\n          alert(\"请选择下发县行\")\r\n          return;\r\n        }\r\n        //组装县行id\r\n        for (let i in obj) {\r\n          departs.push(obj[i].id)\r\n        }\r\n        var map = {};\r\n        map['unit'] = departs;\r\n        //查询县行角色管理员用户\r\n        let flag = false;\r\n        postAction(this.url.downSendFile, map).then((res) => {\r\n          if (res.success) {\r\n\r\n            let unitData = res.result[\"unitTables\"];\r\n            this.userData = res.result;\r\n            //遍历县行\r\n            for (let i in unitData) {\r\n              let param = {};\r\n              param.modelId = unitData[i].modelId;\r\n              param.functionId = unitData[i].functionId;\r\n              let unitId = unitData[i].unitId;\r\n              //新建任务\r\n              postAction(\"/oaBus/oaBusdata/queryNewTaskMsg\", param).then(res => {\r\n                if (res.success) {\r\n                  /**\r\n                   * 收文页面数据\r\n                   * s_title 标题\r\n                   * s_create_name  登记人员\r\n                   * d_create_time 收文日期\r\n                   * d_datetime1 成文日期\r\n                   * s_file_num 文件字号\r\n                   * s_varchar4 来文文种\r\n                   * s_receive_num 来文字号\r\n                   * s_varchar5  来文机关\r\n                   */\r\n                  let receiveData = {};\r\n                  receiveData.s_title = this.busData.s_title  //标题\r\n                  receiveData.d_sealdate = this.busData.d_sealdate//成文日期  d_sealdate\r\n                  receiveData.s_receive_num = this.busData.s_file_num //来文字号 s_file_num\r\n                  receiveData.s_varchar5 = this.busData.s_unit_name//来文机关 s_unit_name\r\n                  receiveData.i_urgency = this.busData.i_urgency; //缓急 i_urgency\r\n                  receiveData.i_bigint1 = this.busData.i_bigint1  //印发份数\r\n                  receiveData.i_bigint2 = this.busData.i_bigint2  //正文页数\r\n                  receiveData.table = res.result.tableName\r\n                  receiveData.i_id = res.result.busdataId\r\n                  receiveData.s_create_by = \"\";\r\n                  let user = this.userData[unitId];\r\n                  for (let j = 0; j < user.length; j++) {\r\n                    receiveData.s_create_by += user[j].userId + \",\"; //创建人\r\n                  }\r\n                  //更新数据\r\n                  postAction(this.url.updateData, receiveData).then(res => {\r\n                    if (res.success) {\r\n                      //开启流程\r\n                      postAction(this.url.updateBusdata, {updateBusdata: res.result}).then(res => {\r\n                        if (res.success) {\r\n                          for (var key in this.userData) {\r\n                            if (key == unitId) {\r\n                              let users = [];\r\n                              users = this.userData[key];\r\n                              postAction(this.url.insertPermit, {\r\n                                list: users,\r\n                                functionId: param.functionId,\r\n                                iBusdataId: receiveData.i_id,\r\n                                table: receiveData.table\r\n                              }).then(res => {\r\n                                if (res.success){\r\n                                  //复制发文附件\r\n                                  let fileParam = {};\r\n                                  fileParam.sTable = this.busData.table; //发文业务表\r\n                                  fileParam.iTableId = this.busData.i_id; //发文业务数据id\r\n                                  fileParam.sFileType = 4; //附件类型\r\n                                  fileParam.receiveTable = receiveData.table;\r\n                                  fileParam.receiveId = receiveData.i_id\r\n                                  postAction(this.url.copyFile,fileParam).then(res => {\r\n                                    if (res.success) {\r\n                                      if (i == unitData.length-1){\r\n                                        flag = true;\r\n                                        this.$message.success(\"下发成功！\")\r\n                                      }\r\n                                    } else {\r\n                                      this.$message.error(\"附件复制失败！\")\r\n                                    }\r\n                                  })\r\n                                }else {\r\n                                  this.$message.error(\"用户权限写入失败！\")\r\n                                }\r\n                              })\r\n                            }\r\n                          }\r\n                        } else {\r\n                          this.$message.error(\"开启流程失败！\")\r\n                        }\r\n                      })\r\n\r\n                    } else {\r\n                      this.$message.error(\"业务数据更新失败！\")\r\n                    }\r\n\r\n                  })\r\n                } else {\r\n                  this.$message.error(\"新建任务失败！\")\r\n                }\r\n              })\r\n            }\r\n            this.close()\r\n          } else {\r\n            this.$message.error(\"查询角色管理员失败！\")\r\n          }\r\n        })\r\n      },\r\n      close() {\r\n        this.$emit('close');\r\n        this.visible = false;\r\n        this.selectionRows = [];\r\n        this.selectedRowKeys = [];\r\n      },\r\n\r\n      handleCancel() {\r\n        this.close();\r\n      },\r\n\r\n    },\r\n  }\r\n</script>\r\n\r\n\r\n\r\n\r\n"],"sourceRoot":"src/views/buttons"}]}