{"remainingRequest":"C:\\xxm\\work\\jd\\fore\\node_modules\\babel-loader\\lib\\index.js!C:\\xxm\\work\\jd\\fore\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!C:\\xxm\\work\\jd\\fore\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\xxm\\work\\jd\\fore\\src\\views\\template\\modules\\OaTemplateModal.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\xxm\\work\\jd\\fore\\src\\views\\template\\modules\\OaTemplateModal.vue","mtime":1575945613618},{"path":"C:\\xxm\\work\\jd\\fore\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1570779194464},{"path":"C:\\xxm\\work\\jd\\fore\\node_modules\\babel-loader\\lib\\index.js","mtime":1570779245522},{"path":"C:\\xxm\\work\\jd\\fore\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1570779194464},{"path":"C:\\xxm\\work\\jd\\fore\\node_modules\\vue-loader\\lib\\index.js","mtime":1570779225726}],"contextDependencies":[],"result":["import \"core-js/modules/web.dom.iterable\";\nimport _toConsumableArray from \"C:\\\\xxm\\\\work\\\\jd\\\\fore\\\\node_modules\\\\@babel\\\\runtime-corejs2/helpers/esm/toConsumableArray\";\nimport \"core-js/modules/es6.function.name\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport { httpAction } from '@/api/manage';\nimport pick from 'lodash.pick';\nimport { getAction } from '@/api/manage';\nimport Vue from 'vue';\nimport { ACCESS_TOKEN } from '@/store/mutation-types';\nimport AFormItem from \"ant-design-vue/es/form/FormItem\";\nexport default {\n  name: \"OaTemplateModal\",\n  components: {\n    AFormItem: AFormItem\n  },\n  data: function data() {\n    return {\n      upFileName: '',\n      upFailId: 0,\n      fileId: '',\n      fileList: [],\n      uploading: false,\n      headers: {\n        'X-Access-Token': Vue.ls.get(ACCESS_TOKEN)\n      },\n      title: \"操作\",\n      visible: false,\n      model: {},\n      labelCol: {\n        xs: {\n          span: 24\n        },\n        sm: {\n          span: 5\n        }\n      },\n      wrapperCol: {\n        xs: {\n          span: 24\n        },\n        sm: {\n          span: 16\n        }\n      },\n      selectData: [],\n      confirmLoading: false,\n      form: this.$form.createForm(this),\n      validatorRules: {// iId:{rules: [{ required: true, message: '请输入主键id!' }]},\n      },\n      url: {\n        add: \"/papertitle/oaTemplate/add\",\n        edit: \"/papertitle/oaTemplate/edit\",\n        upload: '/papertitle/oaTemplate/upload'\n      }\n    };\n  },\n  created: function created() {},\n  methods: {\n    add: function add() {\n      var _this = this;\n\n      this.getSelection();\n      this.upFailId = 0;\n      this.upFileName = '';\n      this.fileUpload = window._CONFIG['domianURL'] + '/papertitle/oaTemplate/upload';\n      this.form.resetFields();\n      this.model = Object.assign({}, {});\n      this.visible = true;\n      this.$nextTick(function () {\n        _this.form.setFieldsValue(pick(_this.model, 'iid', 'itype', 'sname', 'ifileId', 'ititleRuleId', 'sremarks'));\n      });\n    },\n    edit: function edit(record) {\n      var _this2 = this;\n\n      this.getSelection();\n\n      if (record.ifileId) {\n        this.upFailId = 1;\n        this.uploading = true;\n      } else {\n        this.upFailId = 0;\n        this.uploading = false;\n      }\n\n      this.getFileNameById(record.ifileId);\n      this.fileUpload = window._CONFIG['domianURL'] + '/papertitle/oaTemplate/upload';\n      this.form.resetFields();\n      this.model = Object.assign({}, record);\n      this.visible = true;\n      this.$nextTick(function () {\n        _this2.form.setFieldsValue(pick(_this2.model, 'iid', 'itype', 'sname', 'ifileId', 'ititleRuleId', 'sremarks'));\n      });\n    },\n    getFileNameById: function getFileNameById(id) {\n      var _this3 = this;\n\n      var url = \"/papertitle/oaTemplate/getFileNameById\";\n      getAction(url, {\n        ifileId: id\n      }).then(function (res) {\n        _this3.upFileName = res.result.sfileName;\n      });\n    },\n    beforeUpload: function beforeUpload(file, fileList) {\n      this.upFailId = 1;\n      this.upFileName = file.name;\n      this.uploading = true;\n      this.fileList = [].concat(_toConsumableArray(this.fileList), [file]);\n      return false;\n    },\n    deleteFileName: function deleteFileName() {\n      var _this4 = this;\n\n      var that = this;\n      that.upFailId = 0;\n      that.upFileName = '';\n      this.model.ifileId = \"\";\n      this.$nextTick(function () {\n        _this4.form.setFieldsValue(pick(_this4.model, 'ifileId'));\n      });\n      this.uploading = false;\n    },\n    close: function close() {\n      this.upFailId = 0;\n      this.uploading = false;\n      this.$emit('close');\n      this.visible = false;\n    },\n    handleUpload: function handleUpload() {\n      var _this5 = this;\n\n      var fileList = this.fileList;\n      var data = new FormData();\n      fileList.forEach(function (file) {\n        data.append('file', file);\n      });\n      this.uploading = true;\n      var url = this.url.upload;\n      var method = 'post';\n      httpAction(url, data, method).then(function (res) {\n        _this5.fileList = [];\n        _this5.uploading = false;\n        _this5.model.ifileId = res.result.iid;\n\n        _this5.$nextTick(function () {\n          _this5.form.setFieldsValue(pick(_this5.model, 'ifileId'));\n        });\n      });\n    },\n    handleOk: function handleOk() {\n      var _this6 = this;\n\n      var that = this;\n      that.handleUpload();\n      setTimeout(function () {\n        // 触发表单验证\n        _this6.form.validateFields(function (err, values) {\n          if (!err) {\n            that.confirmLoading = true;\n            var httpurl = '';\n            var method = '';\n\n            if (!_this6.model.iid) {\n              httpurl += _this6.url.add;\n              method = 'post';\n            } else {\n              httpurl += _this6.url.edit;\n              method = 'put';\n            }\n\n            var formData = Object.assign(_this6.model, values);\n            console.log(formData);\n            httpAction(httpurl, formData, method).then(function (res) {\n              if (res.success) {\n                that.$message.success(res.message);\n                that.$emit('ok');\n              } else {\n                that.$message.warning(res.message);\n              }\n            }).finally(function () {\n              that.confirmLoading = false;\n              that.close();\n            });\n          }\n        });\n      }, 800);\n    },\n    handleCancel: function handleCancel() {\n      this.close();\n    },\n    getSelection: function getSelection() {\n      var _this7 = this;\n\n      var url = \"/papertitle/paperTitleSetting/paperTitleList\";\n      getAction(url).then(function (res) {\n        _this7.selectData = res.result;\n      });\n    },\n    handleChange: function handleChange(info) {\n      var _this8 = this;\n\n      if (info.file.status !== 'uploading') {\n        console.log(info.file, info.fileList);\n      }\n\n      if (info.file.status === 'done') {\n        if (info.file.response.success) {\n          this.upFailId = 1;\n          this.upFileName = info.file.name;\n          this.model.ifileId = info.file.response.result.iid;\n          this.$nextTick(function () {\n            _this8.form.setFieldsValue(pick(_this8.model, 'ifileId'));\n          });\n          this.$message.success(\"\".concat(info.file.name, \" \\u6587\\u4EF6\\u4E0A\\u4F20\\u6210\\u529F\"));\n        } else {\n          this.$message.error(\"\".concat(info.file.name, \" \").concat(info.file.response.message, \".\"));\n        }\n      } else if (info.file.status === 'error') {\n        this.$message.error(\"\\u6587\\u4EF6\\u4E0A\\u4F20\\u5931\\u8D25: \".concat(info.file.msg, \" \"));\n      }\n    }\n  }\n};",{"version":3,"sources":["OaTemplateModal.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\r\n  <a-modal\r\n    :title=\"title\"\r\n    :width=\"800\"\r\n    :visible=\"visible\"\r\n    :confirmLoading=\"confirmLoading\"\r\n    @ok=\"handleOk\"\r\n    @cancel=\"handleCancel\"\r\n    cancelText=\"关闭\">\r\n    \r\n    <a-spin :spinning=\"confirmLoading\">\r\n      <a-form :form=\"form\">\r\n        <a-form-item\r\n          :labelCol=\"labelCol\"\r\n          :wrapperCol=\"wrapperCol\"\r\n          label=\"模版名称\">\r\n          <a-input placeholder=\"\" v-decorator=\"['sname', {}]\" />\r\n        </a-form-item>\r\n        <a-form-item\r\n          :labelCol=\"labelCol\"\r\n          :wrapperCol=\"wrapperCol\"\r\n          label=\"稿纸头规则\">\r\n          <!--<a-input-number v-decorator=\"[ 'ititleRuleId', {}]\" />-->\r\n          <!--<a-select defaultValue=\"selected ${value}\" v-decorator=\"[ 'ititleRuleId', {}]\">-->\r\n            <!--<a-select-option value=\"0\">稿纸头列表</a-select-option>-->\r\n            <!--</a-select-option>-->\r\n          <!--</a-select>-->\r\n\r\n          <a-select\r\n            v-decorator=\"[ 'ititleRuleId', {}]\">\r\n            <a-select-option  v-for=\"(item,index) in selectData\" :key=\"index\" :value=\"item.iid\">{{item.stitleName}}</a-select-option>\r\n\r\n          </a-select>\r\n        </a-form-item>\r\n\r\n        <a-form-item\r\n          :labelCol=\"labelCol\"\r\n          :wrapperCol=\"wrapperCol\"\r\n          label=\"模版类型\">\r\n          <!--<a-input placeholder=\"\" v-decorator=\"['itype', {}]\" />-->\r\n          <a-radio-group v-model=\"value\" v-decorator=\"['itype', {}]\" >\r\n            <a-radio :value=\"1\">上报</a-radio>\r\n            <a-radio :value=\"2\">下发</a-radio>\r\n            <a-radio :value=\"3\">办文单</a-radio>\r\n          </a-radio-group>\r\n        </a-form-item>\r\n        <a-form-item\r\n          :labelCol=\"labelCol\"\r\n          :wrapperCol=\"wrapperCol\"\r\n          label=\"备注\">\r\n          <a-input placeholder=\"\" v-decorator=\"['sremarks', {}]\" />\r\n        </a-form-item>\r\n        <a-form-item\r\n          :labelCol=\"labelCol\"\r\n          :wrapperCol=\"wrapperCol\"\r\n          label=\"附件上传\">\r\n          <a-upload name=\"file\" :fileList=\"fileList\" :beforeUpload=\"beforeUpload\" :showUploadList=\"false\" :multiple=\"false\" :headers=\"headers\" @change=\"handleChange\">\r\n            <a-button :disabled=\"uploading\"><a-icon type=\"upload\" />点击上传</a-button>\r\n          </a-upload>\r\n        </a-form-item>\r\n\r\n        <a-form-item\r\n          v-if=\"upFailId === 1\"\r\n          :labelCol=\"labelCol\"\r\n          :wrapperCol=\"wrapperCol\"\r\n          label=\"附件名称\">\r\n          <a-input v-model=\"upFileName\"/>\r\n          <a-button type=\"primary\" icon=\"plus\" @click=\"deleteFileName\">删除</a-button>\r\n          <a-input v-show=\"false\"  v-model=\"fileId\" v-decorator=\"['ifileId', {}]\"/>\r\n        </a-form-item>\r\n\r\n      </a-form>\r\n    </a-spin>\r\n  </a-modal>\r\n</template>\r\n\r\n<script>\r\n  import { httpAction } from '@/api/manage'\r\n  import pick from 'lodash.pick'\r\n  import { getAction } from '@/api/manage'\r\n  import Vue from 'vue'\r\n  import {ACCESS_TOKEN} from '@/store/mutation-types'\r\n  import AFormItem from \"ant-design-vue/es/form/FormItem\";\r\n  export default {\r\n    name: \"OaTemplateModal\",\r\n    components: {AFormItem},\r\n    data () {\r\n      return {\r\n        upFileName:'',\r\n        upFailId: 0,\r\n        fileId:'',\r\n        fileList: [],\r\n        uploading: false,\r\n        headers: {\r\n          'X-Access-Token': Vue.ls.get(ACCESS_TOKEN)\r\n        },\r\n        title:\"操作\",\r\n        visible: false,\r\n        model: {},\r\n        labelCol: {\r\n          xs: { span: 24 },\r\n          sm: { span: 5 },\r\n        },\r\n        wrapperCol: {\r\n          xs: { span: 24 },\r\n          sm: { span: 16 },\r\n        },\r\n        selectData:[],\r\n        confirmLoading: false,\r\n        form: this.$form.createForm(this),\r\n        validatorRules:{\r\n        // iId:{rules: [{ required: true, message: '请输入主键id!' }]},\r\n        },\r\n        url: {\r\n          add: \"/papertitle/oaTemplate/add\",\r\n          edit: \"/papertitle/oaTemplate/edit\",\r\n          upload:'/papertitle/oaTemplate/upload'\r\n        },\r\n      }\r\n    },\r\n    created(){\r\n    },\r\n    methods: {\r\n      add () {\r\n        this.getSelection();\r\n        this.upFailId = 0;\r\n        this.upFileName = '';\r\n        this.fileUpload = window._CONFIG['domianURL'] +'/papertitle/oaTemplate/upload';\r\n        this.form.resetFields();\r\n        this.model = Object.assign({}, {});\r\n        this.visible = true;\r\n        this.$nextTick(() => {\r\n          this.form.setFieldsValue(pick(this.model,'iid','itype','sname','ifileId','ititleRuleId','sremarks'))\r\n        });\r\n\r\n      },\r\n      edit (record) {\r\n        this.getSelection();\r\n        if (record.ifileId){\r\n          this.upFailId = 1;\r\n          this.uploading = true;\r\n        } else {\r\n          this.upFailId = 0;\r\n          this.uploading = false;\r\n        }\r\n        this.getFileNameById(record.ifileId);\r\n        this.fileUpload = window._CONFIG['domianURL'] +'/papertitle/oaTemplate/upload';\r\n        this.form.resetFields();\r\n        this.model = Object.assign({}, record);\r\n        this.visible = true;\r\n        this.$nextTick(() => {\r\n          this.form.setFieldsValue(pick(this.model,'iid','itype','sname','ifileId','ititleRuleId','sremarks'))\r\n        });\r\n      },\r\n      getFileNameById(id){\r\n        let url = \"/papertitle/oaTemplate/getFileNameById\";\r\n        getAction(url,{ifileId:id}).then((res)=>{\r\n          this.upFileName = res.result.sfileName;\r\n        })\r\n      },\r\n      beforeUpload:function(file,fileList){\r\n        this.upFailId = 1;\r\n        this.upFileName = file.name;\r\n        this.uploading = true;\r\n        this.fileList = [...this.fileList, file];\r\n        return false;\r\n      },\r\n      deleteFileName(){\r\n        let  that = this;\r\n        that.upFailId = 0;\r\n        that.upFileName = '';\r\n        this.model.ifileId = \"\";\r\n        this.$nextTick(() => {\r\n          this.form.setFieldsValue(pick(this.model, 'ifileId'))\r\n        });\r\n        this.uploading = false;\r\n      },\r\n      close () {\r\n        this.upFailId = 0;\r\n        this.uploading = false;\r\n        this.$emit('close');\r\n        this.visible = false;\r\n      },\r\n\r\n      handleUpload() {\r\n        const { fileList } = this;\r\n        const data = new FormData();\r\n        fileList.forEach(file => {\r\n          data.append('file', file);\r\n        });\r\n        this.uploading = true;\r\n        let url = this.url.upload;\r\n        let method = 'post';\r\n\r\n        httpAction(url,data,method).then((res)=>{\r\n          this.fileList = [];\r\n          this.uploading = false;\r\n          this.model.ifileId = res.result.iid;\r\n          this.$nextTick(() => {\r\n            this.form.setFieldsValue(pick(this.model, 'ifileId'))\r\n          });\r\n        });\r\n      },\r\n      handleOk () {\r\n        const that = this;\r\n        that.handleUpload();\r\n       setTimeout(()=>{\r\n         // 触发表单验证\r\n         this.form.validateFields((err, values) => {\r\n           if (!err) {\r\n             that.confirmLoading = true;\r\n             let httpurl = '';\r\n             let method = '';\r\n             if(!this.model.iid){\r\n               httpurl+=this.url.add;\r\n               method = 'post';\r\n             }else{\r\n               httpurl+=this.url.edit;\r\n               method = 'put';\r\n             }\r\n\r\n             let formData = Object.assign(this.model, values);\r\n             console.log( formData);\r\n             httpAction(httpurl,formData,method).then((res)=>{\r\n               if(res.success){\r\n                 that.$message.success(res.message);\r\n                 that.$emit('ok');\r\n               }else{\r\n                 that.$message.warning(res.message);\r\n               }\r\n             }).finally(() => {\r\n               that.confirmLoading = false;\r\n               that.close();\r\n             })\r\n\r\n\r\n\r\n           }\r\n         })\r\n       },800)\r\n      },\r\n      handleCancel () {\r\n        this.close()\r\n      },\r\n      getSelection(){\r\n        let url = \"/papertitle/paperTitleSetting/paperTitleList\";\r\n        getAction(url).then((res)=>{\r\n          this.selectData = res.result;\r\n        })\r\n      },\r\n      handleChange(info){\r\n        if (info.file.status !== 'uploading'){\r\n          console.log(info.file,info.fileList);\r\n        }\r\n        if (info.file.status === 'done') {\r\n          if (info.file.response.success) {\r\n            this.upFailId = 1;\r\n            this.upFileName = info.file.name;\r\n            this.model.ifileId = info.file.response.result.iid;\r\n            this.$nextTick(() => {\r\n              this.form.setFieldsValue(pick(this.model, 'ifileId'))\r\n            });\r\n            this.$message.success(`${info.file.name} 文件上传成功`);\r\n          }else {\r\n            this.$message.error(`${info.file.name} ${info.file.response.message}.`);\r\n          }\r\n        }else if (info.file.status ==='error'){\r\n          this.$message.error(`文件上传失败: ${info.file.msg} `);\r\n        }\r\n\r\n      }\r\n    }\r\n  }\r\n</script>\r\n\r\n<style lang=\"less\" scoped>\r\n\r\n</style>"],"sourceRoot":"src/views/template/modules"}]}