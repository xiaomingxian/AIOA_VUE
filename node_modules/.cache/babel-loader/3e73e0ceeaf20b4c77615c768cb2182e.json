{"remainingRequest":"C:\\xxm\\work\\jd\\fore\\node_modules\\babel-loader\\lib\\index.js!C:\\xxm\\work\\jd\\fore\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!C:\\xxm\\work\\jd\\fore\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\xxm\\work\\jd\\fore\\src\\views\\mytask\\JumpList.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\xxm\\work\\jd\\fore\\src\\views\\mytask\\JumpList.vue","mtime":1578638838667},{"path":"C:\\xxm\\work\\jd\\fore\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1570779194464},{"path":"C:\\xxm\\work\\jd\\fore\\node_modules\\babel-loader\\lib\\index.js","mtime":1570779245522},{"path":"C:\\xxm\\work\\jd\\fore\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1570779194464},{"path":"C:\\xxm\\work\\jd\\fore\\node_modules\\vue-loader\\lib\\index.js","mtime":1570779225726}],"contextDependencies":[],"result":["import \"core-js/modules/es6.function.name\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport Vue from 'vue';\nimport { JeecgListMixin } from '@/mixins/JeecgListMixin';\nimport { ACCESS_TOKEN } from \"../../store/mutation-types\";\nimport { getAction, postAction } from \"../../api/manage\";\nimport pic2Modal from \"./modules/pic2Modal\"; //业务页面\n\nimport detailFile from \"./taskList/detailFile\";\nimport backModal from \"./modules/backModal\";\nexport default {\n  name: \"taskToDo\",\n  mixins: [JeecgListMixin],\n  components: {\n    pic2Modal: pic2Modal,\n    //业务\n    detailFile: detailFile,\n    backModal: backModal\n  },\n  data: function data() {\n    var _this = this;\n\n    return {\n      headers: {\n        'X-Access-Token': Vue.ls.get(ACCESS_TOKEN)\n      },\n      description: '待办任务',\n      datasource: [],\n      // 表头\n      columns: [{\n        title: '序号',\n        dataIndex: '',\n        key: 'rowIndex',\n        width: 60,\n        align: \"center\",\n        customRender: function customRender(t, r, index) {\n          return parseInt(index) + 1;\n        }\n      }, {\n        title: '文号',\n        width: 100,\n        sorter: function sorter(i, ii, type) {\n          _this.queryParam.tableOrder = true;\n\n          _this.nullOther('orederByWenHao');\n\n          _this.queryParam.orederByWenHao = type == 'descend' ? -1 : 1;\n          return true;\n        },\n        align: \"center\",\n        dataIndex: 'wenHao'\n      }, {\n        title: '标题',\n        width: 350,\n        sorter: function sorter(i, ii, type) {\n          //descend倒叙\n          //ascend正序\n          _this.queryParam.tableOrder = true; //置空其他环节\n\n          _this.nullOther('orederByTile');\n\n          _this.queryParam.orederByTile = type == 'descend' ? -1 : 1;\n          return true;\n        },\n        align: \"left\",\n        dataIndex: 'title'\n      }, {\n        title: '当前环节',\n        sorter: function sorter(i, ii, type) {\n          _this.queryParam.tableOrder = true;\n\n          _this.nullOther('orederByHuanJie');\n\n          _this.queryParam.orederByHuanJie = type == 'descend' ? -1 : 1;\n          return true;\n        },\n        align: \"center\",\n        dataIndex: 'name'\n      }, {\n        title: '拟稿人',\n        sorter: function sorter(i, ii, type) {\n          _this.queryParam.tableOrder = true;\n\n          _this.nullOther('orederByDrafter');\n\n          _this.queryParam.orederByDrafter = type == 'descend' ? -1 : 1;\n          return true;\n        },\n        align: \"center\",\n        dataIndex: 'drafter'\n      }, {\n        title: '转发时间',\n        sorter: function sorter(i, ii, type) {\n          _this.queryParam.tableOrder = true;\n\n          _this.nullOther('orederByTime');\n\n          _this.queryParam.orederByTime = type == 'descend' ? -1 : 1;\n          return true;\n        },\n        align: \"center\",\n        dataIndex: 'createTime'\n      }, {\n        title: '操作',\n        dataIndex: 'action',\n        align: \"center\",\n        scopedSlots: {\n          customRender: 'action'\n        }\n      }],\n      url: {\n        list: \"/wf/task/queryTask?operstatus=jump\",\n        busDataAndColums: 'oaBus/oaBusdata/queryBusdataById',\n        yewuDataQuery: \"/oaBus/dynamic/query\",\n        actShowQuery: '/oaBus/busPage/queryActShowByPageRef',\n        batchEnd: '/wf/task/batchEnd',\n        batchPiYue: '/wf/task/batchPiYue',\n        currentUnDo: '/wf/task/queryTaskUnDoCurrent',\n        showBackAct: '/wf/task/showBackAct' //展示回退/跳转 节点\n\n      },\n      startTimeFake: null,\n      endTimeFake: null,\n      taskType: null\n    };\n  },\n  computed: {\n    importExcelUrl: function importExcelUrl() {\n      return \"\".concat(window._CONFIG['domianURL'], \"/\").concat(this.url.importExcelUrl);\n    }\n  },\n  methods: {\n    //清空其他排序条件\n    nullOther: function nullOther(type) {\n      var orderColums = ['orederByWenHao', 'orederByTile', 'orederByHuanJie', 'orederByDrafter', 'orederByTime'];\n\n      for (var i in orderColums) {\n        if (i != type) {\n          this.queryParam[orderColums[i]] = undefined;\n        }\n      }\n    },\n    jump: function jump(record) {\n      var _this2 = this;\n\n      // var text = type == 'all' ? '跳转' : '回退'\n      getAction(this.url.showBackAct, {\n        processDefinitionId: record.processDefinitionId,\n        type: 'all',\n        processInstanceId: record.processInstanceId,\n        taskDefinitionKey: record.taskDefinitionKey\n      }).then(function (res) {\n        if (res.success) {\n          if (res.result.length <= 0) {\n            _this2.$message.error('没有可' + text + '节点');\n\n            return;\n          }\n\n          _this2.$refs.backModal.dataSource = res.result; // this.$refs.backModal.taskMsg = this.taskMsg\n\n          _this2.$refs.backModal.taskMsg = record;\n          _this2.$refs.backModal.title = '流程重置';\n\n          _this2.$refs.backModal.show();\n        } else {\n          _this2.$message.error(res.message);\n        }\n      });\n    },\n    unDo: function unDo(record) {\n      var _this3 = this;\n\n      var procInstId = record.processInstanceId;\n      getAction(this.url.currentUnDo, {\n        procInstId: procInstId\n      }).then(function (res) {\n        if (res.success) {\n          var h = _this3.$createElement;\n          var content = [];\n\n          for (var i in res.result) {\n            var msg = res.result[i];\n            content.push(h('p', \"\\u3010\".concat(msg.taskDefName, \"\\u3011 \").concat(msg.deptName, \" \\uFF1A\").concat(msg.userName)));\n          }\n\n          var content_ = h('div', {}, content);\n\n          var modal = _this3.$success({\n            title: '未办理信息',\n            content: content_\n          });\n        } else {\n          _this3.$message.error(res.message);\n        }\n      });\n    },\n    //类型选择\n    taskTypeChange: function taskTypeChange(type) {\n      if (type != '全部') {\n        this.queryParam.isDept = true;\n        this.queryParam.deptType = type;\n      } else {\n        this.queryParam.isDept = false;\n      }\n    },\n    searchQueryMy: function searchQueryMy() {\n      this.queryParam.tableOrder = false;\n      this.searchQuery();\n      this.selectionRows = [];\n      this.selectedRowKeys = [];\n    },\n    searchResetMy: function searchResetMy() {\n      this.queryParam.tableOrder = false;\n      this.searchReset();\n      this.startTimeFake = null;\n      this.endTimeFake = null;\n      this.taskType = null;\n      this.queryParam.isDept = false;\n    },\n    endTimeChange: function endTimeChange(a, time) {\n      this.queryParam.endQueryTime = time;\n    },\n    startTimeChange: function startTimeChange(a, time) {\n      console.log('-------------------------', time);\n      this.queryParam.startQueryTime = time;\n    },\n    reload: function reload() {\n      var _this4 = this;\n\n      this.loading = true;\n      getAction(this.url.list).then(function (res) {\n        if (res.success) {\n          _this4.dataSource = res.result.records;\n          _this4.ipagination.total = res.result.total;\n        }\n\n        if (res.code === 510) {\n          _this4.$message.warning(res.message);\n        }\n\n        _this4.loading = false;\n      });\n    },\n    cancel: function cancel() {\n      console.log('------->取消选择');\n    },\n    showPic: function showPic(record) {\n      this.$refs.pic2Modal.show(record);\n      this.$refs.pic2Modal.title = '当前环节';\n    },\n    //批量办结\n    batchEnd: function batchEnd() {\n      var _this5 = this;\n\n      var ids = [];\n\n      for (var i in this.selectionRows) {\n        if (this.selectionRows[i].processInstanceId != undefined) {\n          ids.push(this.selectionRows[i].processInstanceId);\n        }\n      }\n\n      var param = {\n        ids: ids\n      };\n      postAction(this.url.batchEnd, param).then(function (res) {\n        if (res.success) {\n          _this5.$message.success(res.message);\n\n          _this5.reload();\n        } else {\n          _this5.$message.error(res.message);\n        }\n      });\n    },\n    batchPiYue: function batchPiYue() {\n      var _this6 = this;\n\n      var data = [];\n\n      for (var i in this.selectionRows) {\n        if (this.selectionRows[i].id != undefined) {\n          var d = this.selectionRows[i];\n          var v = {\n            table: d.table + '_opinion',\n            i_busdata_id: d.tableId,\n            s_opinion_type: 4,\n            s_task_id: d.id,\n            s_task_name: d.name,\n            s_overt: 0,\n            s_taskdef_key: d.taskDefinitionKey\n          };\n          data.push();\n        }\n      }\n\n      postAction(this.url.batchPiYue, data).then(function (res) {\n        if (res.success) {\n          _this6.$message.success(res.message);\n\n          _this6.reload();\n        } else {\n          _this6.$message.error(res.message);\n        }\n      });\n    },\n    doTask: function doTask(record, index) {\n      var _this7 = this;\n\n      return {\n        on: {\n          click: function click(event) {\n            var taskDetail = {\n              tableName: record.table,\n              busdataId: record.tableId,\n              haveTask: true,\n              task: record\n            };\n\n            _this7.$router.push({\n              path: '/mytask/taskList/Test-detailFile',\n              query: taskDetail\n            }); // this.$refs.detailFile.showTaskInAct(taskDetail, record)\n\n          }\n        }\n      };\n    }\n  },\n  created: function created() {\n    //默认不带部门类型\n    this.queryParam.isDept = false;\n  }\n};",{"version":3,"sources":["JumpList.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\r\n  <a-card :bordered=\"false\">\r\n\r\n    <!-- 查询区域 -->\r\n    <div class=\"table-page-search-wrapper\">\r\n      <a-form layout=\"inline\">\r\n        <a-row :gutter=\"24\">\r\n          <a-col :md=\"6\" :sm=\"8\">\r\n            <a-form-item label=\"标题\">\r\n              <a-input placeholder=\"标题\" v-model=\"queryParam.dataTitle\"></a-input>\r\n            </a-form-item>\r\n          </a-col>\r\n          <a-col :md=\"6\" :sm=\"8\">\r\n            <a-form-item label=\"文件字号\">\r\n              <a-input placeholder=\"文件字号\" v-model=\"queryParam.fileNum\"></a-input>\r\n            </a-form-item>\r\n          </a-col>\r\n          <a-col :md=\"6\" :sm=\"8\">\r\n            <a-form-item label=\"拟稿人\">\r\n              <a-input placeholder=\"拟稿人\" v-model=\"queryParam.createName\"></a-input>\r\n            </a-form-item>\r\n          </a-col>\r\n\r\n\r\n          <template v-if=\"toggleSearchStatus\">\r\n            <a-col :md=\"6\" :sm=\"8\">\r\n\r\n              <a-form-item label=\"任务类型\">\r\n                <a-select style=\"width: 150px\" @change=\"taskTypeChange\" v-model=\"taskType\">\r\n                  <a-select-option value=\"全部\">全部</a-select-option>\r\n                  <a-select-option value=\"传阅\">传阅</a-select-option>\r\n                  <a-select-option value=\"主办\">主办</a-select-option>\r\n                  <a-select-option value=\"辅办\">辅办</a-select-option>\r\n                </a-select>\r\n              </a-form-item>\r\n            </a-col>\r\n            <a-col :md=\"6\" :sm=\"8\">\r\n              <a-form-item label=\"主办部门\">\r\n                <a-input placeholder=\"主办部门\" v-model=\"queryParam.mainDept\"></a-input>\r\n              </a-form-item>\r\n            </a-col>\r\n\r\n            <a-col :md=\"6\" :sm=\"8\">\r\n              <a-form-item label=\"开始时间\">\r\n                <a-date-picker showTime format=\"YYYY-MM-DD HH:mm:ss\" placeholder=\"请选择开始时间\"\r\n                               v-model='startTimeFake' @change=\"startTime\"/>\r\n              </a-form-item>\r\n            </a-col>\r\n            <a-col :md=\"6\" :sm=\"8\">\r\n              <a-form-item label=\"结束时间\">\r\n                <a-date-picker showTime format=\"YYYY-MM-DD HH:mm:ss\" placeholder=\"请选择结束时间\"\r\n                               v-model='endTimeFake' @change=\"endTime\"/>\r\n              </a-form-item>\r\n            </a-col>\r\n\r\n\r\n          </template>\r\n\r\n\r\n          <a-col :md=\"6\" :sm=\"8\">\r\n            <span style=\"float: left;overflow: hidden;\" class=\"table-page-search-submitButtons\">\r\n              <a-button type=\"primary\" ref=\"reSearchQuery\" @click=\"searchQueryMy\" icon=\"search\">查询</a-button>\r\n              <a-button type=\"primary\" @click=\"searchResetMy\" icon=\"reload\" style=\"margin-left: 8px\">重置</a-button>\r\n              <a @click=\"handleToggleSearch\" style=\"margin-left: 8px\">\r\n                {{ toggleSearchStatus ? '收起' : '展开' }}\r\n                <a-icon :type=\"toggleSearchStatus ? 'up' : 'down'\"/>\r\n              </a>\r\n            </span>\r\n          </a-col>\r\n\r\n        </a-row>\r\n      </a-form>\r\n    </div>\r\n\r\n    <!-- 操作按钮区域 -->\r\n    <div class=\"table-operator\">\r\n      <a-dropdown v-if=\"selectedRowKeys.length > 0\">\r\n        <a-menu slot=\"overlay\">\r\n          <!--<a-menu-item key=\"1\" @click=\"batchEnd\">-->\r\n          <!--<a-icon type=\"delete\"/>-->\r\n          <!--批量办结-->\r\n          <!--</a-menu-item>-->\r\n          <a-menu-item v-if=\"(url.list=='/wf/task/queryTask?operstatus=my_chuanyue') \"\r\n                       key=\"1\" @click=\"batchPiYue\">\r\n            <a-icon type=\"delete\"/>\r\n            批量批阅\r\n          </a-menu-item>\r\n        </a-menu>\r\n\r\n        <a-button style=\"margin-left: 8px\"> 批量操作\r\n          <a-icon type=\"down\"/>\r\n        </a-button>\r\n      </a-dropdown>\r\n\r\n    </div>\r\n\r\n    <!-- table区域-begin -->\r\n    <div>\r\n\r\n      <div class=\"ant-alert ant-alert-info\" style=\"margin-bottom: 16px;\">\r\n        <i class=\"anticon anticon-info-circle ant-alert-icon\"></i> 已选择 <a style=\"font-weight: 600\">{{\r\n        selectedRowKeys.length }}</a>项\r\n        <a style=\"margin-left: 24px\" @click=\"onClearSelected\">清空</a>\r\n      </div>\r\n\r\n      <a-table\r\n        ref=\"table\"\r\n        size=\"middle\"\r\n        bordered\r\n        rowKey=\"processInstanceId\"\r\n        :columns=\"columns\"\r\n        :dataSource=\"dataSource\"\r\n        :pagination=\"ipagination\"\r\n        :loading=\"loading\"\r\n        :rowSelection=\"{selectedRowKeys: selectedRowKeys, onChange: onSelectChange}\"\r\n        @change=\"handleTableChange\"\r\n        :customRow=\"doTask\"\r\n        :rowClassName=\"(record,index) => {\r\n              let className  = 'light-row';\r\n              if (index % 2 === 1) className = 'dark-row';\r\n              return className;\r\n          }\"\r\n      >\r\n\r\n        <span slot=\"action\" slot-scope=\"text, record\">\r\n\r\n          <a @click.stop=\"jump(record)\">重置流程</a>\r\n          <br>\r\n          <!--<a-divider type=\"vertical\"/>-->\r\n          <!--<a @click.stop=\"unDo(record)\">未办理信息</a>-->\r\n          <!--<br>-->\r\n          <!--<a-divider type=\"vertical\"/>-->\r\n          <a @click.stop=\"showPic(record)\">查看流程图</a>\r\n\r\n        </span>\r\n\r\n      </a-table>\r\n    </div>\r\n    <!-- table区域-end -->\r\n\r\n    <!-- 表单区域 -->\r\n    <pic2-modal ref=\"pic2Modal\" @ok=\"modalFormOk\"></pic2-modal>\r\n    <new-task-modal ref=\"newTask\"></new-task-modal>\r\n\r\n\r\n    <!--业务页面-->\r\n    <detail-file ref=\"detailFile\"></detail-file>\r\n    <back-modal ref=\"backModal\"></back-modal>\r\n\r\n\r\n  </a-card>\r\n</template>\r\n\r\n<script>\r\n  import Vue from 'vue'\r\n  import {JeecgListMixin} from '@/mixins/JeecgListMixin'\r\n  import {ACCESS_TOKEN} from \"../../store/mutation-types\";\r\n  import {getAction, postAction} from \"../../api/manage\";\r\n  import pic2Modal from './modules/pic2Modal'\r\n  //业务页面\r\n  import detailFile from './taskList/detailFile'\r\n  import backModal from './modules/backModal'\r\n\r\n\r\n  export default {\r\n    name: \"taskToDo\",\r\n    mixins: [JeecgListMixin],\r\n    components: {\r\n      pic2Modal,\r\n      //业务\r\n      detailFile,\r\n      backModal\r\n    },\r\n    data() {\r\n      return {\r\n        headers: {'X-Access-Token': Vue.ls.get(ACCESS_TOKEN)},\r\n        description: '待办任务',\r\n        datasource: [],\r\n        // 表头\r\n        columns: [\r\n          {\r\n            title: '序号',\r\n            dataIndex: '',\r\n            key: 'rowIndex',\r\n            width: 60,\r\n            align: \"center\",\r\n            customRender: function (t, r, index) {\r\n              return parseInt(index) + 1;\r\n            }\r\n          },\r\n          {\r\n            title: '文号',\r\n            width: 100,\r\n            sorter: (i, ii, type) => {\r\n\r\n              this.queryParam.tableOrder = true\r\n              this.nullOther('orederByWenHao')\r\n\r\n              this.queryParam.orederByWenHao = type == 'descend' ? -1 : 1;\r\n              return true\r\n            },\r\n            align: \"center\",\r\n            dataIndex: 'wenHao'\r\n          },\r\n          {\r\n            title: '标题',\r\n            width: 350,\r\n            sorter: (i, ii, type) => {\r\n              //descend倒叙\r\n              //ascend正序\r\n\r\n              this.queryParam.tableOrder = true\r\n              //置空其他环节\r\n              this.nullOther('orederByTile')\r\n              this.queryParam.orederByTile = type == 'descend' ? -1 : 1;\r\n              return true\r\n            },\r\n            align: \"left\",\r\n            dataIndex: 'title'\r\n          },\r\n          {\r\n            title: '当前环节',\r\n            sorter: (i, ii, type) => {\r\n              this.queryParam.tableOrder = true\r\n              this.nullOther('orederByHuanJie')\r\n\r\n              this.queryParam.orederByHuanJie = type == 'descend' ? -1 : 1\r\n              return true\r\n            },\r\n            align: \"center\",\r\n            dataIndex: 'name'\r\n          },\r\n          {\r\n            title: '拟稿人',\r\n            sorter: (i, ii, type) => {\r\n              this.queryParam.tableOrder = true\r\n              this.nullOther('orederByDrafter')\r\n\r\n              this.queryParam.orederByDrafter = type == 'descend' ? -1 : 1;\r\n              return true\r\n            },\r\n            align: \"center\",\r\n            dataIndex: 'drafter'\r\n          },\r\n          {\r\n            title: '转发时间',\r\n            sorter: (i, ii, type) => {\r\n              this.queryParam.tableOrder = true\r\n              this.nullOther('orederByTime')\r\n\r\n              this.queryParam.orederByTime = type == 'descend' ? -1 : 1;\r\n              return true\r\n            },\r\n            align: \"center\",\r\n            dataIndex: 'createTime'\r\n          },\r\n          {\r\n            title: '操作',\r\n            dataIndex: 'action',\r\n            align: \"center\",\r\n            scopedSlots: {customRender: 'action'},\r\n          }\r\n        ],\r\n        url: {\r\n          list: \"/wf/task/queryTask?operstatus=jump\",\r\n          busDataAndColums: 'oaBus/oaBusdata/queryBusdataById',\r\n          yewuDataQuery: \"/oaBus/dynamic/query\",\r\n          actShowQuery: '/oaBus/busPage/queryActShowByPageRef',\r\n          batchEnd: '/wf/task/batchEnd',\r\n          batchPiYue: '/wf/task/batchPiYue',\r\n          currentUnDo: '/wf/task/queryTaskUnDoCurrent',\r\n          showBackAct: '/wf/task/showBackAct',//展示回退/跳转 节点\r\n\r\n        },\r\n        startTimeFake: null,\r\n        endTimeFake: null,\r\n        taskType: null,\r\n      }\r\n    },\r\n    computed: {\r\n      importExcelUrl: function () {\r\n        return `${window._CONFIG['domianURL']}/${this.url.importExcelUrl}`;\r\n      }\r\n    },\r\n    methods: {\r\n      //清空其他排序条件\r\n      nullOther(type) {\r\n        let orderColums = ['orederByWenHao', 'orederByTile', 'orederByHuanJie', 'orederByDrafter', 'orederByTime']\r\n        for (let i in orderColums) {\r\n          if (i != type) {\r\n            this.queryParam[orderColums[i]] = undefined\r\n          }\r\n        }\r\n      },\r\n      jump(record) {\r\n        // var text = type == 'all' ? '跳转' : '回退'\r\n\r\n        getAction(this.url.showBackAct,\r\n          {\r\n            processDefinitionId: record.processDefinitionId,\r\n            type: 'all',\r\n            processInstanceId: record.processInstanceId,\r\n            taskDefinitionKey: record.taskDefinitionKey\r\n          }\r\n        ).then(res => {\r\n          if (res.success) {\r\n            if (res.result.length <= 0) {\r\n              this.$message.error('没有可' + text + '节点')\r\n              return\r\n            }\r\n            this.$refs.backModal.dataSource = res.result\r\n            // this.$refs.backModal.taskMsg = this.taskMsg\r\n            this.$refs.backModal.taskMsg = record\r\n            this.$refs.backModal.title = '流程重置'\r\n            this.$refs.backModal.show()\r\n          } else {\r\n            this.$message.error(res.message)\r\n          }\r\n\r\n        })\r\n\r\n      },\r\n\r\n      unDo(record) {\r\n        let procInstId = record.processInstanceId\r\n        getAction(this.url.currentUnDo, {\r\n          procInstId: procInstId\r\n        }).then(res => {\r\n          if (res.success) {\r\n\r\n            const h = this.$createElement;\r\n            let content = []\r\n            for (let i in res.result) {\r\n              let msg = res.result[i]\r\n              content.push(h('p', `【${msg.taskDefName}】 ${msg.deptName} ：${msg.userName}`))\r\n            }\r\n\r\n            let content_ = h('div', {}, content)\r\n\r\n            const modal = this.$success({\r\n              title: '未办理信息',\r\n              content: content_,\r\n            });\r\n          } else {\r\n            this.$message.error(res.message)\r\n          }\r\n        })\r\n\r\n\r\n      },\r\n      //类型选择\r\n      taskTypeChange(type) {\r\n        if (type != '全部') {\r\n          this.queryParam.isDept = true\r\n          this.queryParam.deptType = type\r\n        } else {\r\n          this.queryParam.isDept = false\r\n        }\r\n      },\r\n      searchQueryMy() {\r\n        this.queryParam.tableOrder = false\r\n\r\n        this.searchQuery()\r\n        this.selectionRows = []\r\n        this.selectedRowKeys = []\r\n      },\r\n      searchResetMy() {\r\n        this.queryParam.tableOrder = false\r\n\r\n        this.searchReset()\r\n        this.startTimeFake = null\r\n        this.endTimeFake = null\r\n        this.taskType = null\r\n        this.queryParam.isDept = false\r\n      },\r\n      endTimeChange(a, time) {\r\n        this.queryParam.endQueryTime = time\r\n      },\r\n      startTimeChange(a, time) {\r\n        console.log('-------------------------', time)\r\n        this.queryParam.startQueryTime = time\r\n      },\r\n      reload() {\r\n        this.loading = true;\r\n        getAction(this.url.list).then((res) => {\r\n          if (res.success) {\r\n            this.dataSource = res.result.records;\r\n            this.ipagination.total = res.result.total;\r\n          }\r\n          if (res.code === 510) {\r\n            this.$message.warning(res.message)\r\n          }\r\n          this.loading = false;\r\n        })\r\n      },\r\n      cancel() {\r\n        console.log('------->取消选择')\r\n      },\r\n      showPic(record) {\r\n        this.$refs.pic2Modal.show(record)\r\n        this.$refs.pic2Modal.title = '当前环节'\r\n      },\r\n      //批量办结\r\n      batchEnd() {\r\n\r\n        var ids = []\r\n        for (let i in this.selectionRows) {\r\n          if (this.selectionRows[i].processInstanceId != undefined) {\r\n            ids.push(this.selectionRows[i].processInstanceId)\r\n          }\r\n        }\r\n        var param = {ids: ids}\r\n\r\n        postAction(this.url.batchEnd, param).then(res => {\r\n          if (res.success) {\r\n            this.$message.success(res.message)\r\n            this.reload()\r\n          } else {\r\n            this.$message.error(res.message)\r\n          }\r\n        })\r\n\r\n      },\r\n      batchPiYue() {\r\n        var data = []\r\n        for (let i in this.selectionRows) {\r\n          if (this.selectionRows[i].id != undefined) {\r\n            let d = this.selectionRows[i]\r\n            let v = {\r\n              table: d.table + '_opinion',\r\n              i_busdata_id: d.tableId,\r\n              s_opinion_type: 4,\r\n              s_task_id: d.id,\r\n              s_task_name: d.name,\r\n              s_overt: 0,\r\n              s_taskdef_key: d.taskDefinitionKey,\r\n            }\r\n            data.push()\r\n          }\r\n        }\r\n\r\n\r\n        postAction(this.url.batchPiYue, data).then(res => {\r\n          if (res.success) {\r\n            this.$message.success(res.message)\r\n            this.reload()\r\n          } else {\r\n            this.$message.error(res.message)\r\n          }\r\n        })\r\n\r\n      },\r\n      doTask(record, index) {\r\n\r\n        return {\r\n          on: {\r\n            click: (event) => {\r\n              let taskDetail = {\r\n                tableName: record.table,\r\n                busdataId: record.tableId,\r\n                haveTask: true,\r\n                task: record\r\n              }\r\n              this.$router.push({path: '/mytask/taskList/Test-detailFile', query: taskDetail})\r\n              // this.$refs.detailFile.showTaskInAct(taskDetail, record)\r\n            }\r\n          }\r\n        }\r\n\r\n\r\n      },\r\n    },\r\n    created() {\r\n      //默认不带部门类型\r\n      this.queryParam.isDept = false\r\n\r\n    }\r\n\r\n  }\r\n</script>\r\n<style scoped>\r\n  /*@import '~@assets/less/common.less'*/\r\n  /deep/ .ant-table-middle .ant-table-tbody > tr:hover {\r\n    cursor: pointer;\r\n  }\r\n</style>"],"sourceRoot":"src/views/mytask"}]}