{"remainingRequest":"C:\\xxm\\work\\jd\\fore\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\xxm\\work\\jd\\fore\\src\\views\\system\\SysUserManagedeptsList.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\xxm\\work\\jd\\fore\\src\\views\\system\\SysUserManagedeptsList.vue","mtime":1578037562389},{"path":"C:\\xxm\\work\\jd\\fore\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1570779194464},{"path":"C:\\xxm\\work\\jd\\fore\\node_modules\\babel-loader\\lib\\index.js","mtime":1570779245522},{"path":"C:\\xxm\\work\\jd\\fore\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1570779194464},{"path":"C:\\xxm\\work\\jd\\fore\\node_modules\\vue-loader\\lib\\index.js","mtime":1570779225726}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\n  import sysUserManagedeptsModal from './modules/SysUserManagedeptsModal'\n  import { JeecgListMixin } from '@/mixins/JeecgListMixin'\n  import { httpAction,getAction,postAction } from '@/api/manage'\n  import departWindow from './modules/SelectDepartWindow'\n\n  export default {\n    name: \"sysUserManagedeptsList\",\n    mixins:[JeecgListMixin],\n    components: {\n      sysUserManagedeptsModal,\n      departWindow,\n    },\n    data () {\n      return {\n        queryParam:{\n          deptName:'',\n      },\n        description: '分管领导部门管理管理页面',\n        username:'',\n        checkedDepartKeys:[],\n        selectedDepartKeys:[], //保存用户选择部门id\n        departIdList:[],\n        deptName:'',\n        userId:'',\n        ipagination: {\n          current: 1,\n          pageSize: 10,\n          pageSizeOptions: ['10', '20', '30'],\n          showTotal: (total, range) => {\n            return range[0] + \"-\" + range[1] + \" 共\" + total + \"条\"\n          },\n          showQuickJumper: true,\n          showSizeChanger: true,\n          total: 0\n        },\n        // 表头\n        columns: [\n          {\n            title: '用户账号',\n            align:\"center\",\n            dataIndex: 'username'\n          },\n          {\n            title: '机构名称',\n            align:\"center\",\n            dataIndex: 'deptName'\n          },\n          {\n            title: '操作',\n            dataIndex: 'action',\n            align:\"center\",\n            scopedSlots: { customRender: 'action' },\n          }\n        ],\n\t\turl: {\n          list: \"/sys/sysUserManagedepts/list\",\n          add: \"/sys/sysUserManagedepts/add\",\n          delete: \"/sys/sysUserManagedepts/delete\",\n          queryById: \"/sys/sysUserManagedepts/queryById\",\n          deleteList:\"/sys/sysUserManagedepts/deleteList\",\n       },\n        showFunPer: false,\n    }\n  },\n  computed: {\n    importExcelUrl: function(){\n      return `${window._CONFIG['domianURL']}/${this.url.importExcelUrl}`;\n    }\n  },\n    methods: {\n      config(username) {\n        console.log(\"----------------\")\n        console.log(username)\n        this.showFunPer = true;\n        this.username=username;\n        this.loadData1();\n        /*getAction(this.url.list, {username: username}).then((res) => {\n          console.log(\"-------------\");\n          console.log(res.result);\n          this.dataSource = res.result.records;\n        })*/\n      },\n      modalFormOk(){\n        this.loadData1();\n      },\n      handleOk() {\n        this.showFunPer = false;\n      },\n      handleCancle() {\n        this.showFunPer = false;\n      },\n      partData(formData){\n        console.log(\"^^^^^^^^^^^^^^^^^^^^^\")\n        console.log(formData);\n        this.selectedDepartKeys = [];\n          for (let i = 0; i < formData.length; i++) {\n          this.selectedDepartKeys.push(formData[i].key);\n        }\n        console.log(this.selectedDepartKeys)\n        this.departIdList = this.selectedDepartKeys;\n        this.checkedDepartKeys = this.selectedDepartKeys;  //更新当前的选择keys\n\n        postAction(this.url.add,{userId:this.userId,departId:this.departIdList}).then(res=>{\n          if(res.success){\n            this.$message.info(res.message)\n            // this.$emit('ok');\n            // this.$emit('close',this.username);\n          }else{\n            this.$message.warning(res.message)\n          }\n        })\n      },\n      onSearch(){\n        this.$refs.departWindow.add(this.checkedDepartKeys,this.userId);\n      },\n      // 搜索用户对应的部门API\n      /*onSearch() {\n        // this.$refs.departWindow.add(this.checkedDepartKeys, this.userId);\n        this.$refs.modalForm.add(this.dataSource[0].userId);\n      },*/\n      searchQuery(){\n        if (this.queryParam.deptName == '' || this.queryParam.deptName == undefined){\n          this.modalFormOk();\n          return;\n        }\n        console.log(this.dataSource);\n        console.log(this.dataSource[0].userId);\n        console.log(\"9999999\")\n        getAction(this.url.queryById,{userId:this.userId,deptName:this.queryParam.deptName}).then((res)=>{\n          if(res.success){\n            console.log(res.result)\n            this.dataSource = res.result.records;\n          }else{\n            this.$message.warning(res.message);\n          }\n        })\n      },\n      //批量删除\n      onDelete(){\n        if (this.selectedRowKeys.length == 0  ){\n          this.$message.error(\"请至少选择一条记录！\")\n          return;\n        }\n        this.$confirm({\n          title: \"确认删除\",\n          content: \"是否删除选中数据?\",\n          onOk:  ()=> {\n            postAction(this.url.deleteList,{departMapId:this.selectedRowKeys}).then(res=>{\n              if(res.success){\n                this.modalFormOk();\n                this.onClearSelected();\n                this.$message.success(\"删除成功\")\n              }else {\n                this.$message.error(res.message);\n              }\n            })\n          }\n        });\n      },\n      //删除\n      handleDelete(record){\n        getAction(this.url.delete,{userId:record.userId,deptId:record.deptId}).then((res)=>{\n          if(res.success){\n            this.$message.success(res.message);\n            this.modalFormOk();\n            this.onClearSelected();\n          }else{\n            this.$message.error(res.message);\n          }\n        })\n      },\n\n/*      loadData() {//请求表格数据\n        console.log(\"************\")\n        // getAction(this.url.list, {iProcOpinionId: iid}).then(res => {\n        //   this.dataSource = res.result.records;\n        // })\n        getAction(this.url.list,{}).then((res)=>{\n          // console.log(\"====================================\");\n          // console.log(res);\n          this.data=res.result;\n          this.dataSource=res.result.records;\n        })\n      },*/\n      handleTableChange(page) {\n        this.ipagination.current = page.current;\n        this.ipagination.pageSize = page.pageSize;\n        this.loadData1();\n      },\n      loadData1() {\n        getAction(this.url.list, {username: this.username,pageNo:this.ipagination.current,pageSize:this.ipagination.pageSize}).then((res) => {\n          console.log(res.result);\n          this.dataSource = [];\n          this.ipagination.total = res.result.total;\n          this.userId = res.result.records[0].userId;\n          if(res.result.records.length == 1 && res.result.records[0].id == undefined){\n              return;\n          }\n          this.dataSource = res.result.records;\n          for(let i in this.dataSource){\n            if(this.dataSource[i].parentName != \"\"){\n              this.dataSource[i].parentName += \"-\";\n              this.dataSource[i].parentName += this.dataSource[i].deptName;\n              this.dataSource[i].deptName = this.dataSource[i].parentName;\n            }\n          }\n\n        })\n\n        /*getAction(this.url.list, {username: username,pageNo:this.ipagination.current,pageSize:this.ipagination.pageSize}).then((res) => {\n          console.log(\"-------------\");\n          console.log(res.result);\n          this.dataSource = res.result.records;\n          this.ipagination.total = res.result.total;\n        })*/\n      },\n      loadData(){\n\n      }\n    }\n  }\n",{"version":3,"sources":["SysUserManagedeptsList.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAuGA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA","file":"SysUserManagedeptsList.vue","sourceRoot":"src/views/system","sourcesContent":["<template>\r\n  <a-modal :visible=\"showFunPer\" :width=\"1200\" @ok=\"handleOk\" @cancel=\"handleCancle\">\r\n  <a-card :bordered=\"false\">\r\n\r\n    <!-- 查询区域 -->\r\n    <div class=\"table-page-search-wrapper\">\r\n      <a-form layout=\"inline\">\r\n        <a-row :gutter=\"24\">\r\n\r\n      <!--    <a-col :md=\"6\" :sm=\"8\">\r\n            <a-form-item label=\"主键id\">\r\n              <a-input placeholder=\"请输入主键id\" v-model=\"queryParam.iId\"></a-input>\r\n            </a-form-item>\r\n          </a-col>\r\n          <a-col :md=\"6\" :sm=\"8\">\r\n            <a-form-item label=\"用户id\">\r\n              <a-input placeholder=\"请输入用户id\" v-model=\"queryParam.sUserId\"></a-input>\r\n            </a-form-item>\r\n          </a-col>-->\r\n          <a-col :md=\"6\" :sm=\"8\">\r\n            <a-form-item label=\"部门名称\">\r\n              <a-input placeholder=\"请输入部门名称\" v-model=\"queryParam.deptName\"></a-input>\r\n            </a-form-item>\r\n          </a-col>\r\n        <!--<template v-if=\"toggleSearchStatus\">\r\n        <a-col :md=\"6\" :sm=\"8\">\r\n            <a-form-item label=\"部门ID\">\r\n              <a-input placeholder=\"请输入部门ID\" v-model=\"queryParam.sDeptId\"></a-input>\r\n            </a-form-item>\r\n          </a-col>\r\n          </template>-->\r\n          <a-col :md=\"6\" :sm=\"8\" >\r\n            <span style=\"float: left;overflow: hidden;\" class=\"table-page-search-submitButtons\">\r\n              <a-button type=\"primary\" @click=\"searchQuery\" icon=\"search\">查询</a-button>\r\n              <a-button type=\"primary\" @click=\"searchReset\" icon=\"reload\" style=\"margin-left: 8px\">重置</a-button>\r\n            </span>\r\n          </a-col>\r\n\r\n        </a-row>\r\n      </a-form>\r\n    </div>\r\n\r\n    <!-- 操作按钮区域 -->\r\n    <div class=\"table-operator\">\r\n      <a-button @click=\"onSearch\" type=\"primary\" icon=\"plus\">新增</a-button>\r\n        <a-button @click=\"onDelete\" type=\"primary\" icon=\"delete\">删除</a-button>\r\n\r\n    </div>\r\n\r\n    <!-- table区域-begin -->\r\n    <div>\r\n      <div class=\"ant-alert ant-alert-info\" style=\"margin-bottom: 16px;\">\r\n        <i class=\"anticon anticon-info-circle ant-alert-icon\"></i> 已选择 <a style=\"font-weight: 600\">{{ selectedRowKeys.length }}</a>项\r\n        <a style=\"margin-left: 24px\" @click=\"onClearSelected\">清空</a>\r\n      </div>\r\n\r\n      <a-table\r\n        ref=\"table\"\r\n        size=\"middle\"\r\n        bordered\r\n        rowKey=\"id\"\r\n        :columns=\"columns\"\r\n        :dataSource=\"dataSource\"\r\n        :pagination=\"ipagination\"\r\n        :loading=\"loading\"\r\n        :rowSelection=\"{selectedRowKeys: selectedRowKeys, onChange: onSelectChange}\"\r\n        @change=\"handleTableChange\">\r\n\r\n        <span slot=\"action\" slot-scope=\"text, record\">\r\n          <!--<a @click=\"handleEdit(record)\">编辑</a>-->\r\n\r\n          <!--<a-divider type=\"vertical\" />-->\r\n          <!--<a-dropdown>-->\r\n          <!--  <a-popconfirm placement=\"bottom\" okText=\"Yes\" cancelText=\"No\" @confirm=\"() => handleDelete(record)\">\r\n              <template slot=\"title\">\r\n                <a>删除</a>\r\n              </template>\r\n            </a-popconfirm>-->\r\n\r\n\r\n            <!--<a-menu slot=\"overlay\">-->\r\n              <!--<a-menu-item>-->\r\n                <a-popconfirm title=\"确定删除吗?\" @confirm=\"() => handleDelete(record)\">\r\n                  <a class=\"ant-dropdown-link\">删除</a>\r\n                </a-popconfirm>\r\n              <!--</a-menu-item>-->\r\n            <!--</a-menu>-->\r\n          <!--</a-dropdown>-->\r\n        </span>\r\n\r\n      </a-table>\r\n    </div>\r\n    <!-- table区域-end -->\r\n\r\n    <!-- 表单区域 -->\r\n    <sysUserManagedepts-modal ref=\"modalForm\" @ok=\"modalFormOk\"></sysUserManagedepts-modal>\r\n\r\n    <depart-window ref=\"departWindow\" @ok=\"modalFormOk\" @partData=\"partData\"></depart-window>\r\n  </a-card>\r\n  </a-modal>\r\n</template>\r\n\r\n<script>\r\n  import sysUserManagedeptsModal from './modules/SysUserManagedeptsModal'\r\n  import { JeecgListMixin } from '@/mixins/JeecgListMixin'\r\n  import { httpAction,getAction,postAction } from '@/api/manage'\r\n  import departWindow from './modules/SelectDepartWindow'\r\n\r\n  export default {\r\n    name: \"sysUserManagedeptsList\",\r\n    mixins:[JeecgListMixin],\r\n    components: {\r\n      sysUserManagedeptsModal,\r\n      departWindow,\r\n    },\r\n    data () {\r\n      return {\r\n        queryParam:{\r\n          deptName:'',\r\n      },\r\n        description: '分管领导部门管理管理页面',\r\n        username:'',\r\n        checkedDepartKeys:[],\r\n        selectedDepartKeys:[], //保存用户选择部门id\r\n        departIdList:[],\r\n        deptName:'',\r\n        userId:'',\r\n        ipagination: {\r\n          current: 1,\r\n          pageSize: 10,\r\n          pageSizeOptions: ['10', '20', '30'],\r\n          showTotal: (total, range) => {\r\n            return range[0] + \"-\" + range[1] + \" 共\" + total + \"条\"\r\n          },\r\n          showQuickJumper: true,\r\n          showSizeChanger: true,\r\n          total: 0\r\n        },\r\n        // 表头\r\n        columns: [\r\n          {\r\n            title: '用户账号',\r\n            align:\"center\",\r\n            dataIndex: 'username'\r\n          },\r\n          {\r\n            title: '机构名称',\r\n            align:\"center\",\r\n            dataIndex: 'deptName'\r\n          },\r\n          {\r\n            title: '操作',\r\n            dataIndex: 'action',\r\n            align:\"center\",\r\n            scopedSlots: { customRender: 'action' },\r\n          }\r\n        ],\r\n\t\turl: {\r\n          list: \"/sys/sysUserManagedepts/list\",\r\n          add: \"/sys/sysUserManagedepts/add\",\r\n          delete: \"/sys/sysUserManagedepts/delete\",\r\n          queryById: \"/sys/sysUserManagedepts/queryById\",\r\n          deleteList:\"/sys/sysUserManagedepts/deleteList\",\r\n       },\r\n        showFunPer: false,\r\n    }\r\n  },\r\n  computed: {\r\n    importExcelUrl: function(){\r\n      return `${window._CONFIG['domianURL']}/${this.url.importExcelUrl}`;\r\n    }\r\n  },\r\n    methods: {\r\n      config(username) {\r\n        console.log(\"----------------\")\r\n        console.log(username)\r\n        this.showFunPer = true;\r\n        this.username=username;\r\n        this.loadData1();\r\n        /*getAction(this.url.list, {username: username}).then((res) => {\r\n          console.log(\"-------------\");\r\n          console.log(res.result);\r\n          this.dataSource = res.result.records;\r\n        })*/\r\n      },\r\n      modalFormOk(){\r\n        this.loadData1();\r\n      },\r\n      handleOk() {\r\n        this.showFunPer = false;\r\n      },\r\n      handleCancle() {\r\n        this.showFunPer = false;\r\n      },\r\n      partData(formData){\r\n        console.log(\"^^^^^^^^^^^^^^^^^^^^^\")\r\n        console.log(formData);\r\n        this.selectedDepartKeys = [];\r\n          for (let i = 0; i < formData.length; i++) {\r\n          this.selectedDepartKeys.push(formData[i].key);\r\n        }\r\n        console.log(this.selectedDepartKeys)\r\n        this.departIdList = this.selectedDepartKeys;\r\n        this.checkedDepartKeys = this.selectedDepartKeys;  //更新当前的选择keys\r\n\r\n        postAction(this.url.add,{userId:this.userId,departId:this.departIdList}).then(res=>{\r\n          if(res.success){\r\n            this.$message.info(res.message)\r\n            // this.$emit('ok');\r\n            // this.$emit('close',this.username);\r\n          }else{\r\n            this.$message.warning(res.message)\r\n          }\r\n        })\r\n      },\r\n      onSearch(){\r\n        this.$refs.departWindow.add(this.checkedDepartKeys,this.userId);\r\n      },\r\n      // 搜索用户对应的部门API\r\n      /*onSearch() {\r\n        // this.$refs.departWindow.add(this.checkedDepartKeys, this.userId);\r\n        this.$refs.modalForm.add(this.dataSource[0].userId);\r\n      },*/\r\n      searchQuery(){\r\n        if (this.queryParam.deptName == '' || this.queryParam.deptName == undefined){\r\n          this.modalFormOk();\r\n          return;\r\n        }\r\n        console.log(this.dataSource);\r\n        console.log(this.dataSource[0].userId);\r\n        console.log(\"9999999\")\r\n        getAction(this.url.queryById,{userId:this.userId,deptName:this.queryParam.deptName}).then((res)=>{\r\n          if(res.success){\r\n            console.log(res.result)\r\n            this.dataSource = res.result.records;\r\n          }else{\r\n            this.$message.warning(res.message);\r\n          }\r\n        })\r\n      },\r\n      //批量删除\r\n      onDelete(){\r\n        if (this.selectedRowKeys.length == 0  ){\r\n          this.$message.error(\"请至少选择一条记录！\")\r\n          return;\r\n        }\r\n        this.$confirm({\r\n          title: \"确认删除\",\r\n          content: \"是否删除选中数据?\",\r\n          onOk:  ()=> {\r\n            postAction(this.url.deleteList,{departMapId:this.selectedRowKeys}).then(res=>{\r\n              if(res.success){\r\n                this.modalFormOk();\r\n                this.onClearSelected();\r\n                this.$message.success(\"删除成功\")\r\n              }else {\r\n                this.$message.error(res.message);\r\n              }\r\n            })\r\n          }\r\n        });\r\n      },\r\n      //删除\r\n      handleDelete(record){\r\n        getAction(this.url.delete,{userId:record.userId,deptId:record.deptId}).then((res)=>{\r\n          if(res.success){\r\n            this.$message.success(res.message);\r\n            this.modalFormOk();\r\n            this.onClearSelected();\r\n          }else{\r\n            this.$message.error(res.message);\r\n          }\r\n        })\r\n      },\r\n\r\n/*      loadData() {//请求表格数据\r\n        console.log(\"************\")\r\n        // getAction(this.url.list, {iProcOpinionId: iid}).then(res => {\r\n        //   this.dataSource = res.result.records;\r\n        // })\r\n        getAction(this.url.list,{}).then((res)=>{\r\n          // console.log(\"====================================\");\r\n          // console.log(res);\r\n          this.data=res.result;\r\n          this.dataSource=res.result.records;\r\n        })\r\n      },*/\r\n      handleTableChange(page) {\r\n        this.ipagination.current = page.current;\r\n        this.ipagination.pageSize = page.pageSize;\r\n        this.loadData1();\r\n      },\r\n      loadData1() {\r\n        getAction(this.url.list, {username: this.username,pageNo:this.ipagination.current,pageSize:this.ipagination.pageSize}).then((res) => {\r\n          console.log(res.result);\r\n          this.dataSource = [];\r\n          this.ipagination.total = res.result.total;\r\n          this.userId = res.result.records[0].userId;\r\n          if(res.result.records.length == 1 && res.result.records[0].id == undefined){\r\n              return;\r\n          }\r\n          this.dataSource = res.result.records;\r\n          for(let i in this.dataSource){\r\n            if(this.dataSource[i].parentName != \"\"){\r\n              this.dataSource[i].parentName += \"-\";\r\n              this.dataSource[i].parentName += this.dataSource[i].deptName;\r\n              this.dataSource[i].deptName = this.dataSource[i].parentName;\r\n            }\r\n          }\r\n\r\n        })\r\n\r\n        /*getAction(this.url.list, {username: username,pageNo:this.ipagination.current,pageSize:this.ipagination.pageSize}).then((res) => {\r\n          console.log(\"-------------\");\r\n          console.log(res.result);\r\n          this.dataSource = res.result.records;\r\n          this.ipagination.total = res.result.total;\r\n        })*/\r\n      },\r\n      loadData(){\r\n\r\n      }\r\n    }\r\n  }\r\n</script>\r\n<style scoped>\r\n</style>"]}]}