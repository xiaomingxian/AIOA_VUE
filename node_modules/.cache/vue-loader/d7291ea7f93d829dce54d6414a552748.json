{"remainingRequest":"C:\\xxm\\work\\jd\\fore\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\xxm\\work\\jd\\fore\\src\\views\\mytask\\taskShift.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\xxm\\work\\jd\\fore\\src\\views\\mytask\\taskShift.vue","mtime":1578016528058},{"path":"C:\\xxm\\work\\jd\\fore\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1570779194464},{"path":"C:\\xxm\\work\\jd\\fore\\node_modules\\babel-loader\\lib\\index.js","mtime":1570779245522},{"path":"C:\\xxm\\work\\jd\\fore\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1570779194464},{"path":"C:\\xxm\\work\\jd\\fore\\node_modules\\vue-loader\\lib\\index.js","mtime":1570779225726}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport Vue from 'vue'\nimport {JeecgListMixin} from '@/mixins/JeecgListMixin'\nimport {ACCESS_TOKEN} from \"../../store/mutation-types\";\nimport {getAction, postAction} from \"../../api/manage\";\nimport pic2Modal from './modules/pic2Modal'\n//业务页面\nimport detailFile from './taskList/detailFile'\n//移交\nimport taskShiftModal from './modules/taskShiftModal'\nimport JSelectUserByDepSingle from \"../../components/jeecgbiz/JSelectUserByDepSingle\";\nimport JSelectUserByDepCheckBox from \"../../components/jeecgbiz/JSelectUserByDepCheckBox\";\n\n\nexport default {\n  name: \"taskToDo\",\n  mixins: [JeecgListMixin],\n  components: {\n    pic2Modal,\n    //业务\n    detailFile,\n    taskShiftModal,\n    JSelectUserByDepSingle,\n    JSelectUserByDepCheckBox,\n  },\n  data() {\n    return {\n      headers: {'X-Access-Token': Vue.ls.get(ACCESS_TOKEN)},\n      description: '任务移交',\n      datasource: [],\n      loginInfo: '',\n      task: '',\n      checkUserIds: [],\n      selectedDepUsers: '',\n      isBatchShift: false,\n      // 表头\n      columns: [\n        {\n          title: '序号',\n          dataIndex: '',\n          key: 'rowIndex',\n          width: 60,\n          align: \"center\",\n          customRender: function (t, r, index) {\n            return parseInt(index) + 1;\n          }\n        },\n        {\n          title: '文号',\n          width: 100,\n          align: \"center\",\n          sorter: (i, ii, type) => {\n\n            this.queryParam.tableOrder = true\n            this.nullOther('orederByWenHao')\n\n            this.queryParam.orederByWenHao = type == 'descend' ? -1 : 1;\n            return true\n          },\n          dataIndex: 'wenHao'\n        },\n        {\n          title: '标题',\n          width: 350,\n          align: \"left\",\n          sorter: (i, ii, type) => {\n            //descend倒叙\n            //ascend正序\n\n            this.queryParam.tableOrder = true\n            //置空其他环节\n            this.nullOther('orederByTile')\n            this.queryParam.orederByTile = type == 'descend' ? -1 : 1;\n            return true\n          },\n          align: \"left\",\n          dataIndex: 'title'\n        },\n        {\n          title: '当前环节',\n          align: \"center\",\n          sorter: (i, ii, type) => {\n            this.queryParam.tableOrder = true\n            this.nullOther('orederByHuanJie')\n\n            this.queryParam.orederByHuanJie = type == 'descend' ? -1 : 1\n            return true\n          },\n          dataIndex: 'name'\n        },\n        {\n          title: '拟稿人',\n          align: \"center\",\n          sorter: (i, ii, type) => {\n            this.queryParam.tableOrder = true\n            this.nullOther('orederByDrafter')\n\n            this.queryParam.orederByDrafter = type == 'descend' ? -1 : 1;\n            return true\n          },\n          dataIndex: 'drafter'\n        },\n        {\n          title: '转发时间',\n          align: \"center\",\n          sorter: (i, ii, type) => {\n            this.queryParam.tableOrder = true\n            this.nullOther('orederByTime')\n\n            this.queryParam.orederByTime = type == 'descend' ? -1 : 1;\n            return true\n          },\n          dataIndex: 'createTime'\n        },\n        {\n          title: '操作',\n          dataIndex: 'action',\n          sorter: (i, ii, type) => {\n            return true\n          },\n          align: \"center\",\n          scopedSlots: {customRender: 'action'},\n        }\n      ],\n      url: {\n        list: \"/wf/task/queryTask?operstatus=shift\",\n        busDataAndColums: 'oaBus/oaBusdata/queryBusdataById',\n        yewuDataQuery: \"/oaBus/dynamic/query\",\n        actShowQuery: '/oaBus/busPage/queryActShowByPageRef',\n        batchEnd: '/wf/task/batchEnd',\n        batchPiYue: '/wf/task/batchPiYue',\n        currentUnDo: '/wf/task/queryTaskUnDoCurrent',\n        taskShift: '/wf/task/taskShift',\n        batchShift: '/wf/task/batchShift',\n      },\n      startTimeFake: null,\n      endTimeFake: null,\n      taskType: null,\n    }\n  },\n  computed: {\n    importExcelUrl: function () {\n      return `${window._CONFIG['domianURL']}/${this.url.importExcelUrl}`;\n    }\n  },\n  methods: {\n    batchShift() {\n      this.isBatchShift = true\n      console.log(this.selectedRowKeys)\n      this.$refs.single.show()\n    },\n    selectShiftUser() {\n      this.$refs.checkSelect.show()\n    },\n    //清空其他排序条件\n    nullOther(type) {\n      let orderColums = ['orederByWenHao', 'orederByTile', 'orederByHuanJie', 'orederByDrafter', 'orederByTime']\n      for (let i in orderColums) {\n        if (i != type) {\n          this.queryParam[orderColums[i]] = undefined\n        }\n      }\n    },\n    taskShift(record) {\n      this.isBatchShift = false\n      this.task = record\n      this.$refs.single.show()\n      // this.$refs.taskShiftModal.task = record\n      // this.$refs.taskShiftModal.show()\n    },\n    unDo(record) {\n      let procInstId = record.processInstanceId\n      getAction(this.url.currentUnDo, {\n        procInstId: procInstId\n      }).then(res => {\n        if (res.success) {\n\n          const h = this.$createElement;\n          let content = []\n          for (let i in res.result) {\n            let msg = res.result[i]\n            content.push(h('p', `【${msg.taskDefName}】 ${msg.deptName} ：${msg.userName}`))\n          }\n\n          let content_ = h('div', {}, content)\n\n          const modal = this.$success({\n            title: '未办理信息',\n            content: content_,\n          });\n        } else {\n          this.$message.error(res.message)\n        }\n      })\n\n\n    },\n    //类型选择\n    taskTypeChange(type) {\n      if (type != '全部') {\n        this.queryParam.isDept = true\n        this.queryParam.deptType = type\n      } else {\n        this.queryParam.isDept = false\n      }\n    },\n    searchQueryMy() {\n      this.queryParam.tableOrder = false\n\n      this.searchQuery()\n      this.selectionRows = []\n      this.selectedRowKeys = []\n\n    },\n    searchQueryMy() {\n      this.searchQuery()\n      this.selectionRows = []\n      this.selectedRowKeys = []\n    },\n    searchResetMy() {\n      this.queryParam.tableOrder = false\n      this.queryParam.shiftUsers = undefined\n      this.checkUserIds = ''\n\n      this.searchReset()\n      this.startTimeFake = null\n      this.endTimeFake = null\n      this.taskType = null\n      this.queryParam.isDept = false\n      this.selectionRows = []\n      this.selectedRowKeys = []\n    },\n    endTime(a, time) {\n      this.queryParam.endQueryTime = time\n    },\n    startTime(a, time) {\n      this.queryParam.startQueryTime = time\n    },\n    reload() {\n      this.loading = true;\n      getAction(this.url.list).then((res) => {\n        if (res.success) {\n          this.dataSource = res.result.records;\n          this.ipagination.total = res.result.total;\n        }\n        if (res.code === 510) {\n          this.$message.warning(res.message)\n        }\n        this.loading = false;\n      })\n    },\n    cancel() {\n    },\n    showPic(record) {\n      this.$refs.pic2Modal.show(record)\n      this.$refs.pic2Modal.title = '当前环节'\n    },\n    doTask(record, index) {\n\n      return {\n        on: {\n          click: (event) => {\n            let taskDetail = {\n              tableName: record.table,\n              busdataId: record.tableId,\n              haveTask: true,\n              task: record\n            }\n            this.$router.push({path: '/mytask/taskList/Test-detailFile', query: taskDetail})\n          }\n        }\n      }\n    },\n    senUserId(ids) {\n      this.userIds = ids\n      if (this.userIds.length == 0) {\n        this.$message.error('请选择移交人')\n        return\n      }\n\n      if (this.isBatchShift) {\n        //批量移交\n        if (this.selectedRowKeys <= 0) {\n          this.$message.error('请选择要移交的任务')\n          return\n        }\n        //遍历判断用户是不是同一个人\n        let taskIds = this.selectedRowKeys.join(',')\n        let rows = this.selectionRows\n        let firstUserId = this.selectionRows[0].assignee\n        if (firstUserId == this.userIds[0]) {\n          this.$message.error('移交人与被移交人不能是同一个人')\n          return\n        }\n        for (let i in  rows) {\n          if (rows[i].assignee != firstUserId) {\n            this.$message.error('请选择同一办理人的任务')\n            return\n          }\n        }\n        getAction(this.url.batchShift + \"?taskIds=\" + taskIds + \"&destUserId=\" + this.userIds[0]\n          + \"&sourceUserId=\" + firstUserId).then(res => {\n          if (res.success) {\n            this.$message.success(res.message)\n          } else {\n            this.$message.error(res.message)\n          }\n        })\n\n      } else {\n        getAction(this.url.taskShift + \"?taskId=\" + this.task.id + \"&destUserId=\" + this.userIds[0]\n          + \"&sourceUserId=\" + this.task.assignee).then(res => {\n          if (res.success) {\n            this.$message.success(res.message)\n          } else {\n            this.$message.error(res.message)\n          }\n        })\n      }\n    },\n    senUserIdCheck(ids, selectedDepUsers) {\n      this.checkUserIds = ids\n      this.selectedDepUsers = selectedDepUsers\n      if (ids.length > 0) {\n        this.queryParam.shiftUsers = ids.join(\",\")\n      }\n    }\n  },\n  created() {\n    //默认不带部门类型\n    this.queryParam.isDept = false\n    getAction(\"/sys/user/getLoginInfo\").then(res => {\n      this.loginInfo = res\n    })\n\n  }\n\n}\n",{"version":3,"sources":["taskShift.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAiKA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA","file":"taskShift.vue","sourceRoot":"src/views/mytask","sourcesContent":["<template>\r\n  <a-card :bordered=\"false\">\r\n\r\n    <!-- 查询区域 -->\r\n    <div class=\"table-page-search-wrapper\">\r\n      <a-form layout=\"inline\">\r\n        <a-row :gutter=\"24\">\r\n          <a-col :md=\"6\" :sm=\"8\">\r\n            <a-form-item label=\"标题\">\r\n              <a-input placeholder=\"标题\" v-model=\"queryParam.dataTitle\"></a-input>\r\n            </a-form-item>\r\n          </a-col>\r\n          <a-col :md=\"6\" :sm=\"8\">\r\n            <a-form-item label=\"文件字号\">\r\n              <a-input placeholder=\"文件字号\" v-model=\"queryParam.fileNum\"></a-input>\r\n            </a-form-item>\r\n          </a-col>\r\n\r\n          <a-col :md=\"6\" :sm=\"8\">\r\n            <a-form-item label=\"待办用户\">\r\n              <!--v-model=\"queryParam.createName\"-->\r\n              <a-input @click=\"selectShiftUser\" v-model=\"selectedDepUsers\" placeholder=\"待办用户\"></a-input>\r\n              <j-select-user-by-dep-check-box ref=\"checkSelect\"\r\n                                              @senUserId=\"senUserIdCheck\"></j-select-user-by-dep-check-box>\r\n            </a-form-item>\r\n          </a-col>\r\n\r\n\r\n          <template v-if=\"toggleSearchStatus\">\r\n            <a-col :md=\"6\" :sm=\"8\">\r\n              <a-form-item label=\"拟稿人\">\r\n                <a-input placeholder=\"拟稿人\" v-model=\"queryParam.createName\"></a-input>\r\n              </a-form-item>\r\n            </a-col>\r\n            <a-col :md=\"6\" :sm=\"8\">\r\n\r\n              <a-form-item label=\"任务类型\">\r\n                <a-select style=\"width: 150px\" @change=\"taskTypeChange\" v-model=\"taskType\">\r\n                  <a-select-option value=\"全部\">全部</a-select-option>\r\n                  <a-select-option value=\"传阅\">传阅</a-select-option>\r\n                  <a-select-option value=\"主办\">主办</a-select-option>\r\n                  <a-select-option value=\"辅办\">辅办</a-select-option>\r\n                </a-select>\r\n              </a-form-item>\r\n            </a-col>\r\n            <a-col :md=\"6\" :sm=\"8\">\r\n              <a-form-item label=\"主办部门\">\r\n                <a-input placeholder=\"主办部门\" v-model=\"queryParam.mainDept\"></a-input>\r\n              </a-form-item>\r\n            </a-col>\r\n\r\n            <a-col :md=\"6\" :sm=\"8\">\r\n              <a-form-item label=\"开始时间\">\r\n                <a-date-picker showTime format=\"YYYY-MM-DD HH:mm:ss\" placeholder=\"请选择开始时间\"\r\n                               v-model='startTimeFake' @change=\"startTime\"/>\r\n              </a-form-item>\r\n            </a-col>\r\n            <a-col :md=\"6\" :sm=\"8\">\r\n              <a-form-item label=\"结束时间\">\r\n                <a-date-picker showTime format=\"YYYY-MM-DD HH:mm:ss\" placeholder=\"请选择结束时间\"\r\n                               v-model='endTimeFake' @change=\"endTime\"/>\r\n              </a-form-item>\r\n            </a-col>\r\n\r\n          </template>\r\n\r\n\r\n          <a-col :md=\"6\" :sm=\"8\">\r\n            <span style=\"float: left;overflow: hidden;\" class=\"table-page-search-submitButtons\">\r\n              <a-button type=\"primary\" ref=\"reSearchQuery\" @click=\"searchQueryMy\" icon=\"search\">查询</a-button>\r\n              <a-button type=\"primary\" @click=\"searchResetMy\" icon=\"reload\" style=\"margin-left: 8px\">重置</a-button>\r\n              <a @click=\"handleToggleSearch\" style=\"margin-left: 8px\">\r\n                {{ toggleSearchStatus ? '收起' : '展开' }}\r\n                <a-icon :type=\"toggleSearchStatus ? 'up' : 'down'\"/>\r\n              </a>\r\n            </span>\r\n          </a-col>\r\n\r\n        </a-row>\r\n      </a-form>\r\n    </div>\r\n\r\n    <!-- 操作按钮区域 -->\r\n    <div class=\"table-operator\">\r\n      <a-dropdown v-if=\"selectedRowKeys.length > 0\">\r\n        <a-menu slot=\"overlay\">\r\n          <a-menu-item key=\"1\" @click=\"batchShift\">\r\n            <a-icon type=\"delete\"/>\r\n            批量移交\r\n          </a-menu-item>\r\n          <a-menu-item v-if=\"(this.queryParam.deptType=='传阅')\"\r\n                       key=\"1\" @click=\"batchPiYue\">\r\n            <a-icon type=\"delete\"/>\r\n            批量批阅\r\n          </a-menu-item>\r\n        </a-menu>\r\n\r\n        <a-button style=\"margin-left: 8px\"> 批量操作\r\n          <a-icon type=\"down\"/>\r\n        </a-button>\r\n      </a-dropdown>\r\n\r\n    </div>\r\n\r\n    <!-- table区域-begin -->\r\n    <div>\r\n\r\n      <div class=\"ant-alert ant-alert-info\" style=\"margin-bottom: 16px;\">\r\n        <i class=\"anticon anticon-info-circle ant-alert-icon\"></i> 已选择 <a style=\"font-weight: 600\">{{\r\n        selectedRowKeys.length }}</a>项\r\n        <a style=\"margin-left: 24px\" @click=\"onClearSelected\">清空</a>\r\n      </div>\r\n\r\n      <a-table\r\n        ref=\"table\"\r\n        size=\"middle\"\r\n        bordered\r\n        rowKey=\"id\"\r\n        :columns=\"columns\"\r\n        :dataSource=\"dataSource\"\r\n        :pagination=\"ipagination\"\r\n        :loading=\"loading\"\r\n        :rowSelection=\"{selectedRowKeys: selectedRowKeys, onChange: onSelectChange}\"\r\n        @change=\"handleTableChange\"\r\n        :customRow=\"doTask\"\r\n        :rowClassName=\"(record,index) => {\r\n              let className  = 'light-row';\r\n              if (index % 2 === 1) className = 'dark-row';\r\n              return className;\r\n          }\"\r\n      >\r\n\r\n        <span slot=\"action\" slot-scope=\"text, record\">\r\n\r\n          <a @click.stop=\"taskShift(record)\">任务移交</a>\r\n          <a-divider type=\"vertical\"/>\r\n\r\n          <a @click.stop=\"unDo(record)\">未办理信息</a>\r\n          <a-divider type=\"vertical\"/>\r\n          <a @click.stop=\"showPic(record)\">查看流程图</a>\r\n\r\n        </span>\r\n\r\n      </a-table>\r\n    </div>\r\n    <!-- table区域-end -->\r\n\r\n    <!-- 表单区域 -->\r\n    <pic2-modal ref=\"pic2Modal\" @ok=\"modalFormOk\"></pic2-modal>\r\n\r\n\r\n    <!--业务页面-->\r\n    <detail-file ref=\"detailFile\"></detail-file>\r\n    <task-shift-modal ref=\"taskShiftModal\"></task-shift-modal>\r\n\r\n    <j-select-user-by-dep-single ref=\"single\" @senUserId=\"senUserId\"></j-select-user-by-dep-single>\r\n\r\n  </a-card>\r\n</template>\r\n\r\n<script>\r\n  import Vue from 'vue'\r\n  import {JeecgListMixin} from '@/mixins/JeecgListMixin'\r\n  import {ACCESS_TOKEN} from \"../../store/mutation-types\";\r\n  import {getAction, postAction} from \"../../api/manage\";\r\n  import pic2Modal from './modules/pic2Modal'\r\n  //业务页面\r\n  import detailFile from './taskList/detailFile'\r\n  //移交\r\n  import taskShiftModal from './modules/taskShiftModal'\r\n  import JSelectUserByDepSingle from \"../../components/jeecgbiz/JSelectUserByDepSingle\";\r\n  import JSelectUserByDepCheckBox from \"../../components/jeecgbiz/JSelectUserByDepCheckBox\";\r\n\r\n\r\n  export default {\r\n    name: \"taskToDo\",\r\n    mixins: [JeecgListMixin],\r\n    components: {\r\n      pic2Modal,\r\n      //业务\r\n      detailFile,\r\n      taskShiftModal,\r\n      JSelectUserByDepSingle,\r\n      JSelectUserByDepCheckBox,\r\n    },\r\n    data() {\r\n      return {\r\n        headers: {'X-Access-Token': Vue.ls.get(ACCESS_TOKEN)},\r\n        description: '任务移交',\r\n        datasource: [],\r\n        loginInfo: '',\r\n        task: '',\r\n        checkUserIds: [],\r\n        selectedDepUsers: '',\r\n        isBatchShift: false,\r\n        // 表头\r\n        columns: [\r\n          {\r\n            title: '序号',\r\n            dataIndex: '',\r\n            key: 'rowIndex',\r\n            width: 60,\r\n            align: \"center\",\r\n            customRender: function (t, r, index) {\r\n              return parseInt(index) + 1;\r\n            }\r\n          },\r\n          {\r\n            title: '文号',\r\n            width: 100,\r\n            align: \"center\",\r\n            sorter: (i, ii, type) => {\r\n\r\n              this.queryParam.tableOrder = true\r\n              this.nullOther('orederByWenHao')\r\n\r\n              this.queryParam.orederByWenHao = type == 'descend' ? -1 : 1;\r\n              return true\r\n            },\r\n            dataIndex: 'wenHao'\r\n          },\r\n          {\r\n            title: '标题',\r\n            width: 350,\r\n            align: \"left\",\r\n            sorter: (i, ii, type) => {\r\n              //descend倒叙\r\n              //ascend正序\r\n\r\n              this.queryParam.tableOrder = true\r\n              //置空其他环节\r\n              this.nullOther('orederByTile')\r\n              this.queryParam.orederByTile = type == 'descend' ? -1 : 1;\r\n              return true\r\n            },\r\n            align: \"left\",\r\n            dataIndex: 'title'\r\n          },\r\n          {\r\n            title: '当前环节',\r\n            align: \"center\",\r\n            sorter: (i, ii, type) => {\r\n              this.queryParam.tableOrder = true\r\n              this.nullOther('orederByHuanJie')\r\n\r\n              this.queryParam.orederByHuanJie = type == 'descend' ? -1 : 1\r\n              return true\r\n            },\r\n            dataIndex: 'name'\r\n          },\r\n          {\r\n            title: '拟稿人',\r\n            align: \"center\",\r\n            sorter: (i, ii, type) => {\r\n              this.queryParam.tableOrder = true\r\n              this.nullOther('orederByDrafter')\r\n\r\n              this.queryParam.orederByDrafter = type == 'descend' ? -1 : 1;\r\n              return true\r\n            },\r\n            dataIndex: 'drafter'\r\n          },\r\n          {\r\n            title: '转发时间',\r\n            align: \"center\",\r\n            sorter: (i, ii, type) => {\r\n              this.queryParam.tableOrder = true\r\n              this.nullOther('orederByTime')\r\n\r\n              this.queryParam.orederByTime = type == 'descend' ? -1 : 1;\r\n              return true\r\n            },\r\n            dataIndex: 'createTime'\r\n          },\r\n          {\r\n            title: '操作',\r\n            dataIndex: 'action',\r\n            sorter: (i, ii, type) => {\r\n              return true\r\n            },\r\n            align: \"center\",\r\n            scopedSlots: {customRender: 'action'},\r\n          }\r\n        ],\r\n        url: {\r\n          list: \"/wf/task/queryTask?operstatus=shift\",\r\n          busDataAndColums: 'oaBus/oaBusdata/queryBusdataById',\r\n          yewuDataQuery: \"/oaBus/dynamic/query\",\r\n          actShowQuery: '/oaBus/busPage/queryActShowByPageRef',\r\n          batchEnd: '/wf/task/batchEnd',\r\n          batchPiYue: '/wf/task/batchPiYue',\r\n          currentUnDo: '/wf/task/queryTaskUnDoCurrent',\r\n          taskShift: '/wf/task/taskShift',\r\n          batchShift: '/wf/task/batchShift',\r\n        },\r\n        startTimeFake: null,\r\n        endTimeFake: null,\r\n        taskType: null,\r\n      }\r\n    },\r\n    computed: {\r\n      importExcelUrl: function () {\r\n        return `${window._CONFIG['domianURL']}/${this.url.importExcelUrl}`;\r\n      }\r\n    },\r\n    methods: {\r\n      batchShift() {\r\n        this.isBatchShift = true\r\n        console.log(this.selectedRowKeys)\r\n        this.$refs.single.show()\r\n      },\r\n      selectShiftUser() {\r\n        this.$refs.checkSelect.show()\r\n      },\r\n      //清空其他排序条件\r\n      nullOther(type) {\r\n        let orderColums = ['orederByWenHao', 'orederByTile', 'orederByHuanJie', 'orederByDrafter', 'orederByTime']\r\n        for (let i in orderColums) {\r\n          if (i != type) {\r\n            this.queryParam[orderColums[i]] = undefined\r\n          }\r\n        }\r\n      },\r\n      taskShift(record) {\r\n        this.isBatchShift = false\r\n        this.task = record\r\n        this.$refs.single.show()\r\n        // this.$refs.taskShiftModal.task = record\r\n        // this.$refs.taskShiftModal.show()\r\n      },\r\n      unDo(record) {\r\n        let procInstId = record.processInstanceId\r\n        getAction(this.url.currentUnDo, {\r\n          procInstId: procInstId\r\n        }).then(res => {\r\n          if (res.success) {\r\n\r\n            const h = this.$createElement;\r\n            let content = []\r\n            for (let i in res.result) {\r\n              let msg = res.result[i]\r\n              content.push(h('p', `【${msg.taskDefName}】 ${msg.deptName} ：${msg.userName}`))\r\n            }\r\n\r\n            let content_ = h('div', {}, content)\r\n\r\n            const modal = this.$success({\r\n              title: '未办理信息',\r\n              content: content_,\r\n            });\r\n          } else {\r\n            this.$message.error(res.message)\r\n          }\r\n        })\r\n\r\n\r\n      },\r\n      //类型选择\r\n      taskTypeChange(type) {\r\n        if (type != '全部') {\r\n          this.queryParam.isDept = true\r\n          this.queryParam.deptType = type\r\n        } else {\r\n          this.queryParam.isDept = false\r\n        }\r\n      },\r\n      searchQueryMy() {\r\n        this.queryParam.tableOrder = false\r\n\r\n        this.searchQuery()\r\n        this.selectionRows = []\r\n        this.selectedRowKeys = []\r\n\r\n      },\r\n      searchQueryMy() {\r\n        this.searchQuery()\r\n        this.selectionRows = []\r\n        this.selectedRowKeys = []\r\n      },\r\n      searchResetMy() {\r\n        this.queryParam.tableOrder = false\r\n        this.queryParam.shiftUsers = undefined\r\n        this.checkUserIds = ''\r\n\r\n        this.searchReset()\r\n        this.startTimeFake = null\r\n        this.endTimeFake = null\r\n        this.taskType = null\r\n        this.queryParam.isDept = false\r\n        this.selectionRows = []\r\n        this.selectedRowKeys = []\r\n      },\r\n      endTime(a, time) {\r\n        this.queryParam.endQueryTime = time\r\n      },\r\n      startTime(a, time) {\r\n        this.queryParam.startQueryTime = time\r\n      },\r\n      reload() {\r\n        this.loading = true;\r\n        getAction(this.url.list).then((res) => {\r\n          if (res.success) {\r\n            this.dataSource = res.result.records;\r\n            this.ipagination.total = res.result.total;\r\n          }\r\n          if (res.code === 510) {\r\n            this.$message.warning(res.message)\r\n          }\r\n          this.loading = false;\r\n        })\r\n      },\r\n      cancel() {\r\n      },\r\n      showPic(record) {\r\n        this.$refs.pic2Modal.show(record)\r\n        this.$refs.pic2Modal.title = '当前环节'\r\n      },\r\n      doTask(record, index) {\r\n\r\n        return {\r\n          on: {\r\n            click: (event) => {\r\n              let taskDetail = {\r\n                tableName: record.table,\r\n                busdataId: record.tableId,\r\n                haveTask: true,\r\n                task: record\r\n              }\r\n              this.$router.push({path: '/mytask/taskList/Test-detailFile', query: taskDetail})\r\n            }\r\n          }\r\n        }\r\n      },\r\n      senUserId(ids) {\r\n        this.userIds = ids\r\n        if (this.userIds.length == 0) {\r\n          this.$message.error('请选择移交人')\r\n          return\r\n        }\r\n\r\n        if (this.isBatchShift) {\r\n          //批量移交\r\n          if (this.selectedRowKeys <= 0) {\r\n            this.$message.error('请选择要移交的任务')\r\n            return\r\n          }\r\n          //遍历判断用户是不是同一个人\r\n          let taskIds = this.selectedRowKeys.join(',')\r\n          let rows = this.selectionRows\r\n          let firstUserId = this.selectionRows[0].assignee\r\n          if (firstUserId == this.userIds[0]) {\r\n            this.$message.error('移交人与被移交人不能是同一个人')\r\n            return\r\n          }\r\n          for (let i in  rows) {\r\n            if (rows[i].assignee != firstUserId) {\r\n              this.$message.error('请选择同一办理人的任务')\r\n              return\r\n            }\r\n          }\r\n          getAction(this.url.batchShift + \"?taskIds=\" + taskIds + \"&destUserId=\" + this.userIds[0]\r\n            + \"&sourceUserId=\" + firstUserId).then(res => {\r\n            if (res.success) {\r\n              this.$message.success(res.message)\r\n            } else {\r\n              this.$message.error(res.message)\r\n            }\r\n          })\r\n\r\n        } else {\r\n          getAction(this.url.taskShift + \"?taskId=\" + this.task.id + \"&destUserId=\" + this.userIds[0]\r\n            + \"&sourceUserId=\" + this.task.assignee).then(res => {\r\n            if (res.success) {\r\n              this.$message.success(res.message)\r\n            } else {\r\n              this.$message.error(res.message)\r\n            }\r\n          })\r\n        }\r\n      },\r\n      senUserIdCheck(ids, selectedDepUsers) {\r\n        this.checkUserIds = ids\r\n        this.selectedDepUsers = selectedDepUsers\r\n        if (ids.length > 0) {\r\n          this.queryParam.shiftUsers = ids.join(\",\")\r\n        }\r\n      }\r\n    },\r\n    created() {\r\n      //默认不带部门类型\r\n      this.queryParam.isDept = false\r\n      getAction(\"/sys/user/getLoginInfo\").then(res => {\r\n        this.loginInfo = res\r\n      })\r\n\r\n    }\r\n\r\n  }\r\n</script>\r\n<style scoped>\r\n  @import '~@assets/less/common.less'\r\n</style>"]}]}