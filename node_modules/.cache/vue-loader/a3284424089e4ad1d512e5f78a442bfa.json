{"remainingRequest":"C:\\xxm\\work\\jd\\fore\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\xxm\\work\\jd\\fore\\src\\views\\mytask\\modules\\pic2Modal.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\xxm\\work\\jd\\fore\\src\\views\\mytask\\modules\\pic2Modal.vue","mtime":1579587944058},{"path":"C:\\xxm\\work\\jd\\fore\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1570779194464},{"path":"C:\\xxm\\work\\jd\\fore\\node_modules\\babel-loader\\lib\\index.js","mtime":1570779245522},{"path":"C:\\xxm\\work\\jd\\fore\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1570779194464},{"path":"C:\\xxm\\work\\jd\\fore\\node_modules\\vue-loader\\lib\\index.js","mtime":1570779225726}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\n\nimport {getAction, postAction, picUrl} from '@/api/manage'\n\n\nexport default {\n  name: \"pic2Modal\",\n  data() {\n    return {\n      scrHeight: window.innerHeight - 320 + 'px',\n      styles: [],\n      title: '流程查看',\n      confirmLoading: false,\n      visible: false,\n      trace: false,\n      showPic: true,\n      picurl: '',\n      locationUrl: '',\n      record: '',\n      //************* table **************\n      dataSource: [],\n      columns: [\n        {\n          title: '环节名称',\n          align: \"center\",\n          dataIndex: 'taskDefName'\n        },\n        {\n          title: '负责人',\n          align: \"center\",\n          dataIndex: 'userName'\n        },\n        {\n          title: '部门',\n          align: \"center\",\n          dataIndex: 'deptName'\n        },\n        {\n          title: '完成时间',\n          align: \"center\",\n          dataIndex: 'endTime'\n        },\n\n      ],\n      backRecord: false,\n      columns2: [\n        // {\n        //   title: '环节名称',\n        //   align: \"center\",\n        //   dataIndex: 'name'\n        // },\n        {\n          title: '撤回/回退人',\n          align: \"center\",\n          dataIndex: 'userName'\n        },\n        {\n          title: '撤回/回退记录',\n          align: \"left\",\n          dataIndex: 'log'\n        }, {\n          title: '回退原因',\n          align: \"left\",\n          dataIndex: 'backReason'\n        },\n        {\n          title: '完成时间',\n          align: \"center\",\n          dataIndex: 'endTime'\n        },\n\n      ]\n    }\n  },\n  created() {\n\n\n  },\n  methods: {\n    rowClick(res) {\n      return {\n        on: {\n          click: () => {\n            if (res.assignee.indexOf('回退') == 0) {\n              //查询意见 table tableid 环节 任务id\n              let url = '/oaBus/dynamic/query'\n              let taskId = res.id\n              let table = this.record.table + '_opinion'\n              let dataId = this.record.tableId\n              postAction(url, {\n                i_busdata_id: dataId,\n                table: table,\n                s_task_id: taskId,\n                s_opinion_type: -1\n              }).then(res => {\n                if (res.success) {\n                  console.log()\n\n\n                  const h = this.$createElement;\n                  let content = []\n                  for (let i in res.result.records) {\n                    let msg = res.result.records[i]\n                    content.push(h('p', `${msg.s_name} (${msg.s_dept_name}) ：${msg.s_opinion}`))\n                  }\n\n                  if (content.length == 0) {\n                    content = ['暂无数据']\n                  }\n                  let content_ = h('div', {}, content)\n\n                  const modal = this.$success({\n                    title: '回退原因',\n                    content: content_,\n                  });\n\n                } else {\n                  this.$message.error('查询意见失败')\n                }\n              })\n\n            } else {\n              console.log('---------->>>>撤回没有意见')\n            }\n\n          }\n        }\n      }\n    },\n    backRecordClick() {\n      var procInstId = this.record.processInstanceId\n      let table = this.record.table + '_opinion'\n\n      let url = 'wf/task/backRecordQuery?procInstId=' + procInstId + '&table=' + table\n\n\n      getAction(url).then(res => {\n        if (res.success) {\n          this.dataSource = res.result\n          this.backRecord = true\n          this.showPic = false\n          this.trace = false\n        } else {\n          this.$message.error(res.message)\n        }\n      })\n\n\n    },\n    show(record) {\n      this.record = record\n\n      this.showPict();\n\n    },\n    showPict() {\n      var procInstId = this.record.processInstanceId\n      var taskDefinitionKey = this.record.taskDefinitionKey\n      var processDefinitionId = this.record.processDefinitionId\n\n      //查询图片\n      // window._CONFIG['domianURL'] +\n      this.picurl = '/wf/process/resource/read?processDefinitionId='\n        + processDefinitionId + '&resourceType=image'\n      this.locationUrl = '/wf/task/pointLocationQuery?processId=' + procInstId + '&taskId=' + taskDefinitionKey\n        + \"&processDefinitionId=\" + processDefinitionId\n\n\n      picUrl(this.picurl).then(res => {\n        this.picurl = 'data:image/png;base64,' + btoa(new Uint8Array(res).reduce((data, byte) => data + String.fromCharCode(byte), ''));\n        this.visible = true;\n      })\n\n\n      //坐标\n      getAction(this.locationUrl).then(res => {\n\n        this.styles = []\n        for (let i in res.result) {\n          var x = res.result[i].x;\n          var y = res.result[i].y;\n          var width = res.result[i].width;\n          var height = res.result[i].height;\n          // let style = \"position:absolute;left:\" + x + \"px;top:\" + (y + 31) + \"px;width:\" + (width + 1) + \"px;height:\" + (height + 1) + \"px\"\n          let style = \"position:absolute;left:\" + x + \"px;top:\" + y + \"px;width:\" + (width + 1) + \"px;height:\" + (height + 1) + \"px\"\n          this.styles.push(style)\n        }\n\n      })\n\n\n      this.showPic = true\n      this.trace = false\n      this.backRecord = false\n\n\n    },\n\n    traceP() {\n      let url = 'oaBus/taskInAct/workTrack'\n\n\n      getAction(url, {\n        proInstId: this.record.processInstanceId\n\n      }).then(res => {\n        if (res.success) {\n          this.dataSource = res.result\n          this.showPic = false\n          this.trace = true\n          this.backRecord = false\n        } else {\n          this.$message.error(res.message)\n        }\n      })\n\n\n    },\n    handleCancel() {\n      this.$emit('close');\n      this.visible = false;\n    }, onSelectChange() {\n    }\n\n\n  }\n}\n",{"version":3,"sources":["pic2Modal.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAqFA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;;;AAGA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;;AAGA;AACA;AACA;;;AAGA;;AAEA;AACA;;;AAGA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA","file":"pic2Modal.vue","sourceRoot":"src/views/mytask/modules","sourcesContent":["<template>\r\n  <a-modal\r\n    title=\"流程查看\"\r\n    :width=\"1000\"\r\n    :visible=\"visible\"\r\n    :confirmLoading=\"confirmLoading\"\r\n    @ok=\"handleCancel\"\r\n    @cancel=\"handleCancel\"\r\n    destroyOnClose\r\n    cancelText=\"关闭\">\r\n    <div class=\"bingpai\">\r\n      <a-button @click=\"showPict\" block>流程图查看</a-button>\r\n      <a-button @click=\"traceP\" block>流程跟踪表</a-button>\r\n      <a-button @click=\"backRecordClick\" block>撤回/回退记录</a-button>\r\n    </div>\r\n    <div style=\"overflow: auto; position: relative;background-color: #f6f6f6;border: 1px solid #e0e0e0;\" :style=\"{height: scrHeight}\">\r\n\r\n\r\n\r\n\r\n      <div style=\"width:100%\" v-if=\"showPic\">\r\n\r\n\r\n        <div v-for=\"item in styles\" class=\"div\" :style='item'></div>\r\n\r\n        <img :src=\"picurl\" v-show=\"visible\"/>\r\n\r\n      </div>\r\n      <div v-if=\"trace\" style=\"width: 98%;margin: 1%;\">\r\n\r\n        <a-table\r\n          ref=\"table\"\r\n          size=\"middle\"\r\n          rowKey=\"taskKey\"\r\n          :columns=\"columns\"\r\n          :dataSource=\"dataSource\"\r\n          :rowClassName=\"(record,index) => {\r\n              let className  = 'light-row';\r\n              if (index % 2 === 1) className = 'dark-row';\r\n              return className;\r\n          }\"\r\n        >\r\n\r\n        </a-table>\r\n      </div>\r\n\r\n      <div v-if=\"backRecord\" style=\"width: 98%;margin: 1%;\">\r\n\r\n        <!--  :customRow=\"rowClick\"-->\r\n        <a-table\r\n          ref=\"table\"\r\n          size=\"middle\"\r\n          rowKey=\"taskKey\"\r\n          :columns=\"columns2\"\r\n          :dataSource=\"dataSource\"\r\n          :rowClassName=\"(record,index) => {\r\n              let className  = 'light-row';\r\n              if (index % 2 === 1) className = 'dark-row';\r\n              return className;\r\n          }\"\r\n        >\r\n\r\n        </a-table>\r\n      </div>\r\n\r\n    </div>\r\n\r\n\r\n  </a-modal>\r\n</template>\r\n<style type=\"text/css\">\r\n  .div {\r\n    border: 2px solid red;\r\n    padding: 5px;\r\n  }\r\n\r\n  .bingpai {\r\n    display: flex;\r\n    width: fit-content;\r\n  }\r\n\r\n</style>\r\n\r\n<script>\r\n\r\n  import {getAction, postAction, picUrl} from '@/api/manage'\r\n\r\n\r\n  export default {\r\n    name: \"pic2Modal\",\r\n    data() {\r\n      return {\r\n        scrHeight: window.innerHeight - 320 + 'px',\r\n        styles: [],\r\n        title: '流程查看',\r\n        confirmLoading: false,\r\n        visible: false,\r\n        trace: false,\r\n        showPic: true,\r\n        picurl: '',\r\n        locationUrl: '',\r\n        record: '',\r\n        //************* table **************\r\n        dataSource: [],\r\n        columns: [\r\n          {\r\n            title: '环节名称',\r\n            align: \"center\",\r\n            dataIndex: 'taskDefName'\r\n          },\r\n          {\r\n            title: '负责人',\r\n            align: \"center\",\r\n            dataIndex: 'userName'\r\n          },\r\n          {\r\n            title: '部门',\r\n            align: \"center\",\r\n            dataIndex: 'deptName'\r\n          },\r\n          {\r\n            title: '完成时间',\r\n            align: \"center\",\r\n            dataIndex: 'endTime'\r\n          },\r\n\r\n        ],\r\n        backRecord: false,\r\n        columns2: [\r\n          // {\r\n          //   title: '环节名称',\r\n          //   align: \"center\",\r\n          //   dataIndex: 'name'\r\n          // },\r\n          {\r\n            title: '撤回/回退人',\r\n            align: \"center\",\r\n            dataIndex: 'userName'\r\n          },\r\n          {\r\n            title: '撤回/回退记录',\r\n            align: \"left\",\r\n            dataIndex: 'log'\r\n          }, {\r\n            title: '回退原因',\r\n            align: \"left\",\r\n            dataIndex: 'backReason'\r\n          },\r\n          {\r\n            title: '完成时间',\r\n            align: \"center\",\r\n            dataIndex: 'endTime'\r\n          },\r\n\r\n        ]\r\n      }\r\n    },\r\n    created() {\r\n\r\n\r\n    },\r\n    methods: {\r\n      rowClick(res) {\r\n        return {\r\n          on: {\r\n            click: () => {\r\n              if (res.assignee.indexOf('回退') == 0) {\r\n                //查询意见 table tableid 环节 任务id\r\n                let url = '/oaBus/dynamic/query'\r\n                let taskId = res.id\r\n                let table = this.record.table + '_opinion'\r\n                let dataId = this.record.tableId\r\n                postAction(url, {\r\n                  i_busdata_id: dataId,\r\n                  table: table,\r\n                  s_task_id: taskId,\r\n                  s_opinion_type: -1\r\n                }).then(res => {\r\n                  if (res.success) {\r\n                    console.log()\r\n\r\n\r\n                    const h = this.$createElement;\r\n                    let content = []\r\n                    for (let i in res.result.records) {\r\n                      let msg = res.result.records[i]\r\n                      content.push(h('p', `${msg.s_name} (${msg.s_dept_name}) ：${msg.s_opinion}`))\r\n                    }\r\n\r\n                    if (content.length == 0) {\r\n                      content = ['暂无数据']\r\n                    }\r\n                    let content_ = h('div', {}, content)\r\n\r\n                    const modal = this.$success({\r\n                      title: '回退原因',\r\n                      content: content_,\r\n                    });\r\n\r\n                  } else {\r\n                    this.$message.error('查询意见失败')\r\n                  }\r\n                })\r\n\r\n              } else {\r\n                console.log('---------->>>>撤回没有意见')\r\n              }\r\n\r\n            }\r\n          }\r\n        }\r\n      },\r\n      backRecordClick() {\r\n        var procInstId = this.record.processInstanceId\r\n        let table = this.record.table + '_opinion'\r\n\r\n        let url = 'wf/task/backRecordQuery?procInstId=' + procInstId + '&table=' + table\r\n\r\n\r\n        getAction(url).then(res => {\r\n          if (res.success) {\r\n            this.dataSource = res.result\r\n            this.backRecord = true\r\n            this.showPic = false\r\n            this.trace = false\r\n          } else {\r\n            this.$message.error(res.message)\r\n          }\r\n        })\r\n\r\n\r\n      },\r\n      show(record) {\r\n        this.record = record\r\n\r\n        this.showPict();\r\n\r\n      },\r\n      showPict() {\r\n        var procInstId = this.record.processInstanceId\r\n        var taskDefinitionKey = this.record.taskDefinitionKey\r\n        var processDefinitionId = this.record.processDefinitionId\r\n\r\n        //查询图片\r\n        // window._CONFIG['domianURL'] +\r\n        this.picurl = '/wf/process/resource/read?processDefinitionId='\r\n          + processDefinitionId + '&resourceType=image'\r\n        this.locationUrl = '/wf/task/pointLocationQuery?processId=' + procInstId + '&taskId=' + taskDefinitionKey\r\n          + \"&processDefinitionId=\" + processDefinitionId\r\n\r\n\r\n        picUrl(this.picurl).then(res => {\r\n          this.picurl = 'data:image/png;base64,' + btoa(new Uint8Array(res).reduce((data, byte) => data + String.fromCharCode(byte), ''));\r\n          this.visible = true;\r\n        })\r\n\r\n\r\n        //坐标\r\n        getAction(this.locationUrl).then(res => {\r\n\r\n          this.styles = []\r\n          for (let i in res.result) {\r\n            var x = res.result[i].x;\r\n            var y = res.result[i].y;\r\n            var width = res.result[i].width;\r\n            var height = res.result[i].height;\r\n            // let style = \"position:absolute;left:\" + x + \"px;top:\" + (y + 31) + \"px;width:\" + (width + 1) + \"px;height:\" + (height + 1) + \"px\"\r\n            let style = \"position:absolute;left:\" + x + \"px;top:\" + y + \"px;width:\" + (width + 1) + \"px;height:\" + (height + 1) + \"px\"\r\n            this.styles.push(style)\r\n          }\r\n\r\n        })\r\n\r\n\r\n        this.showPic = true\r\n        this.trace = false\r\n        this.backRecord = false\r\n\r\n\r\n      },\r\n\r\n      traceP() {\r\n        let url = 'oaBus/taskInAct/workTrack'\r\n\r\n\r\n        getAction(url, {\r\n          proInstId: this.record.processInstanceId\r\n\r\n        }).then(res => {\r\n          if (res.success) {\r\n            this.dataSource = res.result\r\n            this.showPic = false\r\n            this.trace = true\r\n            this.backRecord = false\r\n          } else {\r\n            this.$message.error(res.message)\r\n          }\r\n        })\r\n\r\n\r\n      },\r\n      handleCancel() {\r\n        this.$emit('close');\r\n        this.visible = false;\r\n      }, onSelectChange() {\r\n      }\r\n\r\n\r\n    }\r\n  }\r\n</script>\r\n\r\n<style lang=\"less\" scoped>\r\n.ant-btn{\r\n  border-color: transparent;\r\n}\r\n\r\n.ant-btn:focus{\r\n  border:2px solid #bcbcbc;\r\n  border-bottom: transparent;\r\n}\r\n</style>"]}]}