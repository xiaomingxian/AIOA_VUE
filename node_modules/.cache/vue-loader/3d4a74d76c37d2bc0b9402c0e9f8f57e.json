{"remainingRequest":"C:\\xxm\\work\\jd\\fore\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\xxm\\work\\jd\\fore\\src\\views\\workflow\\modules\\opinion\\OaProcOpinionNewModal.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\xxm\\work\\jd\\fore\\src\\views\\workflow\\modules\\opinion\\OaProcOpinionNewModal.vue","mtime":1578232184167},{"path":"C:\\xxm\\work\\jd\\fore\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1570779194464},{"path":"C:\\xxm\\work\\jd\\fore\\node_modules\\babel-loader\\lib\\index.js","mtime":1570779245522},{"path":"C:\\xxm\\work\\jd\\fore\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1570779194464},{"path":"C:\\xxm\\work\\jd\\fore\\node_modules\\vue-loader\\lib\\index.js","mtime":1570779225726}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\n  import {httpAction,getAction,postAction,deleteAction} from '@/api/manage'\n  import pick from 'lodash.pick'\n  import moment from \"moment\"\n  import {JeecgListMixin} from '@/mixins/JeecgListMixin'\n  import ACol from \"ant-design-vue/es/grid/Col\";\n\n\n  export default {\n    name: \"OaProcOpinionNewModal\",\n    mixins: [JeecgListMixin],\n    components: {\n      ACol\n    },\n    data() {\n      return {\n        title: \"操作\",\n        visible: false,\n        show:false,//意见类型--显示控制\n        procDefKey:'',\n        showName:false,//是否显示提示\n        opinionName:'',//后台产生的名字\n        typeList:[],\n        taskDefKey:'',\n        type:'',//意见框类型：取数据字典下拉列表\n        sprocOpinionName:'',//意见组合名称\n        model: {},\n        labelCol: {\n          xs: {span: 24},\n          sm: {span: 5},\n        },\n        wrapperCol: {\n          xs: {span: 24},\n          sm: {span: 16},\n        },\n        opinionSetModal:{\n          itaskOpinionName:'',//意见框名称\n          itaskOpinionOrder:0,//意见框位置\n        },\n        itaskOpinionName:'',//意见框名称\n        itaskOpinionOrder:0,//意见框位置\n        TaskLinkList:[],//任务环节列表\n        TaskLinkId:'',//流程定义Id\n//业务模块---------------\n//         selectList: [],\n        // timeList:[],\n        // iProcSetId:'',\n\n\n        confirmLoading: false,\n        toggleSearchStatusSet:true,\n        form: this.$form.createForm(this),\n        validatorRules: {\n          iId: {rules: [{required: true, message: '请输入主键id!'}]},\n        },\n        url: {\n          list: \"/oaopinionset/oaOpinionSet/list\",\n          delete: \"/oaopinionset/oaOpinionSet/delete\",\n          deleteBatch: \"/oaopinionset/oaOpinionSet/deleteBatch\",\n          exportXlsUrl: \"oaopinionset/oaOpinionSet/exportXls\",\n          importExcelUrl: \"oaopinionset/oaOpinionSet/importExcel\",\n          add: \"/oaopinionset/oaOpinionSet/add\",\n          edit: \"/oaopinionset/oaOpinionSet/edit\"\n        }\n      }\n    },\n    created() {\n\n    },\n    computed: {\n      importExcelUrl: function () {\n        return `${window._CONFIG['domianURL']}/${this.url.importExcelUrl}`;\n      }\n    },\n    methods: {\n      //\n      getType(){\n        this.opinionSetModal.type=this.type\n      },\n      //修改意见组合名称\n      iTaskOpinionNewName(){\n        const that = this;\n        let httpurl = '';\n        let method = '';\n        if (!this.model.iid) {\n          httpurl += this.url.add;\n          method = 'post';\n        } else {\n          httpurl += this.url.edit;\n          method = 'put';\n        }\n        this.model.sprocOpinionName=this.sprocOpinionName;\n        // let formData = Object.assign(this.model, values);\n        httpAction(httpurl, {iid:this.model.iid,sprocOpinionName:this.model.sprocOpinionName,\n          procDefKey: this.model.procDefKey}, method).then((res) => {\n          if (res.success) {\n            that.$message.success(res.message);\n            that.$emit('ok');\n          } else {\n            that.$message.warning(res.message);\n          }\n        })\n      },\n      getTypeList(){//获取任务环节\n      let url=\"/sys/dict/getDictByKey\";\n      getAction(url, {dictKey: 'type'}).then(res => {\n        console.log('--------------------意见类型-下拉列表------------------------------');\n        console.log(res);\n        this.typeList=res.result;\n      });\n      },\n      getTaskLinkList(){//获取任务环节\n        let url=\"/wf/process/actsList\";\n        getAction(url, {processDefinitionId: this.TaskLinkId}).then(res => {\n          this.TaskLinkList = res.result;\n          if (this.taskDefKey==null||this.taskDefKey==''){\n            this.taskDefKey=this.TaskLinkList[0].id;//得到默认值\n          }\n          this.onTasklink();\n        });\n      },\n      onTasklink() {//请求表单数据\n        //初始化\n        this.showName==false//隐藏错误\n        this.toggleSearchStatus=true;\n        this.itaskOpinionName='';//意见框名称\n        this.itaskOpinionOrder=0;//意见框位置\n        // this.iProcSetId='';\n        let url=\"/oaopinionset/oaOpinionSet/queryByTaskDefKey\";\n        postAction(url, {taskDefKey: this.taskDefKey,iProcOpinionId: this.model.iid,procDefKey: this.procDefKey}).then(res => {\n          console.log('0000000000000000000000000000000');\n          console.log(res.result);\n          this.model.taskDefKey=this.taskDefKey;\n          if (res.success) {\n            this.toggleSearchStatusSet=true;\n            this.opinionSetModal=res.result;\n            // this.iProcSetId=this.opinionSetModal.iprocSetId;\n            this.itaskOpinionName=this.opinionSetModal.itaskOpinionName;//拟稿人\n            this.itaskOpinionOrder=this.opinionSetModal.itaskOpinionOrder; //读者\n            this.type=this.opinionSetModal.type//意见框类型\n          } else {\n            this.opinionSetModal.iid = null;\n            this.toggleSearchStatusSet=false;\n            // this.opinionSetModal.iProcSetId='';\n            this.opinionSetModal.itaskOpinionName='';//意见框名称\n            this.opinionSetModal.itaskOpinionOrder=0;//意见框位置\n            this.opinionSetModal.type=''//意见框类型\n          }\n\n        })\n      },\n      onitaskOpinionOrder(){\n        this.opinionSetModal.itaskOpinionOrder=this.itaskOpinionOrder;\n        this.jiaoYanXuh();\n      },\n      onitaskOpinionName(){\n        // console.log('-=-=_+_+_+_+_+++++++',JSON.stringify(this.itaskOpinionName));\n        this.opinionSetModal.itaskOpinionName=this.itaskOpinionName;\n        this.jiaoYanXuh();\n      },\n      jiaoYanXuh(){//改变时赋值并校验\n        let url=\"/oaopinionset/oaOpinionSet/queryByOrderAndKey\";\n        httpAction(url, {itaskOpinionOrder:this.itaskOpinionOrder,\n          procDefKey: this.model.procDefKey}, 'post').then((res) => {\n          if (res.success) {\n            // console.log(\"ffffffffffffffffffffffffffff\");\n            // console.log(res);\n            if (res.result!=null && this.itaskOpinionName==res.result[0].itaskOpinionName){\n              this.showName=false;\n            } else {\n              if (res.result==null){\n              this.showName=false;\n              }else {\n                this.showName=true;\n                this.opinionName=res.result[0].itaskOpinionName;\n              }\n            }\n          } else {\n            this.$message.warning(res.message);\n          }\n        })\n      },\n      //点击删除按钮 前校验\n      beforeConfirm(){\n        // console.log(this.btnSetModel)\n        if (this.opinionSetModal.iid==null){\n          this.$message.warning(\"当前信息不存在\");\n        }else {\n          let url='/oaopinionset/oaOpinionSet/verButtonSetDelete';\n          getAction(url,{id:this.opinionSetModal.iid}).then(res=>{\n            if (res.success){\n              // this.$message.success(res.message);\n              //调用弹框\n              this.showConfirm();\n            } else {\n              this.deleteOpinionSet();\n            }\n          });\n        }\n\n\n      },\n      //弹框\n      showConfirm(){\n        let that=this;\n        this.$confirm({\n          title:'你确定要删除吗？',\n          content:'您的某些业务已经使用了这套意见',\n          onOk(){\n            that.deleteOpinionSet();\n          },\n          onCancel(){\n          }\n        })\n      },\n      deleteOpinionSet(){\n        if (this.opinionSetModal.iid){\n          var that = this;\n          deleteAction(that.url.delete, {id: this.opinionSetModal.iid}).then((res) => {\n            if (res.success) {\n              that.$message.success(res.message);\n              // that.loadData();\n              this.itaskOpinionName='';//意见框名称\n              this.itaskOpinionOrder=0;//意见框位置\n              this.toggleSearchStatus=false;\n              this.toggleSearchStatusSet=false;\n              this.opinionSetModal.type=''//意见框类型\n            } else {\n              that.$message.warning(res.message);\n            }\n          });\n        }\n      },\n      add() {\n        this.edit({});\n      },\n      editBeforelvjian(record,TaskLinkId,res){\n        console.log(\"fdsfasafadfasdfsadfsadfsadfas\")\n        console.log(res);\n        this.taskDefKey= res.taskDefKey;\n        this.editlvjian(record,TaskLinkId);\n      },\n      editlvjian(record,TaskLinkId) {\n        this.toggleSearchStatus=false;\n        this.itaskOpinionName='';//意见框名称\n        this.itaskOpinionOrder=0;//意见框位置\n        this.opinionSetModal.type=''//意见框类型\n        //record---为上一页面数据，TaskLinkId---流程定义Key\n        // console.log('------------------888888888');\n        this.TaskLinkId=TaskLinkId;\n        console.log(this.TaskLinkId);\n        this.getTaskLinkList();//获取任务环节下拉列表\n        this.getFunctionList();\n        this.form.resetFields();\n        this.model = Object.assign({}, record);\n        // console.log(this.model);\n        this.sprocOpinionName=this.model.sprocOpinionName;\n        this.procDefKey=this.model.procDefKey;\n        this.visible = true;\n        // console.log(\"yyyyyyyyyyyyyyyyyyyyyyyyyyyyyyy\");\n        // console.log(record);\n        if (this.model.procDefKey==\"sendFile_hang\"){\n          this.show=true;\n        }else {\n          this.show=false;\n        }\n        this.$nextTick(() => {\n          this.form.setFieldsValue(pick(this.model, 'iid', 'procDefKey','sprocOpinionName'))\n          //时间格式化\n        });\n        //默认加载回显第一个\n        this.onTasklink();\n        this.getTypeList();\n      },\n      getFunctionList(){//获取全部业务下拉列表;\n        console.log('--------------------获取全部业务下拉列表-下拉列表------------------------------');\n\n        let url = \"/modify/fields/queryBusList\";\n        getAction(url, {}).then((res) => {\n\n          this.selectList = res.result;\n          // this.timeList = res.d_create_time;\n        });\n      },\n      getFunctionId(){\n        // this.opinionSetModal.iprocSetId=this.iProcSetId;\n        //   console.log('----------busFunction----------queryById------------------------------');\n        //   console.log(this.opinionSetModal.iprocSetId);\n      },\n      close() {\n        this.$emit('close');\n        this.visible = false;\n      },\n\n      handleOk() {\n        // this.opinionSetModal.iProcSetId=this.iProcSetId;\n        console.log('-=-=-=',JSON.stringify(this.opinionSetModal));\n        const that = this;\n        // 触发表单验证\n        this.form.validateFields((err, values) => {\n          if (!err) {\n            that.confirmLoading = true;\n            let httpurl = '';\n            let method = '';\n            if (this.opinionSetModal.iid==null || this.opinionSetModal.iid == undefined || !this.opinionSetModal.iid) {\n              console.log('----------------------------------090');\n              console.log(this.opinionSetModal);\n              this.opinionSetModal.iprocOpinionId=this.model.iid;\n              this.opinionSetModal.procDefKey=this.model.procDefKey;\n              this.opinionSetModal.taskDefKey=this.taskDefKey;\n              httpurl += this.url.add;\n              method = 'post';\n            } else {\n              httpurl += this.url.edit;\n              method = 'put';\n            }\n            let formData = Object.assign(this.opinionSetModal, values);\n            if (this.showName==false){//校验没问题时才能提交\n              //时间格式化\n              httpAction(httpurl, formData, method).then((res) => {\n                if (res.success) {\n                  that.$message.success(res.message);\n                  that.$emit('ok');\n                } else {\n                  // that.$message.warning(res.message);\n                }\n              }).finally(() => {\n                that.confirmLoading = false;\n                that.close();\n              })\n            }else {\n              that.$message.warning(\"相同序号，意见名称必须相同\");\n              that.close();\n            }\n\n          }\n        })\n      },\n      handleCancel() {\n        this.close()\n      }\n\n    }\n\n  }\n",{"version":3,"sources":["OaProcOpinionNewModal.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAiKA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA","file":"OaProcOpinionNewModal.vue","sourceRoot":"src/views/workflow/modules/opinion","sourcesContent":["<template>\r\n  <a-modal\r\n    :title=\"title\"\r\n    :width=\"800\"\r\n    :visible=\"visible\"\r\n    :confirmLoading=\"confirmLoading\"\r\n    @ok=\"handleOk\"\r\n    @cancel=\"handleCancel\"\r\n    cancelText=\"关闭\">\r\n\r\n    <a-spin :spinning=\"confirmLoading\" style=\"height: 360px;margin-left: 50px\">\r\n      <a-form :form=\"form\">\r\n\r\n        <!--<a-form-item-->\r\n          <!--:labelCol=\"labelCol\"-->\r\n          <!--:wrapperCol=\"wrapperCol\"-->\r\n          <!--label=\"主键id\">-->\r\n          <!--<a-input-number v-decorator=\"[ 'iId', validatorRules.iid ]\" />-->\r\n        <!--</a-form-item>-->\r\n        <a-form-item style=\"color: #1890ff;font-weight: 800;margin: 10px 0px\">\r\n          <span>流程定义KEY：</span>\r\n          <!--<a-input placeholder=\"请输入流程定义KEY\" v-decorator=\"['procDefKey', {}]\" />-->\r\n          <span >{{procDefKey}}</span>\r\n        </a-form-item>\r\n        <!--<a-form-item-->\r\n        <!--:labelCol=\"labelCol\"-->\r\n        <!--:wrapperCol=\"wrapperCol\"-->\r\n        <!--label=\"意见框组合名称\">-->\r\n        <!--<a-input style=\"width: 300px\" placeholder=\"请输入意见框组合名称\" v-model=\"sprocOpinionName\"/>-->\r\n          <!--<a-divider type=\"vertical\"/>-->\r\n          <!--<a-button @click=\"iTaskOpinionNewName\" type=\"primary\" icon=\"plus\">修改意见框组合名称</a-button>-->\r\n        <!--</a-form-item>-->\r\n        <!--水平分割-->\r\n        <!--<a-divider style=\"margin-top: 0px\"/>-->\r\n        <span style=\"font-weight: 1000;font-size: 16px;\">选择:</span>\r\n        <!--<a-divider/>-->\r\n        <!-- 查询区域 -->\r\n        <div class=\"table-page-search-wrapper\">\r\n          <a-form layout=\"inline\">\r\n            <a-row :gutter=\"12\">\r\n              <!--<template v-if=\"toggleSearchStatus\">-->\r\n              <a-col :md=\"10\" :sm=\"8\" style=\"margin-top: 10px;margin-left: 50px;padding-bottom: 0px\">\r\n                <a-form-item label=\"流程任务\">\r\n                  <!--<a-input placeholder=\"请输入流程任务\" v-model=\"queryParam.taskDefKey\"></a-input>-->\r\n                  <!--@change=\"handelChange\"-->\r\n                  <a-select\r\n                    placeholder=\"请选择任务环节\"\r\n                    v-model=\"taskDefKey\"\r\n                    @change=\"onTasklink\">\r\n                    <a-select-option v-for=\"Activity in TaskLinkList\" :value=\"Activity.id\">\r\n                      {{ Activity.name }}\r\n                    </a-select-option>\r\n                  </a-select>\r\n                </a-form-item>\r\n              </a-col>\r\n              <a-col>\r\n                <a-button style=\"margin-top: 10px;margin-left: 10px;\" v-if=\"toggleSearchStatusSet\"   @click=\"beforeConfirm\" type=\"primary\" icon=\"plus\">删除当前配置</a-button>\r\n              </a-col>\r\n              <!--<a-col :md=\"6\" :sm=\"8\">-->\r\n                <!--<a-form-item label=\"按钮列表\">-->\r\n                  <!--&lt;!&ndash;<a-input placeholder=\"请输入按钮名称\" v-model=\"queryParam.iButtonId\"></a-input>&ndash;&gt;-->\r\n                  <!--<a-select-->\r\n                    <!--placeholder=\"请选择按钮名称\"-->\r\n                    <!--v-model=\"iButtonId\"-->\r\n                    <!--@change=\"getButtonSetInfo\">-->\r\n                    <!--<a-select-option  v-for=\"(oaButton,index) in buttonList\" :key=\"index\" :value=\"oaButton.iid\">-->\r\n                      <!--{{ oaButton.sbtnName }}-->\r\n                    <!--</a-select-option>-->\r\n                  <!--</a-select>-->\r\n                <!--</a-form-item>-->\r\n              <!--</a-col>-->\r\n              <!--</template>-->\r\n              <!--<a-col :md=\"6\" :sm=\"8\" >-->\r\n              <!--<span style=\"float: left;overflow: hidden;\" class=\"table-page-search-submitButtons\">-->\r\n              <!--<a-button type=\"primary\" @click=\"searchQuery\" icon=\"search\">查询</a-button>-->\r\n              <!--<a-button type=\"primary\" @click=\"searchReset\" icon=\"reload\" style=\"margin-left: 8px\">重置</a-button>-->\r\n              <!--<a @click=\"handleToggleSearch\" style=\"margin-left: 8px\">-->\r\n              <!--{{ toggleSearchStatus ? '收起' : '展开' }}-->\r\n              <!--<a-icon :type=\"toggleSearchStatus ? 'up' : 'down'\"/>-->\r\n              <!--</a>-->\r\n              <!--</span>-->\r\n              <!--</a-col>-->\r\n            </a-row>\r\n          </a-form>\r\n        </div>\r\n\r\n        <!--水平分割-->\r\n        <!--<a-divider style=\"margin: 0px\"/>-->\r\n        <!-- table区域-begin -->\r\n        <!-- table区域-end -->\r\n        <span style=\"font-weight: 1000;font-size: 16px;\">配置:（位置相同名称必须一致）</span>\r\n        <!-- 表单区域 -->\r\n        <div>\r\n          <a-form>\r\n            <a-row :gutter=\"48\" style=\"margin-left: 25px\">\r\n              <template v-if=\"toggleSearchStatus\">\r\n                <!--<a-divider type=\"vertical\" style=\"margin-left: 110px;\"/>-->\r\n                <!--<a-divider type=\"vertical\"/>-->\r\n                <!--<a-form-item-->\r\n                <!--:labelCol=\"labelCol\"-->\r\n                <!--:wrapperCol=\"wrapperCol\"-->\r\n                <!--label=\"流程按钮关联ID\">-->\r\n                <!--<a-input-number v-decorator=\"[ 'iprocOpinionId', {}]\" />-->\r\n                <!--</a-form-item>-->\r\n                <!--<a-form-item-->\r\n                <!--:labelCol=\"labelCol\"-->\r\n                <!--:wrapperCol=\"wrapperCol\"-->\r\n                <!--label=\"业务流程配置ID\">-->\r\n                <!--<a-input-number v-decorator=\"[ 'iprocSetId', {}]\" />-->\r\n                <!--</a-form-item>-->\r\n                  <!--<a-form-item-->\r\n                    <!--:labelCol=\"labelCol\"-->\r\n                    <!--:wrapperCol=\"wrapperCol\"-->\r\n                    <!--label=\"业务功能\">-->\r\n                    <!--<a-select v-model=\"iProcSetId\" @change=\"getFunctionId\">-->\r\n                      <!--<a-select-option v-for=\"(item,index) in selectList\" :key=\"index\" :value=\"item.iprocSetId\">{{item.sname}}-->\r\n                      <!--</a-select-option>-->\r\n                    <!--</a-select>-->\r\n                  <!--</a-form-item>-->\r\n                <a-form-item\r\n                  style=\"margin:20px;\">\r\n                  <span>页面意见框位置：</span>\r\n                  <a-input-number @change=\"onitaskOpinionOrder\" v-model=\"itaskOpinionOrder\" />\r\n                </a-form-item>\r\n                <a-form-item\r\n                  style=\"margin:20px;\">\r\n                  <span>页面意见框名称：</span>\r\n                  <a-input style=\"width: 180px\" @change=\"onitaskOpinionName\" v-model=\"itaskOpinionName\" />\r\n                  <span v-show=\"showName\" style=\"margin-left: 10px;color: red\">序号为{{itaskOpinionOrder}}的意见框名字必须为\"{{opinionName}}\"。</span>\r\n                </a-form-item>\r\n\r\n<!--<div v-show=\"show\">-->\r\n<div>\r\n  <a-form-item  style=\"margin:20px;\">\r\n    <span>办文单意见类型:</span>\r\n    <a-select style=\"margin-left:15px;width: 330px\" v-model=\"type\" @change=\"getType\">\r\n      <a-select-option v-for=\"(item,index) in typeList\" :key=\"index\" :value=\"item.itemValue\">{{item.itemText}}\r\n      </a-select-option>\r\n    </a-select>\r\n  </a-form-item>\r\n</div>\r\n\r\n\r\n                <!--<a-form-item-->\r\n                  <!--:labelCol=\"labelCol\"-->\r\n                  <!--:wrapperCol=\"wrapperCol\"-->\r\n                  <!--label=\"\">-->\r\n                  <!--<a-input-hide v-model=\"procDefKey\" />-->\r\n                <!--</a-form-item>-->\r\n              </template>\r\n            </a-row>\r\n          </a-form>\r\n        </div>\r\n\r\n\r\n      </a-form>\r\n    </a-spin>\r\n  </a-modal>\r\n</template>\r\n\r\n<script>\r\n  import {httpAction,getAction,postAction,deleteAction} from '@/api/manage'\r\n  import pick from 'lodash.pick'\r\n  import moment from \"moment\"\r\n  import {JeecgListMixin} from '@/mixins/JeecgListMixin'\r\n  import ACol from \"ant-design-vue/es/grid/Col\";\r\n\r\n\r\n  export default {\r\n    name: \"OaProcOpinionNewModal\",\r\n    mixins: [JeecgListMixin],\r\n    components: {\r\n      ACol\r\n    },\r\n    data() {\r\n      return {\r\n        title: \"操作\",\r\n        visible: false,\r\n        show:false,//意见类型--显示控制\r\n        procDefKey:'',\r\n        showName:false,//是否显示提示\r\n        opinionName:'',//后台产生的名字\r\n        typeList:[],\r\n        taskDefKey:'',\r\n        type:'',//意见框类型：取数据字典下拉列表\r\n        sprocOpinionName:'',//意见组合名称\r\n        model: {},\r\n        labelCol: {\r\n          xs: {span: 24},\r\n          sm: {span: 5},\r\n        },\r\n        wrapperCol: {\r\n          xs: {span: 24},\r\n          sm: {span: 16},\r\n        },\r\n        opinionSetModal:{\r\n          itaskOpinionName:'',//意见框名称\r\n          itaskOpinionOrder:0,//意见框位置\r\n        },\r\n        itaskOpinionName:'',//意见框名称\r\n        itaskOpinionOrder:0,//意见框位置\r\n        TaskLinkList:[],//任务环节列表\r\n        TaskLinkId:'',//流程定义Id\r\n//业务模块---------------\r\n//         selectList: [],\r\n        // timeList:[],\r\n        // iProcSetId:'',\r\n\r\n\r\n        confirmLoading: false,\r\n        toggleSearchStatusSet:true,\r\n        form: this.$form.createForm(this),\r\n        validatorRules: {\r\n          iId: {rules: [{required: true, message: '请输入主键id!'}]},\r\n        },\r\n        url: {\r\n          list: \"/oaopinionset/oaOpinionSet/list\",\r\n          delete: \"/oaopinionset/oaOpinionSet/delete\",\r\n          deleteBatch: \"/oaopinionset/oaOpinionSet/deleteBatch\",\r\n          exportXlsUrl: \"oaopinionset/oaOpinionSet/exportXls\",\r\n          importExcelUrl: \"oaopinionset/oaOpinionSet/importExcel\",\r\n          add: \"/oaopinionset/oaOpinionSet/add\",\r\n          edit: \"/oaopinionset/oaOpinionSet/edit\"\r\n        }\r\n      }\r\n    },\r\n    created() {\r\n\r\n    },\r\n    computed: {\r\n      importExcelUrl: function () {\r\n        return `${window._CONFIG['domianURL']}/${this.url.importExcelUrl}`;\r\n      }\r\n    },\r\n    methods: {\r\n      //\r\n      getType(){\r\n        this.opinionSetModal.type=this.type\r\n      },\r\n      //修改意见组合名称\r\n      iTaskOpinionNewName(){\r\n        const that = this;\r\n        let httpurl = '';\r\n        let method = '';\r\n        if (!this.model.iid) {\r\n          httpurl += this.url.add;\r\n          method = 'post';\r\n        } else {\r\n          httpurl += this.url.edit;\r\n          method = 'put';\r\n        }\r\n        this.model.sprocOpinionName=this.sprocOpinionName;\r\n        // let formData = Object.assign(this.model, values);\r\n        httpAction(httpurl, {iid:this.model.iid,sprocOpinionName:this.model.sprocOpinionName,\r\n          procDefKey: this.model.procDefKey}, method).then((res) => {\r\n          if (res.success) {\r\n            that.$message.success(res.message);\r\n            that.$emit('ok');\r\n          } else {\r\n            that.$message.warning(res.message);\r\n          }\r\n        })\r\n      },\r\n      getTypeList(){//获取任务环节\r\n      let url=\"/sys/dict/getDictByKey\";\r\n      getAction(url, {dictKey: 'type'}).then(res => {\r\n        console.log('--------------------意见类型-下拉列表------------------------------');\r\n        console.log(res);\r\n        this.typeList=res.result;\r\n      });\r\n      },\r\n      getTaskLinkList(){//获取任务环节\r\n        let url=\"/wf/process/actsList\";\r\n        getAction(url, {processDefinitionId: this.TaskLinkId}).then(res => {\r\n          this.TaskLinkList = res.result;\r\n          if (this.taskDefKey==null||this.taskDefKey==''){\r\n            this.taskDefKey=this.TaskLinkList[0].id;//得到默认值\r\n          }\r\n          this.onTasklink();\r\n        });\r\n      },\r\n      onTasklink() {//请求表单数据\r\n        //初始化\r\n        this.showName==false//隐藏错误\r\n        this.toggleSearchStatus=true;\r\n        this.itaskOpinionName='';//意见框名称\r\n        this.itaskOpinionOrder=0;//意见框位置\r\n        // this.iProcSetId='';\r\n        let url=\"/oaopinionset/oaOpinionSet/queryByTaskDefKey\";\r\n        postAction(url, {taskDefKey: this.taskDefKey,iProcOpinionId: this.model.iid,procDefKey: this.procDefKey}).then(res => {\r\n          console.log('0000000000000000000000000000000');\r\n          console.log(res.result);\r\n          this.model.taskDefKey=this.taskDefKey;\r\n          if (res.success) {\r\n            this.toggleSearchStatusSet=true;\r\n            this.opinionSetModal=res.result;\r\n            // this.iProcSetId=this.opinionSetModal.iprocSetId;\r\n            this.itaskOpinionName=this.opinionSetModal.itaskOpinionName;//拟稿人\r\n            this.itaskOpinionOrder=this.opinionSetModal.itaskOpinionOrder; //读者\r\n            this.type=this.opinionSetModal.type//意见框类型\r\n          } else {\r\n            this.opinionSetModal.iid = null;\r\n            this.toggleSearchStatusSet=false;\r\n            // this.opinionSetModal.iProcSetId='';\r\n            this.opinionSetModal.itaskOpinionName='';//意见框名称\r\n            this.opinionSetModal.itaskOpinionOrder=0;//意见框位置\r\n            this.opinionSetModal.type=''//意见框类型\r\n          }\r\n\r\n        })\r\n      },\r\n      onitaskOpinionOrder(){\r\n        this.opinionSetModal.itaskOpinionOrder=this.itaskOpinionOrder;\r\n        this.jiaoYanXuh();\r\n      },\r\n      onitaskOpinionName(){\r\n        // console.log('-=-=_+_+_+_+_+++++++',JSON.stringify(this.itaskOpinionName));\r\n        this.opinionSetModal.itaskOpinionName=this.itaskOpinionName;\r\n        this.jiaoYanXuh();\r\n      },\r\n      jiaoYanXuh(){//改变时赋值并校验\r\n        let url=\"/oaopinionset/oaOpinionSet/queryByOrderAndKey\";\r\n        httpAction(url, {itaskOpinionOrder:this.itaskOpinionOrder,\r\n          procDefKey: this.model.procDefKey}, 'post').then((res) => {\r\n          if (res.success) {\r\n            // console.log(\"ffffffffffffffffffffffffffff\");\r\n            // console.log(res);\r\n            if (res.result!=null && this.itaskOpinionName==res.result[0].itaskOpinionName){\r\n              this.showName=false;\r\n            } else {\r\n              if (res.result==null){\r\n              this.showName=false;\r\n              }else {\r\n                this.showName=true;\r\n                this.opinionName=res.result[0].itaskOpinionName;\r\n              }\r\n            }\r\n          } else {\r\n            this.$message.warning(res.message);\r\n          }\r\n        })\r\n      },\r\n      //点击删除按钮 前校验\r\n      beforeConfirm(){\r\n        // console.log(this.btnSetModel)\r\n        if (this.opinionSetModal.iid==null){\r\n          this.$message.warning(\"当前信息不存在\");\r\n        }else {\r\n          let url='/oaopinionset/oaOpinionSet/verButtonSetDelete';\r\n          getAction(url,{id:this.opinionSetModal.iid}).then(res=>{\r\n            if (res.success){\r\n              // this.$message.success(res.message);\r\n              //调用弹框\r\n              this.showConfirm();\r\n            } else {\r\n              this.deleteOpinionSet();\r\n            }\r\n          });\r\n        }\r\n\r\n\r\n      },\r\n      //弹框\r\n      showConfirm(){\r\n        let that=this;\r\n        this.$confirm({\r\n          title:'你确定要删除吗？',\r\n          content:'您的某些业务已经使用了这套意见',\r\n          onOk(){\r\n            that.deleteOpinionSet();\r\n          },\r\n          onCancel(){\r\n          }\r\n        })\r\n      },\r\n      deleteOpinionSet(){\r\n        if (this.opinionSetModal.iid){\r\n          var that = this;\r\n          deleteAction(that.url.delete, {id: this.opinionSetModal.iid}).then((res) => {\r\n            if (res.success) {\r\n              that.$message.success(res.message);\r\n              // that.loadData();\r\n              this.itaskOpinionName='';//意见框名称\r\n              this.itaskOpinionOrder=0;//意见框位置\r\n              this.toggleSearchStatus=false;\r\n              this.toggleSearchStatusSet=false;\r\n              this.opinionSetModal.type=''//意见框类型\r\n            } else {\r\n              that.$message.warning(res.message);\r\n            }\r\n          });\r\n        }\r\n      },\r\n      add() {\r\n        this.edit({});\r\n      },\r\n      editBeforelvjian(record,TaskLinkId,res){\r\n        console.log(\"fdsfasafadfasdfsadfsadfsadfas\")\r\n        console.log(res);\r\n        this.taskDefKey= res.taskDefKey;\r\n        this.editlvjian(record,TaskLinkId);\r\n      },\r\n      editlvjian(record,TaskLinkId) {\r\n        this.toggleSearchStatus=false;\r\n        this.itaskOpinionName='';//意见框名称\r\n        this.itaskOpinionOrder=0;//意见框位置\r\n        this.opinionSetModal.type=''//意见框类型\r\n        //record---为上一页面数据，TaskLinkId---流程定义Key\r\n        // console.log('------------------888888888');\r\n        this.TaskLinkId=TaskLinkId;\r\n        console.log(this.TaskLinkId);\r\n        this.getTaskLinkList();//获取任务环节下拉列表\r\n        this.getFunctionList();\r\n        this.form.resetFields();\r\n        this.model = Object.assign({}, record);\r\n        // console.log(this.model);\r\n        this.sprocOpinionName=this.model.sprocOpinionName;\r\n        this.procDefKey=this.model.procDefKey;\r\n        this.visible = true;\r\n        // console.log(\"yyyyyyyyyyyyyyyyyyyyyyyyyyyyyyy\");\r\n        // console.log(record);\r\n        if (this.model.procDefKey==\"sendFile_hang\"){\r\n          this.show=true;\r\n        }else {\r\n          this.show=false;\r\n        }\r\n        this.$nextTick(() => {\r\n          this.form.setFieldsValue(pick(this.model, 'iid', 'procDefKey','sprocOpinionName'))\r\n          //时间格式化\r\n        });\r\n        //默认加载回显第一个\r\n        this.onTasklink();\r\n        this.getTypeList();\r\n      },\r\n      getFunctionList(){//获取全部业务下拉列表;\r\n        console.log('--------------------获取全部业务下拉列表-下拉列表------------------------------');\r\n\r\n        let url = \"/modify/fields/queryBusList\";\r\n        getAction(url, {}).then((res) => {\r\n\r\n          this.selectList = res.result;\r\n          // this.timeList = res.d_create_time;\r\n        });\r\n      },\r\n      getFunctionId(){\r\n        // this.opinionSetModal.iprocSetId=this.iProcSetId;\r\n        //   console.log('----------busFunction----------queryById------------------------------');\r\n        //   console.log(this.opinionSetModal.iprocSetId);\r\n      },\r\n      close() {\r\n        this.$emit('close');\r\n        this.visible = false;\r\n      },\r\n\r\n      handleOk() {\r\n        // this.opinionSetModal.iProcSetId=this.iProcSetId;\r\n        console.log('-=-=-=',JSON.stringify(this.opinionSetModal));\r\n        const that = this;\r\n        // 触发表单验证\r\n        this.form.validateFields((err, values) => {\r\n          if (!err) {\r\n            that.confirmLoading = true;\r\n            let httpurl = '';\r\n            let method = '';\r\n            if (this.opinionSetModal.iid==null || this.opinionSetModal.iid == undefined || !this.opinionSetModal.iid) {\r\n              console.log('----------------------------------090');\r\n              console.log(this.opinionSetModal);\r\n              this.opinionSetModal.iprocOpinionId=this.model.iid;\r\n              this.opinionSetModal.procDefKey=this.model.procDefKey;\r\n              this.opinionSetModal.taskDefKey=this.taskDefKey;\r\n              httpurl += this.url.add;\r\n              method = 'post';\r\n            } else {\r\n              httpurl += this.url.edit;\r\n              method = 'put';\r\n            }\r\n            let formData = Object.assign(this.opinionSetModal, values);\r\n            if (this.showName==false){//校验没问题时才能提交\r\n              //时间格式化\r\n              httpAction(httpurl, formData, method).then((res) => {\r\n                if (res.success) {\r\n                  that.$message.success(res.message);\r\n                  that.$emit('ok');\r\n                } else {\r\n                  // that.$message.warning(res.message);\r\n                }\r\n              }).finally(() => {\r\n                that.confirmLoading = false;\r\n                that.close();\r\n              })\r\n            }else {\r\n              that.$message.warning(\"相同序号，意见名称必须相同\");\r\n              that.close();\r\n            }\r\n\r\n          }\r\n        })\r\n      },\r\n      handleCancel() {\r\n        this.close()\r\n      }\r\n\r\n    }\r\n\r\n  }\r\n</script>\r\n\r\n<style lang=\"less\" scoped>\r\n\r\n</style>"]}]}