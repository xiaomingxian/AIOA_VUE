{"remainingRequest":"C:\\xxm\\work\\jd\\fore\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\xxm\\work\\jd\\fore\\src\\views\\mytask\\taskList\\detailFile2.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\xxm\\work\\jd\\fore\\src\\views\\mytask\\taskList\\detailFile2.vue","mtime":1579587911308},{"path":"C:\\xxm\\work\\jd\\fore\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1570779194464},{"path":"C:\\xxm\\work\\jd\\fore\\node_modules\\babel-loader\\lib\\index.js","mtime":1570779245522},{"path":"C:\\xxm\\work\\jd\\fore\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1570779194464},{"path":"C:\\xxm\\work\\jd\\fore\\node_modules\\vue-loader\\lib\\index.js","mtime":1570779225726}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport {getAction, postAction} from \"../../../api/manage\";\nimport {JeecgListMixin} from \"../../../mixins/JeecgListMixin2\";\nimport taskBtn from '../../buttons/taskBtn'\nimport taskOpt from '../../buttons/taskOpt'\nimport JEditor from '@/components/jeecg/JEditor'\nimport {ntkoBrowser} from '../../buttons/btn-js/ntkobackground.min.js'\nimport ReleaseScope from \"@/views/oaBus/pageModels/releaseScope\";\n//业务页面\nimport sendFile from '@/views/mytask/taskList/sendFile'\nimport receiveFile from '@/views/mytask/taskList/receiveFile'\nimport MeetingRoomFile from \"@/views/mytask/taskList/meetingRoomFile\";\nimport MeetintInform from \"@/views/mytask/taskList/meetingInform\";\nimport MeetingNotice from \"@/views/mytask/taskList/meetingNotice\";\nimport ElectronicFile from \"@/views/mytask/taskList/electronicFile\";\nimport SynthesizeFile from \"./synthesizeFile\";\nimport SignQutoFile from \"./signQutoFile\";\nimport InsideReadingFile from \"./insideReadingFile\";\nimport sendFileFuZhou from \"@/views/mytask/taskList/sendFileFuZhou\";\nimport electricRoom from \"./electricRoom\";\nimport electricEquipment from \"./electricEquipment\";\nimport caseClues from \"@/views/mytask/taskList/caseClues\";\nimport oaTeamworkSetListModel from \"@/views/oaTeamwork/modules/oaTeamworkSetListModel\";\nimport preview from \"./preview\";\nimport videoMeet from \"./videoMeet\";\nimport passportHand from \"./passportHand\";\nimport lanAccess from \"./lanAccess\";\n\n\nexport default {\n  name: \"detailFile\",\n  inject: ['reload'],\n  mixins: [JeecgListMixin],\n  components: {\n    lanAccess,\n    electricEquipment,\n    electricRoom,\n    passportHand,\n    videoMeet,\n    caseClues,\n    sendFileFuZhou,\n    preview,//预览页面\n    InsideReadingFile,\n    SignQutoFile,\n    SynthesizeFile,\n    MeetingNotice,\n    ElectronicFile,\n    ReleaseScope,\n    taskBtn,\n    taskOpt,\n    JEditor,\n    //业务\n    sendFile,\n    MeetintInform,\n    MeetingRoomFile,\n    receiveFile,\n    oaTeamworkSetListModel\n  },\n  data() {\n    return {\n      visible: false,\n      title: '业务详情',\n      confirmLoading: false,\n      userData: '',\n      disableFlag: false,\n      secretDegree: [],\n      xietongList: [],\n      Ints: [],\n      iteamworkId: '',\n      iorder: '',\n      scrHeight: '',\n      urgencyList: [],\n      secretModle: '',\n      i_urgency: '',\n      TableName: '',\n      busModelId: '',\n      functionId: '',\n      newDataId: '',\n      iteamworkSetId: '',\n      isShowFile: false, //附件按钮控制\n      //富文本的高度\n      newHeight: 300,\n      //电子公告模板\n      previewFlag: true,\n      //代办信息\n      task: {},\n      //已办信息\n      taskDone: '',\n      opts: [],//意见框信息\n      pageRef: '',//意见框信息\n      editValue: 0,\n      //意见表相关\n      backDataOpt: {\n        //回填数据id\n        table: 'oa_busdata20_opinion',\n        i_id: \"\",\n        i_opinion_set_id: \"\",\n        i_bus_function_id: \"\",\n        i_busdata_id: \"\",\n        s_name: \"\",\n        i_user_id: \"\",\n        d_sign: \"\",\n        s_opinion: \"\",\n        s_opinion_type: \"\",\n        s_task_id: \"\",\n        s_task_name: \"\",\n        s_overt: \"\",\n        i_order: \"\",\n        s_tpye: \"\",\n        s_dept_id: \"\",\n        s_dept_name: \"\",\n        s_taskdef_key: \"\"\n      },\n      detailList: null,    //  文档数据   字段含义\n      oaFileList: [],    //  文档数据   字段含义\n      busFunction: {},\n      busTextData: {},\n      routeParam: '',\n      optionMap: {},\n      intslist: [],\n      busDataId: '',\n      dataId: '',\n      iversion: '',\n      //表中的数据相关值\n      dealBtn: {},\n      //表中的数据相关值\n      jeditShow: false,   //富文本编辑器的内容的value值\n      isLimitsShow: false,   //富文本编辑器的内容的value值\n      jeditor: {\n        value: ''\n      },\n      backData: {},\n      //发布范围相关\n      publishData: {\n        iIsLimits: '', //选择范围（1 全行 2 部门 3 用户）\n        departId: '',  //部门ids\n        userRealName: '', //用户名称\n        userIdS: '',//用户ids\n      },\n      url: {\n        list: \"/oateamwork/oaTeamworkSet/findListByteamworkId\",//\n        selectInts: \"/oateamwork/oaTeamworkSet/findListByteamworkId\",//\n        selectNext: \"/oateamwork/oaTeamworkSet/selectNext\",//协同办公配置的查询\n        Intslist: \"/oaTea/oaTeamworkInst/querylist\",\n        optionAndBtn: '/oaBus/newTask/optionAndBtn',\n        currentUserMsg: '/sys/user/getUserSectionInfoByToken',\n        updateReadStatus: '/oaBus/taskInAct/changeStatus',\n        selectTaskType: '/oaBus/busModel/list',\n        selectTask: '/oaBus/busModel/list',\n        queryOaFileList: '/oaBus/oaFile/queryOaFileList',\n        functionQuery: '/oaBus/busFunction/list',\n        insert: '/oaBus/dynamic/insert',//动态新增数据\n        updateBusdata: '/oaBus/dynamic/update',//动态修改数据\n\n        /*加载数据*/\n        busDataAndColums: 'oaBus/oaBusdata/queryBusdataById',\n\n      },\n\n      userinfo: '',\n      userid: ''\n\n    }\n  },\n  created() {\n    this.scrHeight = window.innerHeight - 60 + 'px';\n    //监听页签切换  修改标题\n    var _this = this;\n    document.addEventListener('visibilitychange', function () {\n      // document.title = _this.backData.s_right_parameter\n      document.title = '[' + _this.backData.s_right_parameter + ']' + _this.backData.s_title\n      // document.title = document.hidden?'拜拜11111':' 回来啦2222'\n      if (document.hidden) {\n        _this.showBtn(_this.butArrLists);\n      }\n    })\n\n    /*let param = this.$route.params ;\n    console.log(param)\n    this.show(param)*/\n    this.changRouter()\n    getAction(this.url.currentUserMsg).then(res => {\n      this.userData = res.result\n    })\n    //获取用户基本信息\n    const userinfo = JSON.parse(localStorage.getItem('userdata')).userInfo;\n    console.log(userinfo);\n    this.userinfo = userinfo;\n    this.userid = userinfo.id;\n    // this.showOpen(this.userid);\n  },\n  destroyed() {\n    this.backData = {};\n    this.destroy = false;\n  },\n  watch: {\n    '$route.query': function (newVal, oldVal) {\n      if (JSON.stringify(newVal) !== '{}') {\n        console.log(newVal)\n        this.reload();\n        this.show(newVal);\n      }\n    }\n  },\n  methods: {\n    // jeditorBlurText(){\n    //   if(this.$refs.jeditor.value == ''){\n    //     this.$refs.jeditor.$el.style.border = '1px solid red';\n    //   }else {\n    //     this.$refs.jeditor.$el.style.border = '1px solid #d9d9d9';\n    //   }\n    //\n    // },\n\n    //下一任务时校验对应点数据，并修改方法\n    nextCheckDataFun() {\n      this.$refs[this.pageRef].nullText();\n    },\n    //----------------webSocket的处理\n    initWebSocket: function (userId) {\n      // 将busdataId作为路径，传到服务器中\n      // WebSocket与普通的请求所用协议有所不同，ws等同于http，wss等同于https\n      var url = window._CONFIG['domianURL'].replace(\"https://\", \"ws://\").replace(\"http://\", \"ws://\") + \"/websocket/\" + userId;\n      //alert(url)\n      this.websock = new WebSocket(url);\n      this.websock.onopen = this.websocketonopen;\n      this.websock.onerror = this.websocketonerror;\n      this.websock.onmessage = this.websocketonmessage;\n      this.websock.onclose = this.websocketclose;\n    },\n    websocketonopen: function () {\n\n      var url = window._CONFIG['domianURL'].replace(\"https://\", \"ws://\").replace(\"http://\", \"ws://\") + \"/websocket/\";\n\n      console.log(\"WebSocket连接成功\", url);\n    },\n    websocketonerror: function (e) {\n      console.log(\"WebSocket连接发生错误\");\n    },\n    websocketonmessage: function (e) {\n      //console.log(e.data)\n      var data = eval(\"(\" + e.data + \")\");\n      //处理订阅信息\n      if (data.cmd == \"topic\") {\n        //TODO 系统通知\n        console.log(e)\n      } else if (data.cmd == \"user\") {\n        //TODO 用户消息\n        console.log(e.data)\n        let res = JSON.parse(e.data)\n        if (res.msgTxt == \"qiCao\") {\n          console.log(this.dealBtn);\n          //this.$refs.taskRef.saveBusData();\n          this.$refs[this.pageRef].saveNoCheck()\n          //this.$refs.taskRef.alertBtnStaus(res.msgTxt,this.dealBtn) ;\n        }\n        //if(e.data.m)\n      }\n    },\n    websocketclose: function (e) {\n      console.log(\"connection closed (\" + e.code + \")\");\n    },\n    //----------------webSocket的处理end\n\n\n    getbackDataNew(ref) {\n      console.log('++++==============', ref)\n      this.backData = this.$refs[ref].getBackDataNew()\n\n      return this.$refs.taskRef.setBackDataNew(this.backData)\n    },\n    // 协同办公\n    callaboration() {\n      getAction(this.url.Intslist).then((res) => {\n        this.intslist = res.result;\n        if (this.intslist.length == 0) {\n          this.$refs.teamword.showOpen(this.userid, this.backData, this.busDataId);\n        } else {\n          this.dataId = this.intslist[this.intslist.length - 1].ibusdataId;\n          this.iteamworkId = this.intslist[this.intslist.length - 1].iteamworkId;\n          this.iorder = this.intslist[this.intslist.length - 1].iorder + 1;\n          this.iteamworkSetId = this.intslist[this.intslist.length - 1].iteamworkSetId\n          if (this.dataId != Number(this.busDataId)) { //新的流程\n            console.log(this.dataId)\n            console.log(this.busDataId)\n            this.$refs.teamword.showOpen(this.userid, this.backData, this.busDataId);\n          } else {\n            console.log(this.dataId)\n            getAction(\"/oateamwork/oaTeamworkSet/findMax\", {TeamworkId: this.iteamworkId}).then(res => {\n              this.maxOrder = res.result\n              console.log(this.iorder - 1)\n              console.log(this.maxOrder)\n              if (Number(this.iorder - 1) < Number(this.maxOrder)) {\n                //开始查下一个环节的任务id\n                getAction(this.url.selectNext, {iTeamworkId: this.iteamworkId, iOrder: this.iorder}).then((res) => {\n                  console.log(res)\n                  this.busModelId = res.ibusModelId\n                  this.functionId = res.ibusFunctionId\n                  let param = {\n                    modelId: res.ibusModelId,\n                    functionId: res.ibusFunctionId,\n                  }\n\n\n                  postAction(\"/oaBus/oaBusdata/queryNewTaskMsg\", param).then(res => {\n                    if (res.success) {\n                      const promise1 = new Promise((resolve => {\n                        this.newDataId = JSON.stringify(res.result.busdataId)\n                        console.log(JSON.stringify(res.result));\n                        // console.log(window.location);\n                        // window.location.href(window.location.origin + '/mytask/taskList/Test-detailFile?tableName=' + res.result.tableName + '&busdataId=' + res.result.busdataId + '&navisshow=false')\n                        this.$router.push({path: '/mytask/taskList/Test-detailFile?tableName=' + res.result.tableName + '&busdataId=' + res.result.busdataId + '&navisshow=false'})\n                        resolve(this.newDataId)\n                      }))\n\n\n                      promise1.then((newDataId) => {\n                        console.log(this.newDataId)\n                        // console.log(res.ibusModelId)\n                        console.log(this.iteamworkSetId)\n                        let data1 = {\n                          iteamworkId: this.iteamworkId,\n                          iteamworkSetId: this.iteamworkSetId,\n                          iorder: this.iorder,\n                          ibusdataId: newDataId,\n                          iversion: this.intslist[this.intslist.length - 1].iversion,\n                          ibusModelId: this.busModelId,\n                          ibusFunctionId: this.functionId\n                        }\n                        let dataList = {\n                          data1: data1\n                        }\n                        postAction(\"/oaTea/oaTeamworkInst/add\", dataList).then(res => {\n                          if (res.success) {\n                            this.$message.success(res.message)\n                          } else {\n                            this.$message.error(res.message)\n                          }\n                        })\n\n                      })\n\n                    } else {\n                      this.$message.error(res.message)\n                    }\n                  })\n\n                })\n              } else {\n                this.$message.warn('协同任务已完成')\n              }\n\n            })\n\n\n          }\n\n        }\n\n      })\n\n\n      /* const promise1 = new Promise((resolve,reject)=>{\n         console.log(this.backData.s_right_parameter)\n         getAction(this.url.list, {TeamworkName: this.backData.s_right_parameter}).then(res => {\n           this.xietongList = res;\n           console.log(res)\n           resolve( this.xietongList )\n         })\n       })\n       promise1.then((lists)=>{\n         // this.findMax(lists);\n         new Promise((resolve,reject)=>{\n           getAction(\"/oaTea/oaTeamworkInst/findMax\",{iteamworkId:lists[0].iteamworkId}).then(res => {\n             resolve(res.result,lists)\n           })\n         }).then((maxOrder,e)=>{\n           console.log(maxOrder);\n           console.log(e);\n\n           if( typeof (maxOrder)== 'String'|| typeof (maxOrder)== 'undefined'){\n             console.log(111);\n             this.findTableName(lists[0].ibusModelId,lists[0].ibusFunctionId);\n             let Datas = {\n               iteamworkId:lists[0].iteamworkId,\n               iteamworkSetId:lists[0].iid,\n               iorder:0,\n               ibusModelId:lists[0].ibusModelId,\n               ibusFunctionId:lists[0].ibusFunctionId\n             }\n             postAction(\"/oaTea/oaTeamworkInst/add\", Datas).then(res => {\n               if (res.success) {\n                 this.$message.success(res.message)\n               } else {\n                 this.$message.error(res.message)\n               }\n             })\n           }\n           else{\n             const promise1 = new Promise((resolve,reject)=>{\n               console.log(this.backData.s_right_parameter)\n               getAction(this.url.list, {TeamworkName: this.backData.s_right_parameter}).then(res => {\n                 this.xietongList = res;\n                 console.log(res)\n                 resolve( this.xietongList )\n               })\n             })\n             promise1.then((lists)=>{\n               // this.findMax(lists);\n               new Promise((resolve,reject)=>{\n                 getAction(\"/oaTea/oaTeamworkInst/findMax\",{iteamworkId:lists[0].iteamworkId}).then(res => {\n                   resolve(res.result,lists)\n                 })\n               }).then((maxOrder,e)=>{\n                 console.log(maxOrder);\n                 console.log(e);\n                 if(maxOrder<=lists[maxOrder].iorder){\n                   console.log(222);\n                   console.log(lists[maxOrder])\n                   this.findTableName(lists[maxOrder+1].ibusModelId,lists[maxOrder+1].ibusFunctionId);\n                   let Datas = {\n                     iteamworkId:lists[maxOrder].iteamworkId,\n                     iteamworkSetId:lists[maxOrder].iid,\n                     iorder:lists[maxOrder].iorder,\n                     ibusModelId:lists[maxOrder].ibusModelId,\n                     ibusFunctionId:lists[maxOrder].ibusFunctionId\n                   }\n                   postAction(\"/oaTea/oaTeamworkInst/add\", Datas).then(res => {\n                     if (res.success) {\n                       this.$message.success(res.message)\n                     } else {\n                       this.$message.error(res.message)\n                     }\n                   })\n\n                 }\n               })\n\n             }).then(()=>{\n             })\n           }\n         })\n     }).then(()=>{\n       })*/\n\n\n    },\n    findMax(lists) {\n      return new Promise((resolve, reject) => {\n        console.log(lists[0].iteamworkId)\n        getAction(\"/oaTea/oaTeamworkInst/findMax\", {iteamworkId: lists[0].iteamworkId}).then(res => {\n          this.maxOrder = res.result\n          console.log(this.maxOrder)\n          resolve(lists)\n        })\n      })\n\n    },\n    getBackData(backData) {\n      //最新业务详情回传\n      // this.$refs.taskRef.backData = backData\n      // this.$refs.taskRef.reload()\n\n    },\n    changRouter(value) {\n      let param = this.$route.query;\n      if (param.haveTask != undefined && param.haveTask) {\n        this.task = param.task\n      }\n      //console.log(this.$route.query);\n      this.show(param)\n    },\n    //获取发布范围数据\n    change1(data) {\n      for (var i in  data) {\n        this.publishData = data\n      }\n    },\n    //获取用户ids\n    userIDs(data) {\n      this.publishData.userIdS = data;\n    },\n    userNames(data) {\n      this.publishData.userRealName = data.join(',');\n    },\n    //发布按钮\n    publishInform() {\n      // this.$refs[this.pageRef].isSelectDate();\n      this.$refs.resleaseScope.handerOk();\n    },\n    //取消发布\n    unpublishBtn() {\n      this.$refs.resleaseScope.unpublish();\n    },\n    //确定发布按钮\n    // isPublish(data) {\n    //   if (data == true) {\n    //     //调用发布\n    //     this.$refs.resleaseScope.handerOk();\n    //   } else {\n    //     // this.$refs[this.pageRef].save(data)\n    //     this.$refs.resleaseScope.handerOk();\n    //   }\n    // },\n    validDate(date) {\n      this.backData.d_datetime1 = date;\n      // alert(this.backData.d_datetime1)\n    },\n    //发送通知\n    submit(data) {\n      this.$refs[this.pageRef].submit(data)\n    },\n\n    /*登记文号数据*/\n    saveDocNum(data) {\n      //this.ntko['i_file_num_id'] = data.id\n      this.$refs[this.pageRef].saveDocNum(data)\n    },\n    //公文链接数据\n    saveGongwenData(data) {\n      this.$refs[this.pageRef].saveGongwenData(data)\n    },\n    //封发日期数据\n    saveDelTime(data) {\n      this.$refs[this.pageRef].saveDelTime(data)\n\n    },\n    // 关注件--是否重要\n    iIsImportantObj(e) {\n      this.$refs[this.pageRef].iIsImportant()\n    },\n    //销假--添加销假时间\n    destoryObj(e) {\n      //保存业务模板数据\n      this.$refs[this.pageRef].destory()\n    },\n    //保存所有数据\n    savaObj() {\n      //校验富文本编辑器数据\n      if (this.busFunction.iisEditor == 1) {\n        let params = {}\n        params.table = \"oa_busdata_text\";\n        params.i_busdata_id = this.backData.i_id;\n        params.s_text = this.jeditor.value;\n        params.s_busdata_table = this.backData.table\n        if (this.editValue == 0 && this.busTextData == null) {\n          postAction(this.url.insert, params).then(res => {\n            this.editValue = res.result.i_id// console.log(res.result.i_id); //富文本id\n          })\n        } else {\n          params.i_id = this.busTextData.i_id;\n          postAction(this.url.updateBusdata, {\n            'updateBusdata': params\n          }).then(res => {\n          })\n        }\n      }\n      //保存业务模板数据\n      this.$refs[this.pageRef].save()\n\n      // this.$emit('close');\n      // this.visible = false;\n    },\n    /* openFile(cmd, fileName) {\n       let ntkoed = ntkoBrowser.ExtensionInstalled();\n       if (ntkoed) {\n         ntkoBrowser.openWindow(window.location.origin + \"/ntko/editindex.html?cmd=\" + cmd + \"&fileName=\" + fileName + \"&userName=\" + \"admin\" + \"&sbtnid=\" + 43);\n       } else {\n         window.open(window.location.origin + \"/ntko/exeindex.html\")\n       }\n       window.ntkoCloseEvent = function () {\n         // alert(\"跨浏览器插件应用程序窗口已关闭\")\n       }\n     },*/\n    optsGet(opts) {\n      this.opts = opts\n    },\n    //修改机密\n    change(e) {\n      this.backData.i_safetylevel = e;\n\n      //更新缓急--往缓存里存储一份\n      localStorage.setItem('密级:' + this.backData.table + this.backData.i_id, e)\n      // let params = {table: this.backData.table, i_id: this.backData.i_id, i_safetylevel: this.backData.i_safetylevel}\n      // postAction(this.url.updateBusdata, params).then((rec) => {\n      //   console.log(rec)\n      // })\n    },\n    //修改缓急\n    changeUrgency(e) {\n      this.backData.i_urgency = e;\n      //更新缓急--往缓存里存储一份\n      localStorage.setItem('缓急:' + this.backData.table + this.backData.i_id, e)\n\n      // let params = {table: this.backData.table, i_id: this.backData.i_id, i_urgency: this.backData.i_urgency}\n      // postAction(this.url.updateBusdata, params).then((rec) => {\n      //   console.log(rec)\n      // })\n    },\n    changeHuanJi(e) {\n      this.backData.i_urgency = e\n    },\n    //详情页面数据\n    showTaskInAct(taskDetail, task) {\n      //查询出优先级\n      this.task = task\n      this.show(taskDetail)\n    },\n    dealHeight(btn) {\n      let btnHegiht = 30;\n      console.log(btn)\n      if (btn.isNotDefend != undefined && btn.isNotDefend.length != 0) {\n        btnHegiht += 70;\n      }\n      if (btn.isDefend != undefined && btn.isDefend.length != 0) {\n        btnHegiht += 60;\n      }\n      // console.log(\"AAAAAAAAAAAAAAAAAAAAAAAA\", btnHegiht)\n      this.scrHeight = window.innerHeight - btnHegiht + 'px';\n      console.log(btnHegiht)\n    },\n    //--------------------------------------   展示业务大详情    弹窗-----------------------------------------------------------------------------\n    show(taskDetail) {\n\n      document.title = ' '\n      let param = {\n        tableName: taskDetail.tableName,\n        busdataId: taskDetail.busdataId\n      }\n      //************************************************* 任务相关参数  START\n      if (taskDetail.task != undefined) {\n        this.task = JSON.parse(taskDetail.task)\n      }\n\n      if (this.task.id != undefined && this.task.id != '') {\n        param.taskId = this.task.id\n        param.taskDefinitionKey = this.task.taskDefinitionKey\n        param.name = this.task.name\n        param.proInstanId = this.task.processInstanceId\n      }\n\n      if (this.task.hiTaskId != undefined && this.task.hiTaskId != '') {\n        param.taskId = this.task.hiTaskId\n        param.proInstanId = this.task.processInstanceId\n        param.taskDefinitionKey = this.task.taskDefinitionKey\n\n      }\n      //标记状态 已办 待办\n      if (taskDetail.status != undefined) {\n        param.status = taskDetail.status\n      }\n      //************************************************* 任务相关参数  END\n\n      postAction(this.url.busDataAndColums, param).then((res) => {\n        if (res.success) {\n\n          //  修改标题\n          document.title = '[' + res.result.oaBusdata.s_right_parameter + ']' + res.result.oaBusdata.s_title\n          this.backData.key = res.result.btnAndOpt.key;\n          this.optSet(res.result.btnAndOpt.opt, this.backData.key);\n          //处理显示高度\n          if (res.result.btnAndOpt.btn != undefined) {\n            this.dealHeight(res.result.btnAndOpt.btn);\n          }\n          //如果非默认按钮不是未定义且不为空的话，就将开启websocket\n          if (res.result.btnAndOpt.btn.isNotDefend != undefined && res.result.btnAndOpt.btn.isNotDefend.length > 0) {\n            console.log(res.result.btnAndOpt.btn)\n            let qiCaoIndex = -1;         //起草底稿按钮的标志\n            let editDiGaoIndex = -1;     //编辑底稿按钮的标志\n            //开启websocket\n            this.initWebSocket(res.result.oaBusdata.i_id);\n            for (let i = 0; i < res.result.btnAndOpt.btn.isNotDefend.length; i++) {\n              if (res.result.btnAndOpt.btn.isNotDefend[i].smethod == 'qiCao') {\n                qiCaoIndex = i;\n              }\n              if (res.result.btnAndOpt.btn.isNotDefend[i].smethod == 'editDiGao') {\n                editDiGaoIndex = i;\n              }\n            }\n            if (qiCaoIndex >= 0) {\n              //当前业务已经起草底稿\n              if (res.result.oaBusdata.i_is_draft != undefined && res.result.oaBusdata.i_is_draft == 1) {\n                //将起草底稿按钮去除\n                res.result.btnAndOpt.btn.isNotDefend.splice(qiCaoIndex, 1);\n              } else {    //当前业务没有起草底稿\n                if (editDiGaoIndex >= 0) {\n                  this.dealBtn = res.result.btnAndOpt.btn.isNotDefend[editDiGaoIndex];\n                  res.result.btnAndOpt.btn.isNotDefend.splice(editDiGaoIndex, 1);\n                }\n              }\n            }\n            console.log(res.result.btnAndOpt.btn)\n          }\n          //为按钮赋值\n          this.$refs.taskRef.showBtn(res.result.btnAndOpt.btn);\n\n          //附件按钮权限控制\n          postAction('/oaBus/oaFile/isFileBtn', res.result.btnAndOpt.btn).then(res => {\n            if (res.success && res.result == true) {\n              this.isShowFile = true;\n            }\n          })\n          //字典值获取\n          this.optionMap = res.result.optionMap;\n          this.secretDegree = res.result.optionMap.secretDegree;\n          this.urgencyList = res.result.optionMap.i_urgency_option;\n          //业务数据赋值\n\n          this.backData = res.result.oaBusdata;\n          this.backData['iprocSetId'] = res.result.proSetId;\n          this.backData['key'] = res.result.taskDefKey\n          this.backData.act_show = res.result.actShow\n\n\n          this.backDataOpt.s_task_id = res.result.taskId\n          //机密等级\n          let secretModleTest = this.backData.i_safetylevel;\n          this.secretModle = JSON.stringify(secretModleTest)\n          //缓急\n          this.i_urgency = this.backData.i_urgency\n\n          //文档数据\n          this.detailList = res.result.detailList;\n\n          this.busDataId = res.result.busdataId;\n\n          this.busFunction = res.result.busFunction;\n          this.busTextData = res.result.busTextData;\n          //处理是否为电子公告预览页面\n          let userInfo = JSON.parse(window.localStorage.getItem('userdata')).userInfo;\n          if (this.backData.s_create_by != userInfo.id && this.busFunction.iisProc == 0 && this.busFunction.iisEditor == 1) {\n            this.pageRef = 'preview';\n            if (this.busTextData != null) {\n              this.jeditor.value = this.busTextData.s_text;\n            }\n            this.$refs.editTable.style.border = \"0px solid rgb(145, 56, 56)\";\n            //this.$refs.editTable.style.height=\"500px\" ;\n            this.jeditShow = true;\n            this.newHeight = 500;\n            this.previewFlag = false;\n            this.disableFlag = true;\n          } else {\n            //if(this.busFunction.)\n            //富文本显示控制\n            this.pageRef = res.result.pageRef;\n            if (this.busFunction.iisEditor == 1) {\n              if (this.busTextData != null) {\n                this.jeditor.value = this.busTextData.s_text;\n              }\n              this.jeditShow = true;\n            }\n            if (this.busFunction.iisLimits == 1) {\n              this.isLimitsShow = true;\n            }\n          }\n\n          // /**\n          //  * 刷新页面后,task数据覆盖\n          //  */\n          this.task.pageRef = res.result.pageRef\n          this.task.id = res.result.taskId\n          this.task.taskDefinitionKey = res.result.taskDefKey\n          this.task.processDefinitionId = res.result.processDefinitionId\n          this.task.processInstanceId = res.result.processInstanceId\n\n        } else {\n          this.$message.error(res.message)\n        }\n\n\n      })\n      this.visible = true\n\n    },\n    //子孙组件事件回传\n    watchSub(e) {\n      this.getOaFileList(this.backData.table, this.backData.i_id);\n    },\n    //意见id赋值  区分新增与更新\n    // optSet(opts, key) {\n    //   console.log('----------', JSON.stringify(opts))\n    //   for (let i in opts) {\n    //     if (opts[i].taskDefKey == key) {\n    //       this.backDataOpt.i_id = opts[i].optId\n    //     }\n    //   }\n    // },\n    optSet(opts, key) {\n      var map2 = []\n      var keys = []\n      var map = {}\n\n      for (let i in opts) {\n        let key = opts[i].optionName\n        if (keys.indexOf(key) < 0) {\n          keys.push(key)\n        }\n\n        if (map[key] == undefined) {\n          map[key] = opts[i]\n          map[key].optionContext2 = ''\n          map[key].optionContext2 += opts[i].optionContext + '\\t' + opts[i].signName + '\\t' + opts[i].signTime + '\\n'\n          map[key].taskDefKeys = []\n          map[key].taskDefKeys.push(map[key].taskDefKey)\n        } else {\n          let optx = opts[i].optionContext + '\\t' + opts[i].signName + '\\t' + opts[i].signTime + '\\n'\n          map[key].optionContext2 += optx\n          if ((map[key].taskDefKeys).indexOf(opts[i].taskDefKey) < 0) {\n            map[key].taskDefKeys.push(opts[i].taskDefKey)\n          }\n        }\n\n\n        if (opts[i].taskDefKey == key) {\n          this.backDataOpt.i_id = opts[i].optId\n        }\n      }\n\n      for (let i of keys) {\n        map2.push(map[i])\n      }\n      this.$refs.taskOptRef.showOpt(map2);\n    },\n\n\n    ok() {\n      this.handleCancel()\n    },\n\n    getOaFileList(tableName, busDataId) {\n      this.$refs[this.pageRef].getOaFiles(tableName, busDataId);\n      this.$refs[this.pageRef].getBanWenFiles(tableName, busDataId);\n    },\n    downFiles() {\n      this.$refs[this.pageRef].downAllFiles();\n    },\n    handleCancel() {\n      //刷新数据  若测试该方法有效  请删除多余代码\n      this.reload();\n\n      /*  this.$emit('close');\n        this.jeditor.value = '';\n        this.publishData = \"\";\n        this.editValue == 0\n        this.visible = false;\n        this.disableSubmit = false;\n        //清除意见与按钮页面数据\n        this.$refs.taskOptRef.clear()\n\n        //刷新父页面\n        this.$emit('reload_todo')*/\n    }, onChange(date, dateString) {\n      // console.log(date, dateString);\n    }, onChange2(date, dateString) {\n      // console.log(date, dateString);\n    }\n\n  }\n}\n",{"version":3,"sources":["detailFile2.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA6LA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;;AAGA;;AAEA;;AAEA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA","file":"detailFile2.vue","sourceRoot":"src/views/mytask/taskList","sourcesContent":["<template>\r\n\r\n  <form style=\"background-color: #fff;padding-top: 20px;\">\r\n    <!--<div v-show=\"true\" @change=\"changRouter\" v-model=\"routeParam\">{{this.$route.params.tableName}}</div>-->\r\n    <center>\r\n      <div :style=\"{height: scrHeight}\" style=\"overflow: auto;\">\r\n        <table width=\"87%\" border=\"0\">\r\n\r\n          <tr v-show=\"previewFlag\">\r\n            <td style=\"padding: 2% 0%;\" align=\"right\" colspan=\"3\">\r\n              密级：\r\n              <!--<a-select style=\"width: 120px\" v-model=\"bacwangzhaData.i_safetylevel\" placeholder=\"请选择密级\" @change=\"change\">-->\r\n              <a-select style=\"width: 120px;margin-right: 27px;\" v-model=\"secretModle\" placeholder=\"请选择密级\"\r\n                        @change=\"change\">\r\n                <a-select-option v-for=\"(item,index) in secretDegree\" :key=\"index\" :text=\"item.text\"\r\n                                 :value=\"item.value\">{{item.text}}\r\n                </a-select-option>\r\n              </a-select>\r\n\r\n\r\n              缓急：\r\n              <!--<a-select style=\"width: 120px\" v-model=\"backData.i_safetylevel\" placeholder=\"请选择密级\" @change=\"change\">-->\r\n              <a-select style=\"width: 120px\" v-model=\"i_urgency\" placeholder=\"请选择缓急\" @change=\"changeUrgency\">\r\n                <a-select-option v-for=\"(item,index) in urgencyList\" :key=\"index\" :text=\"item.text\"\r\n                                 :value=\"parseInt(item.value)\">{{item.text}}\r\n                </a-select-option>\r\n              </a-select>\r\n\r\n            </td>\r\n          </tr>\r\n          <tr v-show=\"previewFlag\">\r\n            <td style=\"padding: 4% 0% 2%\" align=\"center\" colspan=\"2\" height=\"50\" valign=\"bottom\">\r\n              <h1 style=\"color: red; font-weight: 800; font-size: 34px;margin-top: -60px;\">\r\n                <span>{{backData.s_left_parameter}}</span>\r\n                <span>{{backData.s_unit_name}}</span>\r\n                <span>{{backData.s_dept_name}}</span>\r\n                <span>{{backData.s_middle_parameter}}</span>\r\n                <span>{{backData.s_right_parameter}}</span>\r\n              </h1>\r\n            </td>\r\n          </tr>\r\n          <center>\r\n            <!--引入意见展示框-->\r\n            <task-opt ref=\"taskOptRef\" @optsReturn=\"optsGet\"></task-opt>\r\n            <!--引入模板等-->\r\n            <!--发文-->\r\n            <send-file v-if=\"pageRef == 'sendFile'\" ref=\"sendFile\" :backDataRef=\"backData\" :isShowFile=\"isShowFile\"\r\n                       @getBackData=\"getBackData\"\r\n                       :optionMap=\"optionMap\" :detailList=\"detailList\" :taskParent=\"task\"></send-file>\r\n\r\n            <!--发文-->\r\n            <send-file-fu-zhou v-if=\"pageRef == 'sendFileFuZhou'\" ref=\"sendFileFuZhou\" :backDataRef=\"backData\"\r\n                               @getBackData=\"getBackData\" :isShowFile=\"isShowFile\"\r\n                               :optionMap=\"optionMap\" :detailList=\"detailList\" :taskParent=\"task\"></send-file-fu-zhou>\r\n\r\n\r\n            <!--电教室使用需求-->\r\n            <electric-room v-if=\"pageRef == 'electricRoom'\" ref=\"electricRoom\" :backDataRef=\"backData\"\r\n                           @getBackData=\"getBackData\" :isShowFile=\"isShowFile\"\r\n                           :optionMap=\"optionMap\" :detailList=\"detailList\" :taskParent=\"task\"></electric-room>\r\n\r\n\r\n            <!--电子设备进出机房申请-->\r\n            <electric-equipment v-if=\"pageRef == 'electricEquipment'\" ref=\"electricEquipment\" :backDataRef=\"backData\"\r\n                                @getBackData=\"getBackData\" :isShowFile=\"isShowFile\"\r\n                                :optionMap=\"optionMap\" :detailList=\"detailList\" :taskParent=\"task\"></electric-equipment>\r\n\r\n\r\n            <!--案件（线索）登记-->\r\n            <case-clues v-if=\"pageRef == 'caseClues'\" ref=\"caseClues\" :backDataRef=\"backData\"\r\n                        @getBackData=\"getBackData\"\r\n                        :optionMap=\"optionMap\" :detailList=\"detailList\" :taskParent=\"task\"></case-clues>\r\n\r\n\r\n            <!--护照办理-->\r\n            <passport-hand v-if=\"pageRef == 'passportHand'\" ref=\"passportHand\" :backDataRef=\"backData\"\r\n                           @getBackData=\"getBackData\"\r\n                           :optionMap=\"optionMap\" :detailList=\"detailList\" :taskParent=\"task\"></passport-hand>\r\n\r\n\r\n            <!--局域网电话网接入登记表-->\r\n            <lan-access v-if=\"pageRef == 'lanAccess'\" ref=\"lanAccess\" :backDataRef=\"backData\"\r\n                        @getBackData=\"getBackData\"\r\n                        :optionMap=\"optionMap\" :detailList=\"detailList\" :taskParent=\"task\"></lan-access>\r\n\r\n\r\n            <!--收文-->\r\n            <receive-file v-if=\"pageRef == 'receiveFile'\" ref=\"receiveFile\" :backDataRef=\"backData\"\r\n                          :isShowFile=\"isShowFile\"\r\n                          :optionMap=\"optionMap\"\r\n                          @getBackData=\"getBackData\"\r\n                          :detailList=\"detailList\"/>\r\n            <!--会议室管理-->\r\n            <meeting-room-file v-if=\"pageRef == 'meetingRoomFile'\" ref=\"meetingRoomFile\" :optionMap=\"optionMap\"\r\n                               :isShowFile=\"isShowFile\"\r\n                               :backDataRef=\"backData\"\r\n                               @getBackData=\"getBackData\"\r\n                               :detailList=\"detailList\"/>\r\n            <!--会议申请-->\r\n            <meetint-inform v-if=\"pageRef == 'meetingInform'\" ref=\"meetingInform\" :backDataRef=\"backData\"\r\n                            :isShowFile=\"isShowFile\"\r\n                            :optionMap=\"optionMap\" :detailList=\"detailList\"/>\r\n            <!--会议通知-->\r\n            <meeting-notice v-if=\"pageRef == 'meetingNotice'\" ref=\"meetingNotice\" :backDataRef=\"backData\"\r\n                            @getBackData=\"getBackData\" :isShowFile=\"isShowFile\"\r\n                            :optionMap=\"optionMap\" :detailList=\"detailList\"></meeting-notice>\r\n            <!--电子公告-->\r\n            <electronic-file v-if=\"pageRef == 'electronicFile'\" ref=\"electronicFile\" :backDataRef=\"backData\"\r\n                             :isShowFile=\"isShowFile\"\r\n                             :detailList=\"detailList\" :busFunction=\"busFunction\" :optionMap=\"optionMap\"\r\n                             @isPublish=\"isPublish\" :publishData=\"publishData\" @validDate=\"validDate\"></electronic-file>\r\n            <!-- 请假申请-->\r\n            <synthesize-file v-if=\"pageRef == 'synthesizeFile'\" ref=\"synthesizeFile\" :backDataRef=\"backData\"\r\n                             @getBackData=\"getBackData\" :optionMap=\"optionMap\"\r\n                             :detailList=\"detailList\"></synthesize-file>\r\n\r\n            <!--视频会议申请-->\r\n            <video-meet v-if=\"pageRef == 'videoMeet'\" ref=\"videoMeet\" :backDataRef=\"backData\"\r\n                        @getBackData=\"getBackData\"\r\n                        :optionMap=\"optionMap\" :detailList=\"detailList\" :taskParent=\"task\"></video-meet>\r\n\r\n\r\n            <!-- 签报管理-->\r\n            <sign-quto-file v-if=\"pageRef == 'signQutoFile'\" ref=\"signQutoFile\" :backDataRef=\"backData\"\r\n                            @getBackData=\"getBackData\" :optionMap=\"optionMap\"\r\n                            :detailList=\"detailList\"></sign-quto-file>\r\n            <!--公文传阅-->\r\n            <inside-reading-file v-if=\"pageRef == 'insideReadingFile'\" ref=\"insideReadingFile\" :backDataRef=\"backData\"\r\n                                 :isShowFile=\"isShowFile\"\r\n                                 @getBackData=\"getBackData\" :optionMap=\"optionMap\" @isPublish=\"isPublish\"\r\n                                 :publishData=\"publishData\"\r\n                                 :detailList=\"detailList\"></inside-reading-file>\r\n\r\n            <!--电子公告预览-->\r\n            <preview v-if=\"pageRef == 'preview'\" ref=\"preview\" :backDataRef=\"backData\"\r\n                     :detailList=\"detailList\" :busFunction=\"busFunction\" :optionMap=\"optionMap\"\r\n                     @isPublish=\"isPublish\" :publishData=\"publishData\" @validDate=\"validDate\"></preview>\r\n            <!-- &lt;!&ndash; 协同办公-->\r\n            <oa-teamwork-set-list-model ref=\"teamword\" @WorkList=\"WorkList\"></oa-teamwork-set-list-model>\r\n            <!--富文本框-->\r\n            <table width=\"100%\" ref=\"editTable\"\r\n                   style=\" border-right:1px solid rgb(145, 56, 56); ;border-left:1px  solid rgb(145, 56, 56); ;border-bottom:1px solid rgb(145, 56, 56); ;\">\r\n              <tr v-show=\"jeditShow\">\r\n                <!--<td class=\"title\" colspan=\"1\" width=\"15%\" style=\"border-right: 1px solid rgb(145, 56, 56);\">-->\r\n                <!--<center><h3>{{detailList.s_title}}</h3></center>-->\r\n                <!--</td>-->\r\n                <td colspan=\"4\">\r\n                  <j-editor ref=\"jeditor\" :newHeight=\"newHeight\" :disabled=\"disableFlag\" class=\"fuwenben\"\r\n                            v-model=\"jeditor.value\"/>\r\n                </td>\r\n              </tr>\r\n            </table>\r\n            <!--发布范围-->\r\n            <table width=\"100%\"\r\n                   style=\" border-right:1px solid rgb(145, 56, 56); ;border-left:1px  solid rgb(145, 56, 56); ;border-bottom:1px solid rgb(145, 56, 56); ;\">\r\n              <tr v-show=\"isLimitsShow\">\r\n                <td class=\"title\" width=\"15%\" style=\"border-right: 1px solid rgb(145, 56, 56);\">\r\n                  <center><h3>发布范围</h3></center>\r\n                </td>\r\n                <td colspan=\"3\">\r\n                  <release-scope ref=\"resleaseScope\" @change1=\"change1\" @userNames=\"userNames\" @userIDs=\"userIDs\"\r\n                                 :backData=\"backData\"/>\r\n                </td>\r\n              </tr>\r\n            </table>\r\n\r\n          </center>\r\n        </table>\r\n      </div>\r\n      <!--隐藏 按钮-->\r\n      <br/>\r\n      <task-btn v-show=\"previewFlag\" ref=\"taskRef\" @submit=\"submit\" @publishInform=\"publishInform\"\r\n                @unpublishBtn=\"unpublishBtn\"\r\n                @saveDocNum=\"saveDocNum\"\r\n                @checkData=\"checkData\"\r\n                @nextCheckDataFun=\"nextCheckDataFun\"\r\n                @saveGongwenData=\"saveGongwenData\" @saveDelTime=\"saveDelTime\"\r\n                @savaObj=\"savaObj\" :backData=\"backData\" :busFunction=\"busFunction\" :backDataOpt=\"backDataOpt\"\r\n                :taskMsg=\"task\"\r\n                :opts=\"opts\" @downFiles=\"downFiles\"\r\n                @destoryObj=\"destoryObj\" @iIsImportantObj=\"iIsImportantObj\"\r\n                @watchSub=\"watchSub\" :oaFileList=\"oaFileList\" @close=\"handleCancel\" @callaboration=\"callaboration\"\r\n                @getbackDataNew=\"getbackDataNew\"\r\n      ></task-btn>\r\n    </center>\r\n  </form>\r\n</template>\r\n\r\n<script>\r\n  import {getAction, postAction} from \"../../../api/manage\";\r\n  import {JeecgListMixin} from \"../../../mixins/JeecgListMixin2\";\r\n  import taskBtn from '../../buttons/taskBtn'\r\n  import taskOpt from '../../buttons/taskOpt'\r\n  import JEditor from '@/components/jeecg/JEditor'\r\n  import {ntkoBrowser} from '../../buttons/btn-js/ntkobackground.min.js'\r\n  import ReleaseScope from \"@/views/oaBus/pageModels/releaseScope\";\r\n  //业务页面\r\n  import sendFile from '@/views/mytask/taskList/sendFile'\r\n  import receiveFile from '@/views/mytask/taskList/receiveFile'\r\n  import MeetingRoomFile from \"@/views/mytask/taskList/meetingRoomFile\";\r\n  import MeetintInform from \"@/views/mytask/taskList/meetingInform\";\r\n  import MeetingNotice from \"@/views/mytask/taskList/meetingNotice\";\r\n  import ElectronicFile from \"@/views/mytask/taskList/electronicFile\";\r\n  import SynthesizeFile from \"./synthesizeFile\";\r\n  import SignQutoFile from \"./signQutoFile\";\r\n  import InsideReadingFile from \"./insideReadingFile\";\r\n  import sendFileFuZhou from \"@/views/mytask/taskList/sendFileFuZhou\";\r\n  import electricRoom from \"./electricRoom\";\r\n  import electricEquipment from \"./electricEquipment\";\r\n  import caseClues from \"@/views/mytask/taskList/caseClues\";\r\n  import oaTeamworkSetListModel from \"@/views/oaTeamwork/modules/oaTeamworkSetListModel\";\r\n  import preview from \"./preview\";\r\n  import videoMeet from \"./videoMeet\";\r\n  import passportHand from \"./passportHand\";\r\n  import lanAccess from \"./lanAccess\";\r\n\r\n\r\n  export default {\r\n    name: \"detailFile\",\r\n    inject: ['reload'],\r\n    mixins: [JeecgListMixin],\r\n    components: {\r\n      lanAccess,\r\n      electricEquipment,\r\n      electricRoom,\r\n      passportHand,\r\n      videoMeet,\r\n      caseClues,\r\n      sendFileFuZhou,\r\n      preview,//预览页面\r\n      InsideReadingFile,\r\n      SignQutoFile,\r\n      SynthesizeFile,\r\n      MeetingNotice,\r\n      ElectronicFile,\r\n      ReleaseScope,\r\n      taskBtn,\r\n      taskOpt,\r\n      JEditor,\r\n      //业务\r\n      sendFile,\r\n      MeetintInform,\r\n      MeetingRoomFile,\r\n      receiveFile,\r\n      oaTeamworkSetListModel\r\n    },\r\n    data() {\r\n      return {\r\n        visible: false,\r\n        title: '业务详情',\r\n        confirmLoading: false,\r\n        userData: '',\r\n        disableFlag: false,\r\n        secretDegree: [],\r\n        xietongList: [],\r\n        Ints: [],\r\n        iteamworkId: '',\r\n        iorder: '',\r\n        scrHeight: '',\r\n        urgencyList: [],\r\n        secretModle: '',\r\n        i_urgency: '',\r\n        TableName: '',\r\n        busModelId: '',\r\n        functionId: '',\r\n        newDataId: '',\r\n        iteamworkSetId: '',\r\n        isShowFile: false, //附件按钮控制\r\n        //富文本的高度\r\n        newHeight: 300,\r\n        //电子公告模板\r\n        previewFlag: true,\r\n        //代办信息\r\n        task: {},\r\n        //已办信息\r\n        taskDone: '',\r\n        opts: [],//意见框信息\r\n        pageRef: '',//意见框信息\r\n        editValue: 0,\r\n        //意见表相关\r\n        backDataOpt: {\r\n          //回填数据id\r\n          table: 'oa_busdata20_opinion',\r\n          i_id: \"\",\r\n          i_opinion_set_id: \"\",\r\n          i_bus_function_id: \"\",\r\n          i_busdata_id: \"\",\r\n          s_name: \"\",\r\n          i_user_id: \"\",\r\n          d_sign: \"\",\r\n          s_opinion: \"\",\r\n          s_opinion_type: \"\",\r\n          s_task_id: \"\",\r\n          s_task_name: \"\",\r\n          s_overt: \"\",\r\n          i_order: \"\",\r\n          s_tpye: \"\",\r\n          s_dept_id: \"\",\r\n          s_dept_name: \"\",\r\n          s_taskdef_key: \"\"\r\n        },\r\n        detailList: null,    //  文档数据   字段含义\r\n        oaFileList: [],    //  文档数据   字段含义\r\n        busFunction: {},\r\n        busTextData: {},\r\n        routeParam: '',\r\n        optionMap: {},\r\n        intslist: [],\r\n        busDataId: '',\r\n        dataId: '',\r\n        iversion: '',\r\n        //表中的数据相关值\r\n        dealBtn: {},\r\n        //表中的数据相关值\r\n        jeditShow: false,   //富文本编辑器的内容的value值\r\n        isLimitsShow: false,   //富文本编辑器的内容的value值\r\n        jeditor: {\r\n          value: ''\r\n        },\r\n        backData: {},\r\n        //发布范围相关\r\n        publishData: {\r\n          iIsLimits: '', //选择范围（1 全行 2 部门 3 用户）\r\n          departId: '',  //部门ids\r\n          userRealName: '', //用户名称\r\n          userIdS: '',//用户ids\r\n        },\r\n        url: {\r\n          list: \"/oateamwork/oaTeamworkSet/findListByteamworkId\",//\r\n          selectInts: \"/oateamwork/oaTeamworkSet/findListByteamworkId\",//\r\n          selectNext: \"/oateamwork/oaTeamworkSet/selectNext\",//协同办公配置的查询\r\n          Intslist: \"/oaTea/oaTeamworkInst/querylist\",\r\n          optionAndBtn: '/oaBus/newTask/optionAndBtn',\r\n          currentUserMsg: '/sys/user/getUserSectionInfoByToken',\r\n          updateReadStatus: '/oaBus/taskInAct/changeStatus',\r\n          selectTaskType: '/oaBus/busModel/list',\r\n          selectTask: '/oaBus/busModel/list',\r\n          queryOaFileList: '/oaBus/oaFile/queryOaFileList',\r\n          functionQuery: '/oaBus/busFunction/list',\r\n          insert: '/oaBus/dynamic/insert',//动态新增数据\r\n          updateBusdata: '/oaBus/dynamic/update',//动态修改数据\r\n\r\n          /*加载数据*/\r\n          busDataAndColums: 'oaBus/oaBusdata/queryBusdataById',\r\n\r\n        },\r\n\r\n        userinfo: '',\r\n        userid: ''\r\n\r\n      }\r\n    },\r\n    created() {\r\n      this.scrHeight = window.innerHeight - 60 + 'px';\r\n      //监听页签切换  修改标题\r\n      var _this = this;\r\n      document.addEventListener('visibilitychange', function () {\r\n        // document.title = _this.backData.s_right_parameter\r\n        document.title = '[' + _this.backData.s_right_parameter + ']' + _this.backData.s_title\r\n        // document.title = document.hidden?'拜拜11111':' 回来啦2222'\r\n        if (document.hidden) {\r\n          _this.showBtn(_this.butArrLists);\r\n        }\r\n      })\r\n\r\n      /*let param = this.$route.params ;\r\n      console.log(param)\r\n      this.show(param)*/\r\n      this.changRouter()\r\n      getAction(this.url.currentUserMsg).then(res => {\r\n        this.userData = res.result\r\n      })\r\n      //获取用户基本信息\r\n      const userinfo = JSON.parse(localStorage.getItem('userdata')).userInfo;\r\n      console.log(userinfo);\r\n      this.userinfo = userinfo;\r\n      this.userid = userinfo.id;\r\n      // this.showOpen(this.userid);\r\n    },\r\n    destroyed() {\r\n      this.backData = {};\r\n      this.destroy = false;\r\n    },\r\n    watch: {\r\n      '$route.query': function (newVal, oldVal) {\r\n        if (JSON.stringify(newVal) !== '{}') {\r\n          console.log(newVal)\r\n          this.reload();\r\n          this.show(newVal);\r\n        }\r\n      }\r\n    },\r\n    methods: {\r\n      // jeditorBlurText(){\r\n      //   if(this.$refs.jeditor.value == ''){\r\n      //     this.$refs.jeditor.$el.style.border = '1px solid red';\r\n      //   }else {\r\n      //     this.$refs.jeditor.$el.style.border = '1px solid #d9d9d9';\r\n      //   }\r\n      //\r\n      // },\r\n\r\n      //下一任务时校验对应点数据，并修改方法\r\n      nextCheckDataFun() {\r\n        this.$refs[this.pageRef].nullText();\r\n      },\r\n      //----------------webSocket的处理\r\n      initWebSocket: function (userId) {\r\n        // 将busdataId作为路径，传到服务器中\r\n        // WebSocket与普通的请求所用协议有所不同，ws等同于http，wss等同于https\r\n        var url = window._CONFIG['domianURL'].replace(\"https://\", \"ws://\").replace(\"http://\", \"ws://\") + \"/websocket/\" + userId;\r\n        //alert(url)\r\n        this.websock = new WebSocket(url);\r\n        this.websock.onopen = this.websocketonopen;\r\n        this.websock.onerror = this.websocketonerror;\r\n        this.websock.onmessage = this.websocketonmessage;\r\n        this.websock.onclose = this.websocketclose;\r\n      },\r\n      websocketonopen: function () {\r\n\r\n        var url = window._CONFIG['domianURL'].replace(\"https://\", \"ws://\").replace(\"http://\", \"ws://\") + \"/websocket/\";\r\n\r\n        console.log(\"WebSocket连接成功\", url);\r\n      },\r\n      websocketonerror: function (e) {\r\n        console.log(\"WebSocket连接发生错误\");\r\n      },\r\n      websocketonmessage: function (e) {\r\n        //console.log(e.data)\r\n        var data = eval(\"(\" + e.data + \")\");\r\n        //处理订阅信息\r\n        if (data.cmd == \"topic\") {\r\n          //TODO 系统通知\r\n          console.log(e)\r\n        } else if (data.cmd == \"user\") {\r\n          //TODO 用户消息\r\n          console.log(e.data)\r\n          let res = JSON.parse(e.data)\r\n          if (res.msgTxt == \"qiCao\") {\r\n            console.log(this.dealBtn);\r\n            //this.$refs.taskRef.saveBusData();\r\n            this.$refs[this.pageRef].saveNoCheck()\r\n            //this.$refs.taskRef.alertBtnStaus(res.msgTxt,this.dealBtn) ;\r\n          }\r\n          //if(e.data.m)\r\n        }\r\n      },\r\n      websocketclose: function (e) {\r\n        console.log(\"connection closed (\" + e.code + \")\");\r\n      },\r\n      //----------------webSocket的处理end\r\n\r\n\r\n      getbackDataNew(ref) {\r\n        console.log('++++==============', ref)\r\n        this.backData = this.$refs[ref].getBackDataNew()\r\n\r\n        return this.$refs.taskRef.setBackDataNew(this.backData)\r\n      },\r\n      // 协同办公\r\n      callaboration() {\r\n        getAction(this.url.Intslist).then((res) => {\r\n          this.intslist = res.result;\r\n          if (this.intslist.length == 0) {\r\n            this.$refs.teamword.showOpen(this.userid, this.backData, this.busDataId);\r\n          } else {\r\n            this.dataId = this.intslist[this.intslist.length - 1].ibusdataId;\r\n            this.iteamworkId = this.intslist[this.intslist.length - 1].iteamworkId;\r\n            this.iorder = this.intslist[this.intslist.length - 1].iorder + 1;\r\n            this.iteamworkSetId = this.intslist[this.intslist.length - 1].iteamworkSetId\r\n            if (this.dataId != Number(this.busDataId)) { //新的流程\r\n              console.log(this.dataId)\r\n              console.log(this.busDataId)\r\n              this.$refs.teamword.showOpen(this.userid, this.backData, this.busDataId);\r\n            } else {\r\n              console.log(this.dataId)\r\n              getAction(\"/oateamwork/oaTeamworkSet/findMax\", {TeamworkId: this.iteamworkId}).then(res => {\r\n                this.maxOrder = res.result\r\n                console.log(this.iorder - 1)\r\n                console.log(this.maxOrder)\r\n                if (Number(this.iorder - 1) < Number(this.maxOrder)) {\r\n                  //开始查下一个环节的任务id\r\n                  getAction(this.url.selectNext, {iTeamworkId: this.iteamworkId, iOrder: this.iorder}).then((res) => {\r\n                    console.log(res)\r\n                    this.busModelId = res.ibusModelId\r\n                    this.functionId = res.ibusFunctionId\r\n                    let param = {\r\n                      modelId: res.ibusModelId,\r\n                      functionId: res.ibusFunctionId,\r\n                    }\r\n\r\n\r\n                    postAction(\"/oaBus/oaBusdata/queryNewTaskMsg\", param).then(res => {\r\n                      if (res.success) {\r\n                        const promise1 = new Promise((resolve => {\r\n                          this.newDataId = JSON.stringify(res.result.busdataId)\r\n                          console.log(JSON.stringify(res.result));\r\n                          // console.log(window.location);\r\n                          // window.location.href(window.location.origin + '/mytask/taskList/Test-detailFile?tableName=' + res.result.tableName + '&busdataId=' + res.result.busdataId + '&navisshow=false')\r\n                          this.$router.push({path: '/mytask/taskList/Test-detailFile?tableName=' + res.result.tableName + '&busdataId=' + res.result.busdataId + '&navisshow=false'})\r\n                          resolve(this.newDataId)\r\n                        }))\r\n\r\n\r\n                        promise1.then((newDataId) => {\r\n                          console.log(this.newDataId)\r\n                          // console.log(res.ibusModelId)\r\n                          console.log(this.iteamworkSetId)\r\n                          let data1 = {\r\n                            iteamworkId: this.iteamworkId,\r\n                            iteamworkSetId: this.iteamworkSetId,\r\n                            iorder: this.iorder,\r\n                            ibusdataId: newDataId,\r\n                            iversion: this.intslist[this.intslist.length - 1].iversion,\r\n                            ibusModelId: this.busModelId,\r\n                            ibusFunctionId: this.functionId\r\n                          }\r\n                          let dataList = {\r\n                            data1: data1\r\n                          }\r\n                          postAction(\"/oaTea/oaTeamworkInst/add\", dataList).then(res => {\r\n                            if (res.success) {\r\n                              this.$message.success(res.message)\r\n                            } else {\r\n                              this.$message.error(res.message)\r\n                            }\r\n                          })\r\n\r\n                        })\r\n\r\n                      } else {\r\n                        this.$message.error(res.message)\r\n                      }\r\n                    })\r\n\r\n                  })\r\n                } else {\r\n                  this.$message.warn('协同任务已完成')\r\n                }\r\n\r\n              })\r\n\r\n\r\n            }\r\n\r\n          }\r\n\r\n        })\r\n\r\n\r\n        /* const promise1 = new Promise((resolve,reject)=>{\r\n           console.log(this.backData.s_right_parameter)\r\n           getAction(this.url.list, {TeamworkName: this.backData.s_right_parameter}).then(res => {\r\n             this.xietongList = res;\r\n             console.log(res)\r\n             resolve( this.xietongList )\r\n           })\r\n         })\r\n         promise1.then((lists)=>{\r\n           // this.findMax(lists);\r\n           new Promise((resolve,reject)=>{\r\n             getAction(\"/oaTea/oaTeamworkInst/findMax\",{iteamworkId:lists[0].iteamworkId}).then(res => {\r\n               resolve(res.result,lists)\r\n             })\r\n           }).then((maxOrder,e)=>{\r\n             console.log(maxOrder);\r\n             console.log(e);\r\n\r\n             if( typeof (maxOrder)== 'String'|| typeof (maxOrder)== 'undefined'){\r\n               console.log(111);\r\n               this.findTableName(lists[0].ibusModelId,lists[0].ibusFunctionId);\r\n               let Datas = {\r\n                 iteamworkId:lists[0].iteamworkId,\r\n                 iteamworkSetId:lists[0].iid,\r\n                 iorder:0,\r\n                 ibusModelId:lists[0].ibusModelId,\r\n                 ibusFunctionId:lists[0].ibusFunctionId\r\n               }\r\n               postAction(\"/oaTea/oaTeamworkInst/add\", Datas).then(res => {\r\n                 if (res.success) {\r\n                   this.$message.success(res.message)\r\n                 } else {\r\n                   this.$message.error(res.message)\r\n                 }\r\n               })\r\n             }\r\n             else{\r\n               const promise1 = new Promise((resolve,reject)=>{\r\n                 console.log(this.backData.s_right_parameter)\r\n                 getAction(this.url.list, {TeamworkName: this.backData.s_right_parameter}).then(res => {\r\n                   this.xietongList = res;\r\n                   console.log(res)\r\n                   resolve( this.xietongList )\r\n                 })\r\n               })\r\n               promise1.then((lists)=>{\r\n                 // this.findMax(lists);\r\n                 new Promise((resolve,reject)=>{\r\n                   getAction(\"/oaTea/oaTeamworkInst/findMax\",{iteamworkId:lists[0].iteamworkId}).then(res => {\r\n                     resolve(res.result,lists)\r\n                   })\r\n                 }).then((maxOrder,e)=>{\r\n                   console.log(maxOrder);\r\n                   console.log(e);\r\n                   if(maxOrder<=lists[maxOrder].iorder){\r\n                     console.log(222);\r\n                     console.log(lists[maxOrder])\r\n                     this.findTableName(lists[maxOrder+1].ibusModelId,lists[maxOrder+1].ibusFunctionId);\r\n                     let Datas = {\r\n                       iteamworkId:lists[maxOrder].iteamworkId,\r\n                       iteamworkSetId:lists[maxOrder].iid,\r\n                       iorder:lists[maxOrder].iorder,\r\n                       ibusModelId:lists[maxOrder].ibusModelId,\r\n                       ibusFunctionId:lists[maxOrder].ibusFunctionId\r\n                     }\r\n                     postAction(\"/oaTea/oaTeamworkInst/add\", Datas).then(res => {\r\n                       if (res.success) {\r\n                         this.$message.success(res.message)\r\n                       } else {\r\n                         this.$message.error(res.message)\r\n                       }\r\n                     })\r\n\r\n                   }\r\n                 })\r\n\r\n               }).then(()=>{\r\n               })\r\n             }\r\n           })\r\n       }).then(()=>{\r\n         })*/\r\n\r\n\r\n      },\r\n      findMax(lists) {\r\n        return new Promise((resolve, reject) => {\r\n          console.log(lists[0].iteamworkId)\r\n          getAction(\"/oaTea/oaTeamworkInst/findMax\", {iteamworkId: lists[0].iteamworkId}).then(res => {\r\n            this.maxOrder = res.result\r\n            console.log(this.maxOrder)\r\n            resolve(lists)\r\n          })\r\n        })\r\n\r\n      },\r\n      getBackData(backData) {\r\n        //最新业务详情回传\r\n        // this.$refs.taskRef.backData = backData\r\n        // this.$refs.taskRef.reload()\r\n\r\n      },\r\n      changRouter(value) {\r\n        let param = this.$route.query;\r\n        if (param.haveTask != undefined && param.haveTask) {\r\n          this.task = param.task\r\n        }\r\n        //console.log(this.$route.query);\r\n        this.show(param)\r\n      },\r\n      //获取发布范围数据\r\n      change1(data) {\r\n        for (var i in  data) {\r\n          this.publishData = data\r\n        }\r\n      },\r\n      //获取用户ids\r\n      userIDs(data) {\r\n        this.publishData.userIdS = data;\r\n      },\r\n      userNames(data) {\r\n        this.publishData.userRealName = data.join(',');\r\n      },\r\n      //发布按钮\r\n      publishInform() {\r\n        // this.$refs[this.pageRef].isSelectDate();\r\n        this.$refs.resleaseScope.handerOk();\r\n      },\r\n      //取消发布\r\n      unpublishBtn() {\r\n        this.$refs.resleaseScope.unpublish();\r\n      },\r\n      //确定发布按钮\r\n      // isPublish(data) {\r\n      //   if (data == true) {\r\n      //     //调用发布\r\n      //     this.$refs.resleaseScope.handerOk();\r\n      //   } else {\r\n      //     // this.$refs[this.pageRef].save(data)\r\n      //     this.$refs.resleaseScope.handerOk();\r\n      //   }\r\n      // },\r\n      validDate(date) {\r\n        this.backData.d_datetime1 = date;\r\n        // alert(this.backData.d_datetime1)\r\n      },\r\n      //发送通知\r\n      submit(data) {\r\n        this.$refs[this.pageRef].submit(data)\r\n      },\r\n\r\n      /*登记文号数据*/\r\n      saveDocNum(data) {\r\n        //this.ntko['i_file_num_id'] = data.id\r\n        this.$refs[this.pageRef].saveDocNum(data)\r\n      },\r\n      //公文链接数据\r\n      saveGongwenData(data) {\r\n        this.$refs[this.pageRef].saveGongwenData(data)\r\n      },\r\n      //封发日期数据\r\n      saveDelTime(data) {\r\n        this.$refs[this.pageRef].saveDelTime(data)\r\n\r\n      },\r\n      // 关注件--是否重要\r\n      iIsImportantObj(e) {\r\n        this.$refs[this.pageRef].iIsImportant()\r\n      },\r\n      //销假--添加销假时间\r\n      destoryObj(e) {\r\n        //保存业务模板数据\r\n        this.$refs[this.pageRef].destory()\r\n      },\r\n      //保存所有数据\r\n      savaObj() {\r\n        //校验富文本编辑器数据\r\n        if (this.busFunction.iisEditor == 1) {\r\n          let params = {}\r\n          params.table = \"oa_busdata_text\";\r\n          params.i_busdata_id = this.backData.i_id;\r\n          params.s_text = this.jeditor.value;\r\n          params.s_busdata_table = this.backData.table\r\n          if (this.editValue == 0 && this.busTextData == null) {\r\n            postAction(this.url.insert, params).then(res => {\r\n              this.editValue = res.result.i_id// console.log(res.result.i_id); //富文本id\r\n            })\r\n          } else {\r\n            params.i_id = this.busTextData.i_id;\r\n            postAction(this.url.updateBusdata, {\r\n              'updateBusdata': params\r\n            }).then(res => {\r\n            })\r\n          }\r\n        }\r\n        //保存业务模板数据\r\n        this.$refs[this.pageRef].save()\r\n\r\n        // this.$emit('close');\r\n        // this.visible = false;\r\n      },\r\n      /* openFile(cmd, fileName) {\r\n         let ntkoed = ntkoBrowser.ExtensionInstalled();\r\n         if (ntkoed) {\r\n           ntkoBrowser.openWindow(window.location.origin + \"/ntko/editindex.html?cmd=\" + cmd + \"&fileName=\" + fileName + \"&userName=\" + \"admin\" + \"&sbtnid=\" + 43);\r\n         } else {\r\n           window.open(window.location.origin + \"/ntko/exeindex.html\")\r\n         }\r\n         window.ntkoCloseEvent = function () {\r\n           // alert(\"跨浏览器插件应用程序窗口已关闭\")\r\n         }\r\n       },*/\r\n      optsGet(opts) {\r\n        this.opts = opts\r\n      },\r\n      //修改机密\r\n      change(e) {\r\n        this.backData.i_safetylevel = e;\r\n\r\n        //更新缓急--往缓存里存储一份\r\n        localStorage.setItem('密级:' + this.backData.table + this.backData.i_id, e)\r\n        // let params = {table: this.backData.table, i_id: this.backData.i_id, i_safetylevel: this.backData.i_safetylevel}\r\n        // postAction(this.url.updateBusdata, params).then((rec) => {\r\n        //   console.log(rec)\r\n        // })\r\n      },\r\n      //修改缓急\r\n      changeUrgency(e) {\r\n        this.backData.i_urgency = e;\r\n        //更新缓急--往缓存里存储一份\r\n        localStorage.setItem('缓急:' + this.backData.table + this.backData.i_id, e)\r\n\r\n        // let params = {table: this.backData.table, i_id: this.backData.i_id, i_urgency: this.backData.i_urgency}\r\n        // postAction(this.url.updateBusdata, params).then((rec) => {\r\n        //   console.log(rec)\r\n        // })\r\n      },\r\n      changeHuanJi(e) {\r\n        this.backData.i_urgency = e\r\n      },\r\n      //详情页面数据\r\n      showTaskInAct(taskDetail, task) {\r\n        //查询出优先级\r\n        this.task = task\r\n        this.show(taskDetail)\r\n      },\r\n      dealHeight(btn) {\r\n        let btnHegiht = 30;\r\n        console.log(btn)\r\n        if (btn.isNotDefend != undefined && btn.isNotDefend.length != 0) {\r\n          btnHegiht += 70;\r\n        }\r\n        if (btn.isDefend != undefined && btn.isDefend.length != 0) {\r\n          btnHegiht += 60;\r\n        }\r\n        // console.log(\"AAAAAAAAAAAAAAAAAAAAAAAA\", btnHegiht)\r\n        this.scrHeight = window.innerHeight - btnHegiht + 'px';\r\n        console.log(btnHegiht)\r\n      },\r\n      //--------------------------------------   展示业务大详情    弹窗-----------------------------------------------------------------------------\r\n      show(taskDetail) {\r\n\r\n        document.title = ' '\r\n        let param = {\r\n          tableName: taskDetail.tableName,\r\n          busdataId: taskDetail.busdataId\r\n        }\r\n        //************************************************* 任务相关参数  START\r\n        if (taskDetail.task != undefined) {\r\n          this.task = JSON.parse(taskDetail.task)\r\n        }\r\n\r\n        if (this.task.id != undefined && this.task.id != '') {\r\n          param.taskId = this.task.id\r\n          param.taskDefinitionKey = this.task.taskDefinitionKey\r\n          param.name = this.task.name\r\n          param.proInstanId = this.task.processInstanceId\r\n        }\r\n\r\n        if (this.task.hiTaskId != undefined && this.task.hiTaskId != '') {\r\n          param.taskId = this.task.hiTaskId\r\n          param.proInstanId = this.task.processInstanceId\r\n          param.taskDefinitionKey = this.task.taskDefinitionKey\r\n\r\n        }\r\n        //标记状态 已办 待办\r\n        if (taskDetail.status != undefined) {\r\n          param.status = taskDetail.status\r\n        }\r\n        //************************************************* 任务相关参数  END\r\n\r\n        postAction(this.url.busDataAndColums, param).then((res) => {\r\n          if (res.success) {\r\n\r\n            //  修改标题\r\n            document.title = '[' + res.result.oaBusdata.s_right_parameter + ']' + res.result.oaBusdata.s_title\r\n            this.backData.key = res.result.btnAndOpt.key;\r\n            this.optSet(res.result.btnAndOpt.opt, this.backData.key);\r\n            //处理显示高度\r\n            if (res.result.btnAndOpt.btn != undefined) {\r\n              this.dealHeight(res.result.btnAndOpt.btn);\r\n            }\r\n            //如果非默认按钮不是未定义且不为空的话，就将开启websocket\r\n            if (res.result.btnAndOpt.btn.isNotDefend != undefined && res.result.btnAndOpt.btn.isNotDefend.length > 0) {\r\n              console.log(res.result.btnAndOpt.btn)\r\n              let qiCaoIndex = -1;         //起草底稿按钮的标志\r\n              let editDiGaoIndex = -1;     //编辑底稿按钮的标志\r\n              //开启websocket\r\n              this.initWebSocket(res.result.oaBusdata.i_id);\r\n              for (let i = 0; i < res.result.btnAndOpt.btn.isNotDefend.length; i++) {\r\n                if (res.result.btnAndOpt.btn.isNotDefend[i].smethod == 'qiCao') {\r\n                  qiCaoIndex = i;\r\n                }\r\n                if (res.result.btnAndOpt.btn.isNotDefend[i].smethod == 'editDiGao') {\r\n                  editDiGaoIndex = i;\r\n                }\r\n              }\r\n              if (qiCaoIndex >= 0) {\r\n                //当前业务已经起草底稿\r\n                if (res.result.oaBusdata.i_is_draft != undefined && res.result.oaBusdata.i_is_draft == 1) {\r\n                  //将起草底稿按钮去除\r\n                  res.result.btnAndOpt.btn.isNotDefend.splice(qiCaoIndex, 1);\r\n                } else {    //当前业务没有起草底稿\r\n                  if (editDiGaoIndex >= 0) {\r\n                    this.dealBtn = res.result.btnAndOpt.btn.isNotDefend[editDiGaoIndex];\r\n                    res.result.btnAndOpt.btn.isNotDefend.splice(editDiGaoIndex, 1);\r\n                  }\r\n                }\r\n              }\r\n              console.log(res.result.btnAndOpt.btn)\r\n            }\r\n            //为按钮赋值\r\n            this.$refs.taskRef.showBtn(res.result.btnAndOpt.btn);\r\n\r\n            //附件按钮权限控制\r\n            postAction('/oaBus/oaFile/isFileBtn', res.result.btnAndOpt.btn).then(res => {\r\n              if (res.success && res.result == true) {\r\n                this.isShowFile = true;\r\n              }\r\n            })\r\n            //字典值获取\r\n            this.optionMap = res.result.optionMap;\r\n            this.secretDegree = res.result.optionMap.secretDegree;\r\n            this.urgencyList = res.result.optionMap.i_urgency_option;\r\n            //业务数据赋值\r\n\r\n            this.backData = res.result.oaBusdata;\r\n            this.backData['iprocSetId'] = res.result.proSetId;\r\n            this.backData['key'] = res.result.taskDefKey\r\n            this.backData.act_show = res.result.actShow\r\n\r\n\r\n            this.backDataOpt.s_task_id = res.result.taskId\r\n            //机密等级\r\n            let secretModleTest = this.backData.i_safetylevel;\r\n            this.secretModle = JSON.stringify(secretModleTest)\r\n            //缓急\r\n            this.i_urgency = this.backData.i_urgency\r\n\r\n            //文档数据\r\n            this.detailList = res.result.detailList;\r\n\r\n            this.busDataId = res.result.busdataId;\r\n\r\n            this.busFunction = res.result.busFunction;\r\n            this.busTextData = res.result.busTextData;\r\n            //处理是否为电子公告预览页面\r\n            let userInfo = JSON.parse(window.localStorage.getItem('userdata')).userInfo;\r\n            if (this.backData.s_create_by != userInfo.id && this.busFunction.iisProc == 0 && this.busFunction.iisEditor == 1) {\r\n              this.pageRef = 'preview';\r\n              if (this.busTextData != null) {\r\n                this.jeditor.value = this.busTextData.s_text;\r\n              }\r\n              this.$refs.editTable.style.border = \"0px solid rgb(145, 56, 56)\";\r\n              //this.$refs.editTable.style.height=\"500px\" ;\r\n              this.jeditShow = true;\r\n              this.newHeight = 500;\r\n              this.previewFlag = false;\r\n              this.disableFlag = true;\r\n            } else {\r\n              //if(this.busFunction.)\r\n              //富文本显示控制\r\n              this.pageRef = res.result.pageRef;\r\n              if (this.busFunction.iisEditor == 1) {\r\n                if (this.busTextData != null) {\r\n                  this.jeditor.value = this.busTextData.s_text;\r\n                }\r\n                this.jeditShow = true;\r\n              }\r\n              if (this.busFunction.iisLimits == 1) {\r\n                this.isLimitsShow = true;\r\n              }\r\n            }\r\n\r\n            // /**\r\n            //  * 刷新页面后,task数据覆盖\r\n            //  */\r\n            this.task.pageRef = res.result.pageRef\r\n            this.task.id = res.result.taskId\r\n            this.task.taskDefinitionKey = res.result.taskDefKey\r\n            this.task.processDefinitionId = res.result.processDefinitionId\r\n            this.task.processInstanceId = res.result.processInstanceId\r\n\r\n          } else {\r\n            this.$message.error(res.message)\r\n          }\r\n\r\n\r\n        })\r\n        this.visible = true\r\n\r\n      },\r\n      //子孙组件事件回传\r\n      watchSub(e) {\r\n        this.getOaFileList(this.backData.table, this.backData.i_id);\r\n      },\r\n      //意见id赋值  区分新增与更新\r\n      // optSet(opts, key) {\r\n      //   console.log('----------', JSON.stringify(opts))\r\n      //   for (let i in opts) {\r\n      //     if (opts[i].taskDefKey == key) {\r\n      //       this.backDataOpt.i_id = opts[i].optId\r\n      //     }\r\n      //   }\r\n      // },\r\n      optSet(opts, key) {\r\n        var map2 = []\r\n        var keys = []\r\n        var map = {}\r\n\r\n        for (let i in opts) {\r\n          let key = opts[i].optionName\r\n          if (keys.indexOf(key) < 0) {\r\n            keys.push(key)\r\n          }\r\n\r\n          if (map[key] == undefined) {\r\n            map[key] = opts[i]\r\n            map[key].optionContext2 = ''\r\n            map[key].optionContext2 += opts[i].optionContext + '\\t' + opts[i].signName + '\\t' + opts[i].signTime + '\\n'\r\n            map[key].taskDefKeys = []\r\n            map[key].taskDefKeys.push(map[key].taskDefKey)\r\n          } else {\r\n            let optx = opts[i].optionContext + '\\t' + opts[i].signName + '\\t' + opts[i].signTime + '\\n'\r\n            map[key].optionContext2 += optx\r\n            if ((map[key].taskDefKeys).indexOf(opts[i].taskDefKey) < 0) {\r\n              map[key].taskDefKeys.push(opts[i].taskDefKey)\r\n            }\r\n          }\r\n\r\n\r\n          if (opts[i].taskDefKey == key) {\r\n            this.backDataOpt.i_id = opts[i].optId\r\n          }\r\n        }\r\n\r\n        for (let i of keys) {\r\n          map2.push(map[i])\r\n        }\r\n        this.$refs.taskOptRef.showOpt(map2);\r\n      },\r\n\r\n\r\n      ok() {\r\n        this.handleCancel()\r\n      },\r\n\r\n      getOaFileList(tableName, busDataId) {\r\n        this.$refs[this.pageRef].getOaFiles(tableName, busDataId);\r\n        this.$refs[this.pageRef].getBanWenFiles(tableName, busDataId);\r\n      },\r\n      downFiles() {\r\n        this.$refs[this.pageRef].downAllFiles();\r\n      },\r\n      handleCancel() {\r\n        //刷新数据  若测试该方法有效  请删除多余代码\r\n        this.reload();\r\n\r\n        /*  this.$emit('close');\r\n          this.jeditor.value = '';\r\n          this.publishData = \"\";\r\n          this.editValue == 0\r\n          this.visible = false;\r\n          this.disableSubmit = false;\r\n          //清除意见与按钮页面数据\r\n          this.$refs.taskOptRef.clear()\r\n\r\n          //刷新父页面\r\n          this.$emit('reload_todo')*/\r\n      }, onChange(date, dateString) {\r\n        // console.log(date, dateString);\r\n      }, onChange2(date, dateString) {\r\n        // console.log(date, dateString);\r\n      }\r\n\r\n    }\r\n  }\r\n</script>\r\n<style lang=\"less\" scoped>\r\n  .fuwenben {\r\n    /deep/ .ant-card-body {\r\n      padding: 0 !important;\r\n    }\r\n  }\r\n\r\n  .hoverred:hover {\r\n    color: red;\r\n    cursor: pointer;\r\n  }\r\n</style>\r\n<style>\r\n  /*附件列表元素----开始*/\r\n  .qiCao {\r\n    padding-bottom: 1%;\r\n  }\r\n\r\n  .hoverred {\r\n    display: inline-block;\r\n    padding-top: 1%;\r\n  }\r\n\r\n  .delCss {\r\n    width: 22.3%;\r\n    display: inline-block;\r\n    font-weight: bolder;\r\n    margin-right: 30%;\r\n    float: right;\r\n  }\r\n\r\n  .pices {\r\n    width: 28px;\r\n    height: 27px;\r\n    cursor: pointer;\r\n    margin-right: 7%;\r\n  }\r\n\r\n  /*附件列表元素---结束*/\r\n</style>"]}]}